<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-skill/database/redis/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="愧怍 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="愧怍 Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="愧怍 JSON Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Ninjee的前端篮子" href="/opensearch.xml">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="icon" href="/img/kuizuo.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><title data-rh="true">Redis笔记 - Ninjee的前端篮子</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://moxynj.github.io//img/kuizuo.jpg"><meta data-rh="true" name="twitter:image" content="https://moxynj.github.io//img/kuizuo.jpg"><meta data-rh="true" property="og:url" content="https://moxynj.github.io//docs/skill/database/redis/"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="keywords" content="愧怍, kuizuo, blog, javascript, typescript, python ,node, react, vue, web, 前端, 后端"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Redis笔记 - Ninjee的前端篮子"><meta data-rh="true" name="description" content="redis 中文官方网站"><meta data-rh="true" property="og:description" content="redis 中文官方网站"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://moxynj.github.io//docs/skill/database/redis/"><link data-rh="true" rel="alternate" href="https://moxynj.github.io//docs/skill/database/redis/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://moxynj.github.io//docs/skill/database/redis/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://2NBW5YNFON-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.027cc5ec.css">
<link rel="preload" href="/assets/js/runtime~main.3afa910a.js" as="script">
<link rel="preload" href="/assets/js/main.cf246ba2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="愧怍" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.webp" alt="愧怍" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">愧怍</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/tags">标签</a><a class="navbar__item navbar__link" href="/archive">归档</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">学习</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/skill/">技术笔记</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">小工具</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/resources">资源导航</a></li><li><a href="https://deobfuscator.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS代码混淆与还原</a></li><li><a href="http://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef在线加解密</a></li><li><a href="http://tools.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">愧怍在线工具</a></li></ul></div><a class="navbar__item navbar__link" href="/project">实战项目</a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/skill">技术笔记简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/vue">Vue</a><button aria-label="打开/收起侧边栏菜单「Vue」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/react">React</a><button aria-label="打开/收起侧边栏菜单「React」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/web">Web</a><button aria-label="打开/收起侧边栏菜单「Web」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/javascript">JavaScript</a><button aria-label="打开/收起侧边栏菜单「JavaScript」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/node">Node</a><button aria-label="打开/收起侧边栏菜单「Node」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/css">Css</a><button aria-label="打开/收起侧边栏菜单「Css」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/category/算法">算法</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/逆向">逆向</a><button aria-label="打开/收起侧边栏菜单「逆向」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/后端">后端</a><button aria-label="打开/收起侧边栏菜单「后端」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/数据库">数据库</a><button aria-label="打开/收起侧边栏菜单「数据库」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/skill/database/mysql/">Mysql</a><button aria-label="打开/收起侧边栏菜单「Mysql」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/skill/database/mongo/">MongoDB</a><button aria-label="打开/收起侧边栏菜单「MongoDB」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/docs/skill/database/redis/">Redis</a><button aria-label="打开/收起侧边栏菜单「Redis」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/skill/database/redis/Redis获取六位不重复数字（邀请码）">Redis获取六位不重复数字（邀请码）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/skill/database/redis/">Redis笔记</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/skill/database/elasticsearch/">Elasticsearch</a><button aria-label="打开/收起侧边栏菜单「Elasticsearch」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_FykI"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_DTRl"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/数据库"><span itemprop="name">数据库</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Redis</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Redis笔记</h1></header><p><a href="http://www.redis.cn/" target="_blank" rel="noopener noreferrer">redis 中文官方网站</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h2><p>官方推荐使用 Linux 去开发使用！</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="window">window<a class="hash-link" href="#window" title="标题的直接链接">​</a></h3><p>下载地址：<a href="https://github.com/tporadowski/redis/releases" target="_blank" rel="noopener noreferrer">https://github.com/tporadowski/redis/releases</a></p><p>下载 <strong>Redis-x64-xxx.zip</strong>压缩包 解压为 redis</p><p>在 redis 目录下，打开 CMD 输入 或者双击运行 redis-server.exe</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis-server.exe redis.windows.conf</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>在打开一个输入</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis-cli.exe -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1 -p </span><span class="token number" style="color:#36acaa">6379</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>即可连接</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="linux">Linux<a class="hash-link" href="#linux" title="标题的直接链接">​</a></h3><p><a href="http://redis.io/download" target="_blank" rel="noopener noreferrer">redis 下载</a></p><p><code>redis-6.0.8.tar.gz</code></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># wget http://download.redis.io/releases/redis-6.0.8.tar.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># tar xzf redis-6.0.8.tar.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cd redis-6.0.8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装gcc-c++ 编译</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum instatll gcc-c++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># make</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>执行完 <strong>make</strong> 命令后，redis-6.0.8 的 <strong>src</strong> 目录下会出现编译后的 redis 服务程序 redis-server，还有用于测试的客户端程序 redis-cli</p><p>下面启动 redis 服务</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># cd src</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ./redis-server</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>注意这种方式启动 redis 使用的是默认配置。也可以通过启动参数告诉 redis 使用指定配置文件使用下面命令启动。</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># cd src</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ./redis-server ../redis.conf</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>redis 默认安装路径 <code>/usr/local/bin</code></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="docker">Docker<a class="hash-link" href="#docker" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="拉取镜像">拉取镜像<a class="hash-link" href="#拉取镜像" title="标题的直接链接">​</a></h4><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull redis</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="启动-redis">启动 Redis<a class="hash-link" href="#启动-redis" title="标题的直接链接">​</a></h4><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d  -v </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/data:/data --name redis -p </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain">:6379 redis redis-server --requirepass </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain"> --appendonly </span><span class="token function" style="color:#d73a49">yes</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>启动命令说明：</p><ul><li><code>$PWD/data:/data</code> : 映射 redis 的 data 目录到当前目录下的 data 目录</li><li><code>--requirepass</code> : 是设置 redis 的密码</li><li><code>--appendonly yes</code> : 启用持久化存储</li></ul><p>例如：</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d  -v /home/app/redis/data:/data --name redis -p </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain">:6379 redis  redis-server --requirepass </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain"> --appendonly </span><span class="token function" style="color:#d73a49">yes</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>如果需要使用配置文件，则需要做个文件映射；注意所在目录下必须要有 redis.conf 这个文件，否则将启动失败。</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d  -v /home/app/redis/data:/data  -v /home/app/redis/conf:/usr/local/etc/redis --name redis -p </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain">:6379 redis redis-server /usr/local/etc/redis/redis.conf</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><blockquote><p>redis 的这个配置文件可以到官方的这个地址上去获取 <a href="http://download.redis.io/redis-stable" target="_blank" rel="noopener noreferrer">http://download.redis.io/redis-stable</a></p></blockquote><p>更多: <a href="https://www.cnblogs.com/vchar/p/14347260.html" target="_blank" rel="noopener noreferrer">Docker 上安装 Redis</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="基本命令">基本命令<a class="hash-link" href="#基本命令" title="标题的直接链接">​</a></h2><p><a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener noreferrer">Redis 命令中心（Redis commands）</a></p><p>Redis 不区分大小写 一般推荐大写(与 Mysql 一样)</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">set</span><span class="token plain"> key value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keys * </span><span class="token comment" style="color:#999988;font-style:italic"># 查看所有key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXISTS key </span><span class="token comment" style="color:#999988;font-style:italic"># 判断key 是否存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">type</span><span class="token plain"> key </span><span class="token comment" style="color:#999988;font-style:italic"># 查看key的value类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPIRE key second </span><span class="token comment" style="color:#999988;font-style:italic"># 设置key的过期时间,单位是秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ttl key </span><span class="token comment" style="color:#999988;font-style:italic"># 查看当前key 的剩余时间</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="五大数据类型">五大数据类型<a class="hash-link" href="#五大数据类型" title="标题的直接链接">​</a></h2><p>Redis 支持五种数据类型：string（字符串），hash（哈希），list（列表），set（集合）及 zset(sorted set：有序集合)。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="string">String<a class="hash-link" href="#string" title="标题的直接链接">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">APPEND key &#x27;123&#x27; # 给key后面追加字符串123 如果key不存在 则为set 返回字符串长度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STRLEN key # 获取字符串长度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">incr key # 自增1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">decr key # 自减1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INCRBY key 10 # 递增10 指定增量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DECRBY key 10 # 递减10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GETRANGE key 0 3 # 截取字符串 0-3 包括3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GETRANGE key 0 -1 # 截取所有字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SETRANGE key 1 xxx # 替换指定位置的字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">###########################################################################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setex (set with expire) # 设置过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setnx (set if not exist) # 不存在在设置 (分布式锁中会常常使用)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setex key3 30 &#x27;hello&#x27; # 设置key3的为hello,30秒后过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">###########################################################################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mset mget msetex # 批量设置与批量获取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mset k1 v1 k2 v2 k3 v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msetex k1 v1 k4 v4 # 原子性的操作 要么一起成功 要么一起失败</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getset key value # 先取后设置 不存在则返回nil 如果存在,则获取,并赋为新值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">############################################################################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set user:1 {name:kuizuo,age:20} # 设置user为一个对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set user:1:name kuizuo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># user:{id}:{filed} value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get user:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get user:1:name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>String 类似的使用场景: value 除了是字符串还可以是数字 或者对象</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="list">List<a class="hash-link" href="#list" title="标题的直接链接">​</a></h3><p>redis 里 List 可以充当栈,队列,阻塞队列</p><p><strong>所有 list 命令用 l 开头</strong></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">LPUSH list value </span><span class="token comment" style="color:#999988;font-style:italic"># 将value 将一个值或多个值插入列表头部(左)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RPUSH list value </span><span class="token comment" style="color:#999988;font-style:italic"># 将value 将一个值或多个值插入列表底部(右)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LRANGE list </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1 </span><span class="token comment" style="color:#999988;font-style:italic"># 获取所有list元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LPOP list </span><span class="token comment" style="color:#999988;font-style:italic"># 移除list的第一个元素(左)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RPOP list </span><span class="token comment" style="color:#999988;font-style:italic"># 移除list的最后一个元素(右)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lindex list </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 通过下标获取list中的某一个值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lset list </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> item </span><span class="token comment" style="color:#999988;font-style:italic"># 如果不存在列表 去更新就会报错</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Llen list </span><span class="token comment" style="color:#999988;font-style:italic"># 取列表的长度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lrem list </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> one </span><span class="token comment" style="color:#999988;font-style:italic"># 移除指定的值 例:移除一个为one的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ltrim list </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 截取1-2 包括2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linsert list before </span><span class="token string" style="color:#e3116c">&quot;world&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;new&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 在world 前面插入new 后面则用after</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpoplpush list1 list2 </span><span class="token comment" style="color:#999988;font-style:italic"># 移除列表最后一个元素,将他移动到新的列表</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>列表实际上就是一个链表</p><p>可以实现消息队列 (Lpush Rpop),栈(Lpush Lpop)</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="set">Set<a class="hash-link" href="#set" title="标题的直接链接">​</a></h3><p>set 中的值是无法重复的，无序不重复集合</p><p><strong>set 命令用 s 开头</strong></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sadd myset </span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># set集合中添加元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scard myset </span><span class="token comment" style="color:#999988;font-style:italic"># 获取set集合中的内容元素个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smembers myset </span><span class="token comment" style="color:#999988;font-style:italic"># 查看指定set的所有值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sismember myset hello </span><span class="token comment" style="color:#999988;font-style:italic"># 判断某一个值是不是在set集合中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SRANDMEMBER myset </span><span class="token comment" style="color:#999988;font-style:italic"># 随机抽选出一个元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SRANDMEMBER myset </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 随机抽选出指定个数元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#####################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 获取set中的差集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SDIFF set1 set2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 获取set中的交集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SINTER set1 set2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 获取set中的并集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SUNION set1 set2</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>例如：共同好友就可以使用 set 交集来实现</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="hash">Hash<a class="hash-link" href="#hash" title="标题的直接链接">​</a></h3><p>Map 集合，key-map(key-value)</p><p><strong>set 命令用 h 开头</strong></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">hset myhash field1 kuizuo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hget myhash field1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hgetall myhash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdel myhash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hlen myhash </span><span class="token comment" style="color:#999988;font-style:italic"># 获取hash表的字段数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HEXISTS myhash field1 </span><span class="token comment" style="color:#999988;font-style:italic"># 判断hash中 指定字段是否存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hkeys myhash </span><span class="token comment" style="color:#999988;font-style:italic"># 只获得所有field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hvals myhash </span><span class="token comment" style="color:#999988;font-style:italic"># 只获得所有value</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>hash 可变更数据 比如 user 信息,更适合对象的存储</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="zset">Zset<a class="hash-link" href="#zset" title="标题的直接链接">​</a></h3><p>有序集合，在 set 的基础上增加了一个值 score</p><p><strong>zset 命令用 z 开头</strong></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zadd myset </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zadd myset </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> two </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> three</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ZRANGEBYSCORE key min max 一定要从小到大</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZRANGEBYSCORE myset -inf +inf </span><span class="token comment" style="color:#999988;font-style:italic"># 根据score排序</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZREVERANGE myset </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1 </span><span class="token comment" style="color:#999988;font-style:italic"># 从大到小进行排序!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zrem myset item </span><span class="token comment" style="color:#999988;font-style:italic"># 移除有序集合中的指定元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zcard myset </span><span class="token comment" style="color:#999988;font-style:italic"># 获取有序集合中元素的个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>案例:set 排序 班级成绩表，工资表排序</p><p>普通消息 1 重要消息 2 带权重进行判断</p><p>排行榜应用实现，取 TOP N</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="三种特殊数据类型">三种特殊数据类型<a class="hash-link" href="#三种特殊数据类型" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="geospatial">geospatial<a class="hash-link" href="#geospatial" title="标题的直接链接">​</a></h3><p>地址位置，<strong>geospatial 命令用 geo 开头</strong></p><p><strong>GEO 底层的实现原理就是 Zset,所以可以使用 Zset 命令来操作 Geo!</strong></p><p>应用: 推算地理位置的信息，两地之间的距离，方圆几里的人</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 规则: 两极无法直接添加,一般都是直接下载城市数据,直接通过程序一次性读入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参数: key (经度，纬度、名称) 切记不可反！ 经纬度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 有效经度-180度到180度 有效纬度-85.05112878到85.05112878</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GEOADD china:city </span><span class="token number" style="color:#36acaa">116.40</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">39.90</span><span class="token plain"> beijin </span><span class="token comment" style="color:#999988;font-style:italic"># 设置北京的经纬度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GEOPOS china:city beijing </span><span class="token comment" style="color:#999988;font-style:italic"># 获取北京的经纬度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GEODIST china:city beijing shanghai unit </span><span class="token comment" style="color:#999988;font-style:italic"># 获取两地之间的距离 默认单位m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GEORADIS china:city </span><span class="token number" style="color:#36acaa">110</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> km </span><span class="token comment" style="color:#999988;font-style:italic"># 以110,30 这个点范围1000km的 地理位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GEORADIS china:city </span><span class="token number" style="color:#36acaa">110</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token plain"> km withdist withcoord count </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 以110,30 这个点范围500km的 获取10个 带直线距离和经纬度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GEORADIUSBYMEMBER chaina:city beijing 1000m </span><span class="token comment" style="color:#999988;font-style:italic"># 以北京周围1000km的 地理位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GEOHASH china:city beijing </span><span class="token comment" style="color:#999988;font-style:italic"># 将二维的地址位置转为一位11位字符串,如果两个字符串越接近,则距离越近</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZRANGE chaina:city </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1 </span><span class="token comment" style="color:#999988;font-style:italic"># 查看地图中全部元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZREM chaina:city beijing </span><span class="token comment" style="color:#999988;font-style:italic"># 移除指定元素</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="hyperloglog">Hyperloglog<a class="hash-link" href="#hyperloglog" title="标题的直接链接">​</a></h3><p>Redis Hyperloglog 基数统计的算法</p><p>基数(不重复的元素)，会有误差！0.81 的错误率，但使用场景是可以接受的</p><p>统计网页的 UV （一个人访问一个网站多次，但是还是算作一个人），传统的方式，用 set 保存用户的 id，然后统计 set 中的元素数量来作为标准判断。</p><p><strong>Hyperloglog 命令 使用 PF 开头</strong></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">PFadd mykey1 a b c d e f g h i j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PFadd mykey2 i j k l m n o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PFMERGE mykey3 mykey1 mykey2 </span><span class="token comment" style="color:#999988;font-style:italic"># 获取并集 并生成新的组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PFCOUNT mykey </span><span class="token comment" style="color:#999988;font-style:italic"># 获取元素的数量</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>允许容错,一定可以使用 Hyperloglog</p><p>不允许容错,就使用 set 与自己的数据类型即可</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="bitmaps">Bitmaps<a class="hash-link" href="#bitmaps" title="标题的直接链接">​</a></h3><p>位存储</p><p>统计用户信息，活跃，不活跃；登录，不登录，打卡；两个状态的都可以使用 Bitmaps</p><p>Bitmaps 位图,数据结构，都是操作二进制为来进行记录，就只有 0 和 1 两个状态！</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># 记录周一到周日的打卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setbit sign 0 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setbit sign 1 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setbit sign 2 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setbit sign 3 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setbit sign 4 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setbit sign 5 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setbit sign 6 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看某一天是否有打开</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getbit sign 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 统计打卡的天数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bitcount sign</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="事务">事务<a class="hash-link" href="#事务" title="标题的直接链接">​</a></h2><p>Redis 单条命令式保存原子性的，但是事务不保证原子性!</p><p>Redis 事务本质： 一组命令的集合！一个事务中的所有命令都会被序列化，会安卓顺序执行</p><p>一次性、顺序性、排他性！执行一些列的命令！</p><p>Redis 事务没有隔离级别的概念！</p><p>所有命令在事务中并没有直接呗执行！而只有发起执行命令的时候才会执行！Exec</p><ul><li>开始事务（multi）</li><li>命令入队（...）</li><li>执行事务（exec）</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">multi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set k1 v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set k2 v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get k1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec  # 执行事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISCARD # 取消事务 事务队列中的命令都不会被执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 代码有问题，命令有错，事务中所有命令都不会被执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 运行中异常，执行其他命令正常，错误命令抛出异常</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="监控-watch">监控 Watch<a class="hash-link" href="#监控-watch" title="标题的直接链接">​</a></h3><p>悲观锁：很悲观，认为什么时候都会出问题，无论做什么都会加锁</p><p>乐观锁：很乐观，认为什么时候都不会出问题，所以不会上锁！更新数据的时候判断一下，在此期间是否有人修改过该数据</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">set money 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set out 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">watch money</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DECRBY money 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InCRBY money 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果这时用户充钱了 那么exec就无法执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解除监控，并重新监控最新的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unwatch money</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">watch money</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="redisconf">Redis.conf<a class="hash-link" href="#redisconf" title="标题的直接链接">​</a></h2><p>配置文件 unit 单位对大小写不敏感</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="网络">网络<a class="hash-link" href="#网络" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">bind 127.0.0.1 # 绑定的IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected-mode yes # 保护模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port 6379 # 端口设置</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="general-通用">GENERAL 通用<a class="hash-link" href="#general-通用" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">daemonize yes # 以守护进程方式的运行,默认是no,需自己开启yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pidfile /var/run/redis_6379.pid # 以后台方式运行,就需要指定一个pid文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Specify the server verbosity level.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This can be one of:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># debug (a lot of information, useful for development/testing)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># verbose (many rarely useful info, but not a mess like the debug level)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># notice (moderately verbose, what you want in production probably)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># warning (only very important / critical messages are logged)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loglevel notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logfile # 日志文件位置名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">database 16 # 数据库数量 默认16个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alaways-show-logo yes # 是否总是显示LOGO</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="快照">快照<a class="hash-link" href="#快照" title="标题的直接链接">​</a></h5><p>持久化,在规定的时间内,执行了多少次操作,则会持久化到文件 .rdb .aof</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">stop-writes-on-bgsave-error yessave 900 1 # 在900s内,如果至少有一个key修改 则持久化操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">save 300 10 # 在300s内,如果至少有10个key进行修改 则持久化操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">save 60 10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stop-writes-on-bgsave-error yes # 持久化如果出错 是否继续工作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rdbcompression yes # 是否压缩rdb文件,会消耗一些cpu资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rdbchecksum yes # 保存rdb文件的时候,是否效验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dir ./ # rdb保存的目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dbfilename dump.rdb # 保存的文件名</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="replication-主从复制">REPLICATION 主从复制<a class="hash-link" href="#replication-主从复制" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">slaveof &lt;masterip&gt; &lt;masterport&gt; # 设置主机的端口和ip</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="security-密码">SECURITY 密码<a class="hash-link" href="#security-密码" title="标题的直接链接">​</a></h5><p>requirepass 密码</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">config get requirepass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config set requirepass &quot;123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth 123456</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="clients-客户端">CLIENTS 客户端<a class="hash-link" href="#clients-客户端" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">maxclients 10000  # 默认客户端连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxmemory &lt;bytes&gt; # redis 配置最大的内存容量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxmemory-policy noeviction # 内存达到上限后的处理策略 # 移除一些过期的key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">noeviction: 不删除策略, 达到最大内存限制时, 如果需要更多内存, 直接返回错误信息。（默认值）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allkeys-lru: 所有key通用; 优先删除最近最少使用(less recently used ,LRU) 的 key。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volatile-lru: 只限于设置了 expire 的部分; 优先删除最近最少使用(less recently used ,LRU) 的 key。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allkeys-random: 所有key通用; 随机删除一部分 key。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volatile-random: 只限于设置了 expire 的部分; 随机删除一部分 key。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volatile-ttl: 只限于设置了 expire 的部分; 优先删除剩余时间(time to live,TTL) 短的key。</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="append-only-mode-aof-配置">APPEND ONLY MODE aof 配置<a class="hash-link" href="#append-only-mode-aof-配置" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">appendonly no # 默认不开启aof模式,默认使用rdb方式持久化,在大部分情况,rdb够用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">appendfilename &quot;appendonly.aof&quot;  # 持久化文件名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># appendfsync always  # 每次修改都会 sync 消耗性能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">appendfsync everysec   # 美妙执行一次 sync,可能会丢失这1s的数据!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># appendfsync no # 不执行sync,这个时候操作系统自己同步数据,速度最快</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="redis-持久化">Redis 持久化<a class="hash-link" href="#redis-持久化" title="标题的直接链接">​</a></h2><p>redis 是内存数据库,单如果不将内存中的数据库状态保存的磁盘,一旦服务器进程退出,服务器中的数据库状态也会丢失,所以 redis 提供了持久化的功能</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="rdbredis-database">RDB(Redis Database)<a class="hash-link" href="#rdbredis-database" title="标题的直接链接">​</a></h3><p>在指定的时间间隔内将内存中的数据集快照写入磁盘,也就是 Snapshot 快照,恢复时直接将快照文件读到内存</p><p>Redis 会单独创建 ( fork )一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何 IO 操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加的高效。RDB 的缺点是最后一次持久化后的数据可能丢失。我们默认的就是 RDB，一般情况下不需要修改这个配置!</p><p><strong>rdb 保存的文件是 dump.rdb</strong></p><p>dbfilename dump.rdb</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="触发机制">触发机制<a class="hash-link" href="#触发机制" title="标题的直接链接">​</a></h4><p>1、save 的规则满足的情况下，会自动触发 rdb 规则</p><p>2、执行 flushall 命令，也会触发我们的 rdb 规则!</p><p>3、退出 redis，也会产生 rdb 文件!</p><p>就会自动生成一个 dump.rdb，有时候还有备份一份</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="恢复-rdb-文件">恢复 rdb 文件<a class="hash-link" href="#恢复-rdb-文件" title="标题的直接链接">​</a></h4><p>只需要将 rdb 文件放在 redis 启动目录下就可以了,redis 启动的时候就会自动检查 dump.rdb 文件</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">config get dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;dir&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;/usr/local/bin&quot; # 如果在这个目录下存在dump.rdb 启动就会自动恢复其中的数据</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>优点:</p><p>1、适合大规模的数据恢复</p><p>2、对数据的完整性要求不高</p><p>缺点：</p><p>1、需要一定的时间间隔进程操作，如果 redis 意外宕机了，这个最后一次修改数据就没有了</p><p>2、fork 进程的时候，会占用一定的内存空间</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="aofappend-only-file">AOF（Append Only File）<a class="hash-link" href="#aofappend-only-file" title="标题的直接链接">​</a></h3><p>将我们的所有命令都记录下来，history，恢复的时候就把这个文件内的命令全部在执行一遍</p><p>默认是不开启的，我们需要手动进行配置!我们只需要将 appendonly 改为 yes 就开启了 aof !重启</p><p>redis 就可以生效了</p><p>如果这个 aof 文件有错误，这时候 redis 是启动不起来的，我们需要修复这个 aof 文件，redis 给我们提供了一个工具 redis-check-aof --fix</p><p>优点</p><p>可指定修改都同步还是每秒都同步，文件完整性会更好</p><p>缺点:</p><p>相对于数据文件，aof 远远大于 rdb，修复的速度也不如 rdb</p><p>Aof 的运行效率也要比 rdb 慢。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="小结">小结<a class="hash-link" href="#小结" title="标题的直接链接">​</a></h3><p>只做缓存，如果你只希望你的数据在服务器运行的时候存在，也可以不使用任何持久化</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="redis-发布订阅">Redis 发布订阅<a class="hash-link" href="#redis-发布订阅" title="标题的直接链接">​</a></h2><p>Redis 发布订阅(publsub)是一种消息通信模式 ∶ 发送者(pub)发送消息，订阅者(sub)接收消息。Redis 客户端可以订阅任意数量的频道。
订阅/发布消息图︰</p><p>第一个：消息发布者，第二个频道（消息队列），第三个：消息订阅者</p><p><img loading="lazy" src="http://cdn.kuizuo.cn/blogR50ea35ec36a3e4ea16cb132637477df0" alt="查看源图像" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h3><p>订阅端</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SUBSCRIBE kuizuo # 创建频道</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>发送端</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">PUBLISH kuizuo ‘hello‘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="原理">原理<a class="hash-link" href="#原理" title="标题的直接链接">​</a></h3><p>Redis 是使用 C 实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，
籍此加深对 Redis 的理解。
Redis 通过 PUBLISH、SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。
微信 ∶
通过 SUBSCRIBE 命令订阅某频道后，redis-server 里维护了一个字典，字典的键就是一个个频道!
，而字典的值则是一个链表，
链表中保存了所有订阅这个 channel 的客户端。SUBSCRIBE 命令的关键，就是将客户端添加到给定
channel 的订阅链表中。
通过 PUBLSH 命令向订阅者发送消息，redis-server 会使用给定的频道作为键，在它所维护的 channel 字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者。
Pub/Sub 从字面上理解就是发布( Publish)与订阅( Subscribe )，在 Redis 中，你可以设定对某一个 key 值进行消息发布及消息订阅，当一个 key 值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p><p>使用场景：</p><p>1、实时消息系统，公告</p><p>2、实时聊天（将频道当做聊天室，将信息回显给所有人）</p><p>3、订阅，关注系统都是可以的</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="redis-主从复制">Redis 主从复制<a class="hash-link" href="#redis-主从复制" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="概念">概念<a class="hash-link" href="#概念" title="标题的直接链接">​</a></h3><p>主从复制，是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。前者称为主节点(master/leader)，后者称为从节点(slave/follower);数据的复制是单向的，只能由主节点到从节点。Master 以写为主，Slave 以读为主。
默认情况下，每台 Redis 服务器都是主节点;且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="主从复制的作用主要包括">主从复制的作用主要包括︰<a class="hash-link" href="#主从复制的作用主要包括" title="标题的直接链接">​</a></h3><p>1、数据冗余 ∶ 主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。
2、故障恢复︰当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复;实际上是一种服务的冗余。
3、负载均衡︰在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写 Redis 数据时应用连接主节点，读 Redis 数据时应用连接从节点），分担服务器负载;尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高 Redis 服务器的并发量。
4、高可用基石 ∶ 除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redis 高可用的基础。</p><p>一般来说，要将 Redis 运用于工程项目中，只使用一台 Redis 是万万不能的</p><p>原因如下︰
1、从结构上，单个 Redis 服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大;
2、从容量上，单个 Redis 服务器内存容量有限，就算一台 Redis 服务器内存容量为 256G，也不能将所有内存用作 Redis 存储内存，一般来说，<strong>单台 Redis 最大使用内存不应该超过 20G。</strong></p><p>主从复制，读写分离！80%的情况下都是在进行读操作，就可以减缓服务器压力，架构中经常使用，一主二从</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="环境配置">环境配置<a class="hash-link" href="#环境配置" title="标题的直接链接">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis:0&gt;info replication  # 查看当前库信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;# Replication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">role:master  # 角色</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connected_slaves:0 # 没有从机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master_replid:d6950e2fdb86b591f42e8725279034303e8cb6ee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master_replid2:0000000000000000000000000000000000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master_repl_offset:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">second_repl_offset:-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repl_backlog_active:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repl_backlog_size:1048576</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repl_backlog_first_byte_offset:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repl_backlog_histlen:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>需要修改 配置文件</p><p>端口 pid 名字 log 文件名 dump.rdb 名</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="一主二从">一主二从<a class="hash-link" href="#一主二从" title="标题的直接链接">​</a></h3><p>默认情况下，每台 Redis 服务器都是主节点;我们一般情况下只用配置从机就好了!认老大!一主（ 79)二从( 80，81 )</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SLAVEOF 127.0.0.1 6379 # 找谁为主机</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>主机可以写，从机不能写只能读！</strong>主机中的所有数据都会被从机保存</p><p>主机断开连接，从机依旧可以连接到主机，并且主机回来，从机依旧可以直接获取数据</p><p>从机重新连接会主机，主机的任何操作立马同步到从机上</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="复制原理">复制原理<a class="hash-link" href="#复制原理" title="标题的直接链接">​</a></h3><p>slave 启动成功连接到 master 后会发送一个 sync 命令
Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后，<strong>master 将传送整个数据文件到 slave，并完成一次完全同步。</strong></p><p>全量复制：slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p><p>增量复制：Master 继续将新的所有收集到的修改命令依次传给 slave，完成同步但是只要是重新连接 master，一次完全同步（全量复制)将被自动执行</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="层层链路">层层链路<a class="hash-link" href="#层层链路" title="标题的直接链接">​</a></h3><p>上一个 M 链接下一个 S</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="哨兵模式">哨兵模式<a class="hash-link" href="#哨兵模式" title="标题的直接链接">​</a></h2><p><a href="https://www.jianshu.com/p/06ab9daf921d" target="_blank" rel="noopener noreferrer">Redis 哨兵（Sentinel）模式</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="概述">概述<a class="hash-link" href="#概述" title="标题的直接链接">​</a></h3><p>如果主机宕机了，从机要当主机，通过命令<code>SLAVEOF no one</code> 从机变主机，但如果这时候主机恢复了，那么就需要重新配置了，十分麻烦</p><p>主从切换技术的方法是 ∶ 当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。Redis 从 2.8 开始正式提供了 Sentinel (哨兵）架构来解决这个问题。</p><p>后台能够监控主机是否故障，如果故障了根据投票数自动将从机变为主机</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="实现">实现<a class="hash-link" href="#实现" title="标题的直接链接">​</a></h3><p>哨兵模式是一种特殊的模式，首先 Redis 提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是<strong>哨兵通过发送命令，等待 Redis 服务器响应，从而监控运行的多个 Redis 实例。</strong></p><p><img loading="lazy" src="http://cdn.kuizuo.cn/blog11320039-57a77ca2757d0924.png" alt="img" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="配置">配置<a class="hash-link" href="#配置" title="标题的直接链接">​</a></h3><p>1、哨兵配置文件 sentinel.conf</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sentinel monitor myredis 127.0.0.1 6379 1</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>后面的这个数字 1，代表主机挂了，slave 投票看让谁当主机，票数多的就会成为主机</p><p>2、启动哨兵</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis-sentinel config/sentinel.conf</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>3、主机挂了，从机当主机了，但是如果原主机恢复了，也只能乖乖当新主机的从机</p><p>优点:
1、哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</p><p>2、主从可以切换，故障可以转移，系统的可用性就会更好</p><p>3、哨兵模式就是主从模式的升级，手动到自动，更加健壮</p><p>缺点:</p><p>1、Redis 不好啊在线扩容的，集群容量一旦到达上限，在线扩容就十分麻烦</p><p>2、实现哨兵模式的配置其实是很麻烦的，里面有很多选择</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="redis-缓存穿透和雪崩">Redis 缓存穿透和雪崩<a class="hash-link" href="#redis-缓存穿透和雪崩" title="标题的直接链接">​</a></h2><p><strong>服务器高可用的问题</strong></p><p>Redis 缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。
另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="缓存穿透">缓存穿透<a class="hash-link" href="#缓存穿透" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="概念-1">概念<a class="hash-link" href="#概念-1" title="标题的直接链接">​</a></h4><p>缓存查不到，导致数据都查数据库</p><p>缓存穿透的概念很简单，用户想要查询一个数据，发现 redis 内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒杀!），于是都去请求了持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。|</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="布隆过滤器">布隆过滤器<a class="hash-link" href="#布隆过滤器" title="标题的直接链接">​</a></h5><p>布隆过滤器是一种数据结构，对所有可能查询的参数以 hash 形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="缓存空对象">缓存空对象<a class="hash-link" href="#缓存空对象" title="标题的直接链接">​</a></h5><p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源;</p><p>但是这种方法会存在两个问题:
1、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键;
2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="缓存击穿">缓存击穿<a class="hash-link" href="#缓存击穿" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="概述-1">概述<a class="hash-link" href="#概述-1" title="标题的直接链接">​</a></h4><p>全都查缓存，此时缓存恰好过期，导致量过大</p><p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个 key 非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个 key 在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。
当某个 key 在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期
，会同时访问数据库来查询最新数
据，并且回写缓存，会导使数据库瞬间压力过大。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="解决方案-1">解决方案<a class="hash-link" href="#解决方案-1" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="设置热点数据永不过期">设置热点数据永不过期<a class="hash-link" href="#设置热点数据永不过期" title="标题的直接链接">​</a></h5><p>从缓存层面来看，没有设置过期时间，所以不会出现热点 key 过期后产生的问题。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="加互斥锁">加互斥锁<a class="hash-link" href="#加互斥锁" title="标题的直接链接">​</a></h5><p>分布式锁 ∶ 使用分布式锁，保证对于每个 key 同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="缓存雪崩">缓存雪崩<a class="hash-link" href="#缓存雪崩" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="概述-2">概述<a class="hash-link" href="#概述-2" title="标题的直接链接">​</a></h4><p>指在某一个时间段，缓存集中过期失效。Redis 宕机!</p><p>产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="基本解决方案">基本解决方案<a class="hash-link" href="#基本解决方案" title="标题的直接链接">​</a></h3><p>redis 高可用
这个思想的含义是，既然 redis 有可能挂掉，那我多增设几台 redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群。（异地多活!)
限流降级（在 SpringCloud 讲解过!)
这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个 key 只允许一个线程查询数据和写缓存，其他线程等待。
数据预热
数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的 key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/redis">redis</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/数据库">数据库</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/skill/database/mongo/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">MongoDB笔记</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/skill/database/redis/Redis获取六位不重复数字（邀请码）"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Redis获取六位不重复数字（邀请码）</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a><ul><li><a href="#window" class="table-of-contents__link toc-highlight">window</a></li><li><a href="#linux" class="table-of-contents__link toc-highlight">Linux</a></li><li><a href="#docker" class="table-of-contents__link toc-highlight">Docker</a><ul><li><a href="#拉取镜像" class="table-of-contents__link toc-highlight">拉取镜像</a></li><li><a href="#启动-redis" class="table-of-contents__link toc-highlight">启动 Redis</a></li></ul></li></ul></li><li><a href="#基本命令" class="table-of-contents__link toc-highlight">基本命令</a></li><li><a href="#五大数据类型" class="table-of-contents__link toc-highlight">五大数据类型</a><ul><li><a href="#string" class="table-of-contents__link toc-highlight">String</a></li><li><a href="#list" class="table-of-contents__link toc-highlight">List</a></li><li><a href="#set" class="table-of-contents__link toc-highlight">Set</a></li><li><a href="#hash" class="table-of-contents__link toc-highlight">Hash</a></li><li><a href="#zset" class="table-of-contents__link toc-highlight">Zset</a></li></ul></li><li><a href="#三种特殊数据类型" class="table-of-contents__link toc-highlight">三种特殊数据类型</a><ul><li><a href="#geospatial" class="table-of-contents__link toc-highlight">geospatial</a></li><li><a href="#hyperloglog" class="table-of-contents__link toc-highlight">Hyperloglog</a></li><li><a href="#bitmaps" class="table-of-contents__link toc-highlight">Bitmaps</a></li></ul></li><li><a href="#事务" class="table-of-contents__link toc-highlight">事务</a><ul><li><a href="#监控-watch" class="table-of-contents__link toc-highlight">监控 Watch</a></li></ul></li><li><a href="#redisconf" class="table-of-contents__link toc-highlight">Redis.conf</a></li><li><a href="#redis-持久化" class="table-of-contents__link toc-highlight">Redis 持久化</a><ul><li><a href="#rdbredis-database" class="table-of-contents__link toc-highlight">RDB(Redis Database)</a><ul><li><a href="#触发机制" class="table-of-contents__link toc-highlight">触发机制</a></li><li><a href="#恢复-rdb-文件" class="table-of-contents__link toc-highlight">恢复 rdb 文件</a></li></ul></li><li><a href="#aofappend-only-file" class="table-of-contents__link toc-highlight">AOF（Append Only File）</a></li><li><a href="#小结" class="table-of-contents__link toc-highlight">小结</a></li></ul></li><li><a href="#redis-发布订阅" class="table-of-contents__link toc-highlight">Redis 发布订阅</a><ul><li><a href="#测试" class="table-of-contents__link toc-highlight">测试</a></li><li><a href="#原理" class="table-of-contents__link toc-highlight">原理</a></li></ul></li><li><a href="#redis-主从复制" class="table-of-contents__link toc-highlight">Redis 主从复制</a><ul><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#主从复制的作用主要包括" class="table-of-contents__link toc-highlight">主从复制的作用主要包括︰</a></li><li><a href="#环境配置" class="table-of-contents__link toc-highlight">环境配置</a></li><li><a href="#一主二从" class="table-of-contents__link toc-highlight">一主二从</a></li><li><a href="#复制原理" class="table-of-contents__link toc-highlight">复制原理</a></li><li><a href="#层层链路" class="table-of-contents__link toc-highlight">层层链路</a></li></ul></li><li><a href="#哨兵模式" class="table-of-contents__link toc-highlight">哨兵模式</a><ul><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#实现" class="table-of-contents__link toc-highlight">实现</a></li><li><a href="#配置" class="table-of-contents__link toc-highlight">配置</a></li></ul></li><li><a href="#redis-缓存穿透和雪崩" class="table-of-contents__link toc-highlight">Redis 缓存穿透和雪崩</a><ul><li><a href="#缓存穿透" class="table-of-contents__link toc-highlight">缓存穿透</a><ul><li><a href="#概念-1" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#解决方案" class="table-of-contents__link toc-highlight">解决方案</a></li></ul></li><li><a href="#缓存击穿" class="table-of-contents__link toc-highlight">缓存击穿</a><ul><li><a href="#概述-1" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#解决方案-1" class="table-of-contents__link toc-highlight">解决方案</a></li></ul></li><li><a href="#缓存雪崩" class="table-of-contents__link toc-highlight">缓存雪崩</a><ul><li><a href="#概述-2" class="table-of-contents__link toc-highlight">概述</a></li></ul></li><li><a href="#基本解决方案" class="table-of-contents__link toc-highlight">基本解决方案</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/#homepage_blogs">技术博客</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/skill">技术笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">首页</a></li><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/kuizuo" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/user/1565318510545901" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items"><li class="footer__item"><a href="https://zxuqian.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">峰华前端工程师</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p>Copyright © 2022 愧怍 Built with Docusaurus.</p><p><a href="http://beian.miit.gov.cn/">闽ICP备2020017848号-2</a></p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.3afa910a.js"></script>
<script src="/assets/js/main.cf246ba2.js"></script>
</body>
</html>