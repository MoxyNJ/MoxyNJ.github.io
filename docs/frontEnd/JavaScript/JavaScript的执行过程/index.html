<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-frontEnd/JavaScript/JavaScript的执行过程">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="ninjee RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="ninjee Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="ninjee JSON Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Ninjee的前端篮子" href="/opensearch.xml">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0930342e569f854bebdeb485c0eac7f8",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<link rel="icon" href="/img/ninjee.jpeg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><title data-rh="true">1. JavaScript的执行过程 - Ninjee的前端篮子</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ninjee.netlify.app/img/ninjee.jpeg"><meta data-rh="true" name="twitter:image" content="https://ninjee.netlify.app/img/ninjee.jpeg"><meta data-rh="true" property="og:url" content="https://ninjee.netlify.app/docs/frontEnd/JavaScript/JavaScript的执行过程"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="keywords" content="Moxy, Ninjee, blog, javascript, typescript, python ,node, react, vue, web, 前端, 后端"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="1. JavaScript的执行过程 - Ninjee的前端篮子"><meta data-rh="true" name="description" content="1 基础"><meta data-rh="true" property="og:description" content="1 基础"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ninjee.netlify.app/docs/frontEnd/JavaScript/JavaScript的执行过程"><link data-rh="true" rel="alternate" href="https://ninjee.netlify.app/docs/frontEnd/JavaScript/JavaScript的执行过程" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ninjee.netlify.app/docs/frontEnd/JavaScript/JavaScript的执行过程" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://AJRH2JRXVY-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.cb2f47c4.css">
<link rel="preload" href="/assets/js/runtime~main.274f5201.js" as="script">
<link rel="preload" href="/assets/js/main.fe74e720.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ninjee-icon.png" alt="ninjee" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/ninjee-icon.png" alt="ninjee" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Ninjee</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端知识</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/frontEnd/JavaScript">JavaScript</a></li><li><a class="dropdown__link" href="/docs/frontEnd/HTML&amp;CSS">HTML &amp; CSS</a></li><li><a class="dropdown__link" href="/docs/frontEnd/React">React</a></li><li><a class="dropdown__link" href="/docs/frontEnd/浏览器原理">浏览器原理</a></li><li><a class="dropdown__link" href="/docs/frontEnd/other">other</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">敲代码</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/code/algorithm">算法</a></li><li><a class="dropdown__link" href="/docs/code/writtenJs">手写Js</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">面试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/interview/summary">总结</a></li><li><a class="dropdown__link" href="/docs/interview/iot">物联网</a></li></ul></div><a class="navbar__item navbar__link" href="/project">我的项目</a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/javascript">JavaScript</a><button aria-label="打开/收起侧边栏菜单「JavaScript」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript">概述</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/frontEnd/JavaScript/DOM&amp;BOM/1 Document &amp; 事件">BOM &amp; DOM</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/frontEnd/JavaScript/JavaScript的执行过程">1. JavaScript的执行过程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/执行上下文">2. 执行上下文</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/作用域链和闭包">3. 作用域链和闭包</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/this与箭头函数">4. this与箭头函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/提升与暂时性死区">5. 提升与暂时性死区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/函数与函数式编程">6. 函数与函数式编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/对象">7. 对象</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/原型链">8. 原型链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/继承和类">9. 继承和类</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/ES6+基础">10. ES6+ 基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/Symbol, Set, Map">11. Symbol, Set, Map</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/Proxy, Reflect">12. Proxy, Reflect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/Promise">13. Promise</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/async:await, 异步编程">15. 迭代, 异步编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/模块化">16. 模块化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/z-ArrayAPI">Array API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/z-类型判断">类型判断与类型转换</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/JavaScript/z-执行上下文-ES3">执行上下文(ES3)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/html--css">HTML &amp; CSS</a><button aria-label="打开/收起侧边栏菜单「HTML &amp; CSS」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/react">React</a><button aria-label="打开/收起侧边栏菜单「React」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/浏览器原理">浏览器原理</a><button aria-label="打开/收起侧边栏菜单「浏览器原理」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/algorithm">algorithm</a><button aria-label="打开/收起侧边栏菜单「algorithm」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/手写-js">手写 Js</a><button aria-label="打开/收起侧边栏菜单「手写 Js」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/总结">总结</a><button aria-label="打开/收起侧边栏菜单「总结」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/other">other</a><button aria-label="打开/收起侧边栏菜单「other」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_FykI"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_DTRl"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/javascript"><span itemprop="name">JavaScript</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">1. JavaScript的执行过程</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>1. JavaScript的执行过程</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-基础">1 基础<a class="hash-link" href="#1-基础" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="11-浏览器内核">1.1 浏览器内核<a class="hash-link" href="#11-浏览器内核" title="标题的直接链接">​</a></h3><p>浏览器内核，也称浏览器的排版引擎、浏览器引擎、页面渲染引擎。</p><ul><li>Gecko：早期被Netscape和Mozilla Firefox浏览器浏览器使用；</li><li>Trident：微软开发，被IE4~IE11浏览器使用，但是Edge浏览器已经转向Blink；</li><li>Webkit：苹果基于KHTML开发、开源的，用于Safari，Google Chrome之前也在使用；</li><li>Blink：是Webkit的一个分支，Google开发，目前应用于Google Chrome、Edge、Opera等；</li></ul><p>浏览器的工作过程：</p><p><img loading="lazy" alt="截屏2022-07-01 17.04.14" src="/assets/images/截屏2022-07-01 17.04.14-94a47dc33940840c85ef669b8e2869fd.png" width="1682" height="756" class="img_E7b_"></p><p>浏览器的渲染流程：</p><p><img loading="lazy" alt="截屏2022-07-01 17.03.38" src="/assets/images/截屏2022-07-01 17.03.38-0315ef88b6051d57852d65e3fa5667e0.png" width="1158" height="536" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="12-javascript-引擎">1.2 JavaScript 引擎<a class="hash-link" href="#12-javascript-引擎" title="标题的直接链接">​</a></h3><p>高级的编程语言都是需要转成最终的机器指令来执行的，JavaScript引擎将JavaScript代码翻译成CPU指令来执行。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="121-常见的-javascript-引擎">1.2.1 常见的 JavaScript 引擎<a class="hash-link" href="#121-常见的-javascript-引擎" title="标题的直接链接">​</a></h4><ul><li><strong>SpiderMonkey</strong> (蜘蛛猴?)：第一款 JavaScript 引擎，由 Brendan Eich 开发（也就是JavaScript作者）； </li><li><strong>JavaScriptCore</strong>：WebKit 中的 JavaScript 引擎，Apple 公司开发； </li><li><strong>V8</strong>：Google 开发的强大JavaScript引擎，也帮助 Chrome 从众多浏览器中脱颖而出；</li><li>Chakra：微软开发，用于IT浏览器； </li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="13-浏览器内核--js-引擎">1.3 浏览器内核 + JS 引擎<a class="hash-link" href="#13-浏览器内核--js-引擎" title="标题的直接链接">​</a></h3><p>以 WebKit 为例，WebKit 事实上由两部分组成的：</p><ul><li>WebCore：负责HTML解析、布局、渲染等等相关的工作； </li><li>JavaScriptCore：解析、执行 JavaScript 代码；</li></ul><p>小程序中编写的 JavaScript 代码，就是被 JsCore 执行的。</p><p><img loading="lazy" alt="截屏2022-07-01 17.09.59" src="/assets/images/截屏2022-07-01 17.09.59-53a4d24a309a7b54ed20487f7f0341b8.png" width="738" height="540" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="14-v8-引擎">1.4 V8 引擎<a class="hash-link" href="#14-v8-引擎" title="标题的直接链接">​</a></h3><p>定义：V8 是用 C ++ 编写的 Google 开源高性能 JavaScript 和 WebAssembly 引擎，它用于 Chrome 和 Node.js 等。实现了 ECMAScript 和 WebAssembly。V8可以独立运行，也可以嵌入到任何C ++应用程序中。</p><p>V8 引擎的大致执行过程：</p><ol><li><strong>Blink</strong> 内核会把网络进程下载好的 Js 代码，以 stream 流的形式传输给 V8 引擎。</li><li><strong>V8</strong> 引擎会进行词法分析、语法分析，然后转化为 AST。 </li><li>PrePaser：这里有一个 Js 的预解析优化：并不是所有的JavaScript代码，在一开始时就会被执行。<ul><li>Lazy Parsing（延迟解析）：将暂不执行的函数进行预解析，只解析函数内暂时需要的内容，而对函数的全量解析是在函数被调用时才会进行。</li><li>比如在一个函数 foo 内定义了一个函数 inner，那么 inner 函数就会进行预解析，只有在 inner 作用域环境被执行时（入调用栈前），才会解析 inner。</li></ul></li><li>然后就是下图的流程。</li></ol><p><img loading="lazy" alt="截屏2022-07-01 17.11.55" src="/assets/images/截屏2022-07-01 17.11.55-7e29c25c20080bb738bf3e6289bd0288.png" width="1772" height="414" class="img_E7b_"></p><p><strong>Parse 模块</strong>：会将JavaScript代码转换成AST（抽象语法树），这是因为解释器并不直接认识JavaScript代码；</p><ul><li>如果函数没有被调用，那么是不会被转换成AST的； </li><li><strong>Parse：就是下文的词法分析 + 语法分析。</strong><ul><li>代码  --&gt; token --&gt; AST --&gt; 执行上下文</li></ul></li></ul><p><strong>Ignition 解释器</strong>：会将AST转换成ByteCode（<strong>字节码</strong>）</p><ul><li>同时会收集TurboFan优化所需要的信息（比如函数参数的类型信息，有了类型才能进行真实的运算）； </li><li>如果函数只调用一次，Ignition会执行解释执行ByteCode； </li></ul><p><strong>TurboFan 编译器</strong>：可以将字节码编译为CPU可以直接执行的 <strong>机器码</strong>；</p><ul><li>一个短时间内被多次调用的函数会被标记为 <strong>热函数</strong>，该函数就会经过TurboFan转换成优化的机器码，提高代码的执行性能； <ul><li>如在一个 for 循环中反复调用的无副作用的函数。</li></ul></li><li>但是，机器码实际上也会被还原为 ByteCode，这是因为如果后续执行函数的过程中，类型发生了变化（比如sum函数原来执行的是 number 类型，后来执行变成了 string 类型），之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码。所以，使用 ts 规范类型，一定程度上也会优化 js 的执行速度。</li><li>TurboFan的V8官方文档：<a href="https://v8.dev/blog/turbofan-jit" target="_blank" rel="noopener noreferrer">https://v8.dev/blog/turbofan-jit</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-js-的执行过程">2 Js 的执行过程<a class="hash-link" href="#2-js-的执行过程" title="标题的直接链接">​</a></h2><p>面对一个 Js 脚本，JavaScript 引擎在运行这段脚本会经历 2 个阶段，<strong>词法/语法分析</strong> 和 运行阶段。在运行阶段又划分为 <strong>编译时</strong> 和 <strong>运行时</strong>。这几个阶段的间隔时间会非常的短，可以理解为当引擎刚刚完成了词法分析，便会立刻开始编译阶段和运行阶段。而不像传统的 C，Java 等语言，编译阶段和运行阶段可以分开执行。</p><ul><li>C：源代码 <code>.c</code> ----<!-- -->[编译为]<!-- -->----&gt;  <code>.s</code> ----<!-- -->[汇编为]<!-- -->----&gt;  <code>.obj</code> ----------&gt;  <code>.exe</code> 可执行文件。</li><li>Java：源代码 <code>.java</code> ----<!-- -->[编译为]<!-- -->----&gt; <code>.class</code></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="21-三个阶段">2.1 三个阶段<a class="hash-link" href="#21-三个阶段" title="标题的直接链接">​</a></h3><p>JavaScript 的执行，一共有 3 个阶段：</p><p>主要是为了分析代码的语法是否正确，如果不正确会抛出语法错误（<code>syntaxError</code>）并停止执行代码。</p><ol><li><strong>词法分析（Tokenizing）</strong>。将代码拆分成具有意义的最小代码块，也称之为<strong>词法单元（token）</strong>，比如代码 <code>var a = 2;</code>，会拆分成： <code>var</code>，<code>a</code>，<code>=</code>，<code>2</code>，<code>;</code> 。</li><li><strong>语法分析（Parsing）</strong>。将词法单元流，按照语法结构转为 <strong>抽象语法树（Abstract Syntax Tree, AST）</strong>。转换后的抽象语法树，具有了逐级嵌套的树状结构。<ul><li>编译时，会通过 AST 构建执行上下文。</li></ul></li><li><strong>Ignition 生成字节码</strong><ul><li><code>TurboFan</code> 生成机器码：优化代码。</li></ul></li></ol><p><img loading="lazy" alt="img" src="/assets/images/1af282bdc4036096c03074da53eb84ae-39141daad1481e694de1d5202c1e63b2.png" width="1142" height="522" class="img_E7b_"></p><p>构建执行上下文：</p><ol><li><p>引擎根据抽象语法树分析代码的 <strong>词法作用域</strong>，进而形成 <strong>运行环境</strong>。一个运行环境，就是一个词法作用域。</p><p>引擎从 <strong>全局运行环境（全局词法作用域）</strong> 开始，进入每个运行环境（词法作用域）中。先编译，后运行该运行环境中的代码。运行完毕后，进入下一个运行环境。这样一直到所有运行环境执行完毕。</p></li><li><p>创建一个 <strong>调用栈 call stack</strong>。</p></li></ol><p>当进入某一个运行环境中，会进入：</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="211-编译时在词法阶段中">2.1.1 编译时（在词法阶段中）<a class="hash-link" href="#211-编译时在词法阶段中" title="标题的直接链接">​</a></h4><p>根据运行环境的词法作用域，创建 <strong>执行上下文（execution context）</strong>，并放入 <strong>调用栈（call stack）</strong>中。
栈底是 <strong>全局执行上下文（global execution context）</strong>，栈顶则是当前的执行上下文。</p><p>创建当前执行上下文，其基本结构如下：</p><ul><li><p><strong>variable environment 变量环境</strong></p><ul><li><strong>outer 外部环境</strong></li></ul></li><li><p><strong>lexical environment 词法环境</strong></p></li><li><p><strong>this value</strong></p></li></ul><p><strong>函数提升、变量提升、变量初始化赋值，工作在编译阶段完成。</strong></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="212-运行时">2.1.2 运行时<a class="hash-link" href="#212-运行时" title="标题的直接链接">​</a></h4><p>根据创建好的 <strong>当前执行上下文</strong>，开始逐次运行 <strong>当前运行环境</strong> 中的全部代码。</p><ul><li>当代码全部执行完毕后，弹出当前执行上下文。</li></ul><p>如果在代码执行中，遇到一个函数调用，会暂停当前执行上下文的执行，创建这个函数调用的执行上下文，把这个执行上下文压入 <strong>调用栈</strong> 中。此时会进入这个调用函数的编译和运行阶段，直到该函数内的全部代码执行完毕，弹出该执行上下文。</p><p>注意：不同的运行环境执行都会进入到 <strong>编译和执行两个阶段</strong>。而词法/语法分析阶段不区分运行环境，对全部代码进行解析。</p><p><img loading="lazy" alt="image-20210902171804797" src="/assets/images/image-20210902171804797-1620fa30cf052911eafac4f3c1867722.png" width="2713" height="1139" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-作用域-scope">2 作用域 scope<a class="hash-link" href="#2-作用域-scope" title="标题的直接链接">​</a></h2><p>作用域是一个区域，规定了代码中变量和函数的可访问范围。所以，作用域决定了变量和函数的可见性和生命周期。</p><p><img loading="lazy" alt="image-20210903121548301" src="/assets/images/image-20210903121548301-edd822660ad019ab33a06504f6abd772.png" width="1255" height="570" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="21-作用域的两种工作模型">2.1 作用域的两种工作模型<a class="hash-link" href="#21-作用域的两种工作模型" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="动态作用域">动态作用域<a class="hash-link" href="#动态作用域" title="标题的直接链接">​</a></h4><p>动态作用域中，对作用域的定义发生在 <strong>运行阶段</strong>。</p><p>动态作用域不关心函数和作用域是如何声明以及在何处声明的，只关心它们从<strong>何处调用</strong>。作用域链是基于调用栈的，而不是根据代码结构的作用域嵌套。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="词法作用域">词法作用域<a class="hash-link" href="#词法作用域" title="标题的直接链接">​</a></h4><p>词法作用域中，对作用域的定义发生在 <strong>词法分析阶段</strong>。
换句话说，每个变量都有一个对应它的词法作用域：无论函数在哪里被调用，无论如何调用，它的词法作用域都 <strong>只由函数被声明时所处的位置决定</strong>。</p><ul><li>词法作用域只查找一级标识符，如果存在这样一个代码：<code>foo.bar.baz.name</code> 。Js 引擎会通过词法作用域查找到 <code>foo</code>，剩余的查找工作会通过对象的属性访问去查找。</li><li>根据代码的层层结构，形成了作用域链。</li></ul><p>JavaScript 同绝大多数编程语言一样，使用静态的词法作用域。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="3-词法作用域">3 词法作用域<a class="hash-link" href="#3-词法作用域" title="标题的直接链接">​</a></h2><p>词法作用域就是指作用域是由代码中函数声明的位置来决定的，所以词法作用域是静态的作用域，通过它就能够预测代码在执行过程中如何查找标识符。</p><p><strong>词法作用域是代码编译阶段就决定好的，和函数是怎么调用的没有关系。</strong></p><p><img loading="lazy" alt="imgx" src="/assets/images/image-20210905000728729-ff3ed6b5dd10060348ace267f0e04003.png" width="1523" height="1150" class="img_E7b_"></p><p>词法作用域的划分：</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="全局作用域">全局作用域<a class="hash-link" href="#全局作用域" title="标题的直接链接">​</a></h4><p>全局作用域中的对象在代码中的任何地方都能访问。随着代码的执行完毕，生命周期结束。全局作用域在一个完整的代码脚本中，有且只有一个。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="函数作用域">函数作用域<a class="hash-link" href="#函数作用域" title="标题的直接链接">​</a></h4><p>一个函数内部，便是一个函数作用域。函数内部定义的变量会随着函数执行结束而销毁。</p><p>闭包</p><p>是一个变量的集合。也是一个函数作用域。当一个执行完毕的函数，本应被销毁，但其内部定义的变量引用，依然其他作用域持有。为了节省开销，JS 引擎会销毁这个函数自身绝大多数的内容（这些内容只要不影响这些被引用的变量，都会被销毁）。而这些没有被销毁的、被引用的变量所组成的集合，就是闭包。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="块级作用域">块级作用域<a class="hash-link" href="#块级作用域" title="标题的直接链接">​</a></h4><p>使用一对大括号包裹的一段代码，比如函数、判断语句、循环语句、try /catch / finally，单独的一个 <code>{}</code> 都被看作是一个块级作用域。</p><p>块级作用域限制 <code>let</code> 和 <code>const</code> 变量的可访问范围；不限制 <code>var</code> 变量和 <code>function</code> 函数的可访问范围。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="分析打印结果">分析打印结果<a class="hash-link" href="#分析打印结果" title="标题的直接链接">​</a></h2><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> myName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Ninjee&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> myName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Moxy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Moxy</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>原因：</p><p>根据作用域链，bar 和 foo 两个函数作用域都在全局作用域中。作用域的判定是函数声明的位置。可以看到，这两个函数的声明没有嵌套的关系，所以两个函数的作用域也没有嵌套关系。</p><p>代码中，bar 在 foo 的内部调用，在函数调用上出现了嵌套关系，误导了作用域的判断。</p><p>需要记住：<strong>作用域链和执行上下文栈完全是两套逻辑</strong>；前者在词法分析阶段被确定，后者在编译时和运行时被确定。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="引用">引用<a class="hash-link" href="#引用" title="标题的直接链接">​</a></h2><blockquote><p>《你不知道的JavaScript》</p><p>winter - 重学前端</p><p>李兵 - 浏览器工作原理与实战</p><p>coderwhy - JavaScript 高级语法课</p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/java-script">JavaScript</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/frontEnd/JavaScript/DOM&amp;BOM/3 弹窗、网络请求、存储"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Frame、Window、网络请求、存储</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/frontEnd/JavaScript/执行上下文"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">2. 执行上下文</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-基础" class="table-of-contents__link toc-highlight">1 基础</a><ul><li><a href="#11-浏览器内核" class="table-of-contents__link toc-highlight">1.1 浏览器内核</a></li><li><a href="#12-javascript-引擎" class="table-of-contents__link toc-highlight">1.2 JavaScript 引擎</a><ul><li><a href="#121-常见的-javascript-引擎" class="table-of-contents__link toc-highlight">1.2.1 常见的 JavaScript 引擎</a></li></ul></li><li><a href="#13-浏览器内核--js-引擎" class="table-of-contents__link toc-highlight">1.3 浏览器内核 + JS 引擎</a></li><li><a href="#14-v8-引擎" class="table-of-contents__link toc-highlight">1.4 V8 引擎</a></li></ul></li><li><a href="#2-js-的执行过程" class="table-of-contents__link toc-highlight">2 Js 的执行过程</a><ul><li><a href="#21-三个阶段" class="table-of-contents__link toc-highlight">2.1 三个阶段</a><ul><li><a href="#211-编译时在词法阶段中" class="table-of-contents__link toc-highlight">2.1.1 编译时（在词法阶段中）</a></li><li><a href="#212-运行时" class="table-of-contents__link toc-highlight">2.1.2 运行时</a></li></ul></li></ul></li><li><a href="#2-作用域-scope" class="table-of-contents__link toc-highlight">2 作用域 scope</a><ul><li><a href="#21-作用域的两种工作模型" class="table-of-contents__link toc-highlight">2.1 作用域的两种工作模型</a><ul><li><a href="#动态作用域" class="table-of-contents__link toc-highlight">动态作用域</a></li><li><a href="#词法作用域" class="table-of-contents__link toc-highlight">词法作用域</a></li></ul></li></ul></li><li><a href="#3-词法作用域" class="table-of-contents__link toc-highlight">3 词法作用域</a><ul><li><a href="#全局作用域" class="table-of-contents__link toc-highlight">全局作用域</a></li><li><a href="#函数作用域" class="table-of-contents__link toc-highlight">函数作用域</a></li><li><a href="#块级作用域" class="table-of-contents__link toc-highlight">块级作用域</a></li></ul></li><li><a href="#分析打印结果" class="table-of-contents__link toc-highlight">分析打印结果</a></li><li><a href="#引用" class="table-of-contents__link toc-highlight">引用</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">分享</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/frontEnd/JavaScript">前端</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/code/algorithm">算法笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">我的项目</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/moxyNJ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/user/2005151873514024" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a href="https://www.ninjee.co" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ninjee 的前端篮子</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p>Copyright © 2022 Ninjee Built with Docusaurus.</p><p><a href="http://beian.miit.gov.cn/">晋ICP备2021017941号-2</a></p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.274f5201.js"></script>
<script src="/assets/js/main.fe74e720.js"></script>
</body>
</html>