<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-frontEnd/浏览器原理/页面循环系统">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="ninjee RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="ninjee Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="ninjee JSON Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Ninjee的前端篮子" href="/opensearch.xml">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0930342e569f854bebdeb485c0eac7f8",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<link rel="icon" href="/img/ninjee.jpeg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><title data-rh="true">3. 页面循环系统 - Ninjee的前端篮子</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ninjee.netlify.app/img/ninjee.jpeg"><meta data-rh="true" name="twitter:image" content="https://ninjee.netlify.app/img/ninjee.jpeg"><meta data-rh="true" property="og:url" content="https://ninjee.netlify.app/docs/frontEnd/浏览器原理/页面循环系统"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="keywords" content="Moxy, Ninjee, blog, javascript, typescript, python ,node, react, vue, web, 前端, 后端"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="3. 页面循环系统 - Ninjee的前端篮子"><meta data-rh="true" name="description" content="问题1：简述：消息队列和任务循环系统"><meta data-rh="true" property="og:description" content="问题1：简述：消息队列和任务循环系统"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ninjee.netlify.app/docs/frontEnd/浏览器原理/页面循环系统"><link data-rh="true" rel="alternate" href="https://ninjee.netlify.app/docs/frontEnd/浏览器原理/页面循环系统" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ninjee.netlify.app/docs/frontEnd/浏览器原理/页面循环系统" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://AJRH2JRXVY-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.cb2f47c4.css">
<link rel="preload" href="/assets/js/runtime~main.4270dd94.js" as="script">
<link rel="preload" href="/assets/js/main.0ca0efc8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ninjee-icon.png" alt="ninjee" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/ninjee-icon.png" alt="ninjee" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Ninjee</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端知识</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/frontEnd/JavaScript">JavaScript</a></li><li><a class="dropdown__link" href="/docs/frontEnd/HTML&amp;CSS">HTML &amp; CSS</a></li><li><a class="dropdown__link" href="/docs/frontEnd/React">React</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/frontEnd/浏览器原理">浏览器原理</a></li><li><a class="dropdown__link" href="/docs/frontEnd/other">other</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">敲代码</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/code/algorithm">算法</a></li><li><a class="dropdown__link" href="/docs/code/writtenJs">手写Js</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">面试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/interview/summary">总结</a></li><li><a class="dropdown__link" href="/docs/interview/iot">物联网</a></li></ul></div><a class="navbar__item navbar__link" href="/project">我的项目</a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/javascript">JavaScript</a><button aria-label="打开/收起侧边栏菜单「JavaScript」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/html--css">HTML &amp; CSS</a><button aria-label="打开/收起侧边栏菜单「HTML &amp; CSS」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/react">React</a><button aria-label="打开/收起侧边栏菜单「React」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/浏览器原理">浏览器原理</a><button aria-label="打开/收起侧边栏菜单「浏览器原理」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/浏览器原理">1. Chrome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/frontEnd/浏览器原理/存储机制">2. 存储机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/frontEnd/浏览器原理/页面循环系统">3. 页面循环系统</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/other">other</a><button aria-label="打开/收起侧边栏菜单「other」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/algorithm">algorithm</a><button aria-label="打开/收起侧边栏菜单「algorithm」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/手写-js">手写 Js</a><button aria-label="打开/收起侧边栏菜单「手写 Js」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/总结">总结</a><button aria-label="打开/收起侧边栏菜单「总结」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_FykI"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_DTRl"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/浏览器原理"><span itemprop="name">浏览器原理</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">3. 页面循环系统</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>3. 页面循环系统</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="问题1简述消息队列和任务循环系统">问题1：简述：消息队列和任务循环系统<a class="hash-link" href="#问题1简述消息队列和任务循环系统" title="标题的直接链接">​</a></h2><p><strong>浏览器页面是由消息队列和事件循环系统来驱动的。</strong></p><p>每个渲染进程都有一个主线程，并且主线程非常繁忙，既要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript 任务以及各种输入事件。</p><p>要让这么多不同类型的任务在主线程中有条不紊地执行，这就需要一个系统来统筹调度这些任务，这个统筹调度系统就是 <strong>消息队列和事件循环系统</strong>。</p><p><img loading="lazy" alt="image-20220814221037733" src="/assets/images/image-20220814221037733-5baa818ce825313c979182836b13c9d1.png" width="1142" height="834" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="事件循环机制">事件循环机制<a class="hash-link" href="#事件循环机制" title="标题的直接链接">​</a></h3><p>可以想象成线程是一个 <code>for</code> 循环语句，会一直循环执行。在线程运行过程中，一直等待事件触发，比如在等待用户输入的数字，一旦接收到用户输入信息，那么线程就会背激活，然后执行相加运算，最后输出结果。</p><p><img loading="lazy" alt="image-20220814221044845" src="/assets/images/image-20220814221044845-99ef84a16c457835268e2594dcf0f265.png" width="1142" height="673" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="消息队列">消息队列<a class="hash-link" href="#消息队列" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="image-20220814221059324" src="/assets/images/image-20220814221059324-5baa818ce825313c979182836b13c9d1.png" width="1142" height="834" class="img_E7b_"></p><p><strong>消息队列</strong> 是一个队列数据结构，存放了主线程要执行的任务。符合队列的先进先出特点。</p><p>渲染进程专门有一个 <strong>IO 线程</strong> 用来接收其他进程传进来的消息，接收到消息之后，会将这些消息组装成任务发送给渲染主线程。</p><p><strong>IO线程</strong> 往队列尾部添加任务，等待执行；<strong>主线程</strong> 从队列头部取出任务，并执行。</p><p>跨进程通信称为 <code>IPC</code>（Inter-Process Communication，进程间通信）。</p><p>利用 IPC，IO线程接收到来自网络进程发来的资源加载完成信息、来自浏览器进程发来的用户鼠标点击信息，然后添加到消息队列中，等待主线程将它们处理。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="系统调用栈">系统调用栈<a class="hash-link" href="#系统调用栈" title="标题的直接链接">​</a></h3><p>是当循环系统在执行一个任务的时候，都要为这个任务维护一个 <strong>系统调用栈</strong>。</p><p>这个系统调用栈类似于 JavaScript 的调用栈，只不过是 Chromium 的开发语言 C++ 来维护的。其完整的调用栈信息可以通过 <code>chrome://tracing/</code> 来抓取。当然，你也可以通过 <code>Performance</code> 来抓取它核心的调用信息，如下图所示：</p><p><img loading="lazy" alt="image-20220814221114838" src="/assets/images/image-20220814221114838-305a48f14b2556b5340702a5e9b1dc53.png" width="1142" height="205" class="img_E7b_"></p><p>这幅图记录了一个 Parse HTML 的任务执行过程，其中黄色的条目表示执行 JavaScript 的过程，其他颜色的条目表示浏览器内部系统的执行过程。</p><p>Parse HTML 任务在执行过程中会遇到一系列的子过程：比如在解析页面的过程中遇到了 JavaScript 脚本，那么就暂停解析过程去执行该脚本，等执行完成之后，再恢复解析过程。然后又遇到了样式表，这时候又开始解析样式表……直到整个任务执行完成。</p><p><strong>每个任务在执行过程中都有自己的调用栈。</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="问题2为什么要设计宏任务和微任务">问题2：为什么要设计宏任务和微任务？<a class="hash-link" href="#问题2为什么要设计宏任务和微任务" title="标题的直接链接">​</a></h2><p>宏任务和微任务的加入，使任务执行实现了 <strong>效率</strong> 和 <strong>实时性</strong> 的平衡。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="1-什么是宏任务与微任务">1 什么是宏任务与微任务<a class="hash-link" href="#1-什么是宏任务与微任务" title="标题的直接链接">​</a></h3><p>在渲染进程中，把消息队列中的任务称为 <strong>宏任务</strong>，每个宏任务中都包含了一个 <strong>微任务队列</strong>。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-宏任务">1 宏任务<a class="hash-link" href="#1-宏任务" title="标题的直接链接">​</a></h2><p>典型的触发宏任务的两种 WebAPI：</p><ul><li><code>setTimeout</code>：在进程内，将延迟触发的回调函数放入延迟队列中，在每个宏任务执行完毕后遍历延迟队列，寻找到期的任务，并执行。</li><li><code>XMLHttpRequest</code>：渲染进程的 IO 线程，通过 IPC 和网络进程沟通，通知网络进程去服务器请求资源。当返回资源后，渲染进程的 IO 线程把返回情况（成功？失败？故障？）封装为一个任务放在任务队列末尾。主线程执行该宏任务时，根据返回状态来调用对应的回调函数。</li></ul><p>宏任务主要包括了：</p><ul><li>渲染事件（如解析 DOM、计算布局、绘制）；</li><li>用户交互事件（如鼠标点击、滚动页面、放大缩小等）；</li><li>JavaScript 脚本执行事件；</li><li>网络请求完成、文件读写完成事件。</li></ul><p>渲染进程内部会维护多个消息队列，在 Chrome 中主要有两个：<strong>延迟执行队列</strong> 和 <strong>消息队列</strong>。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-微任务">2 微任务<a class="hash-link" href="#2-微任务" title="标题的直接链接">​</a></h2><p>微任务就是一个需要异步执行的函数，执行时机是在主函数执行结束之后、当前宏任务结束之前。</p><p>当 JavaScript 执行一段脚本的时候，V8 会为其创建一个全局执行上下文，在创建全局执行上下文的同时，V8 引擎也会在内部创建一个 <strong>微任务队列</strong>。</p><p><strong>在当前宏任务执行的过程中，有时候会产生多个微任务，按序保存在微任务队列中。</strong></p><p>微任务的产生有两种：</p><ul><li>使用 <code>MutationObserver</code> 监控某个 DOM 节点。目的是为了根据节点变化，通过 JavaScript 来修改节点、添加或删除部分子节点。当 DOM 节点发生变化时，就会产生 DOM 变化记录的微任务。</li><li>使用 <code>Promise</code>。当调用 <code>Promise.resolve()</code> 或者 <code>Promise.reject()</code> 的时候，产生微任务。</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="3-执行流程">3 执行流程：<a class="hash-link" href="#3-执行流程" title="标题的直接链接">​</a></h3><p>在主线程在执行一个宏任务时，</p><ol><li>产生的微任务会被添加到这个宏任务的微任务队列中；</li><li>产生的宏任务会被添加到消息队列的末端；</li></ol><p>在执行完这个宏任务时，<strong>不是直接退出去执行下一个宏任务</strong>，而是：</p><ol><li>查看这个宏任务的微任务队列中，是否有微任务等待执行。</li><li>如果有，则按序执行微任务队列中的任务。<ul><li>如果在执行微任务过程中产生了新的微任务，则添加到 <strong>当前微任务队列</strong> 的队尾；</li></ul></li></ol><p>直到当前微任务队列中所有任务被执行完毕，退出当前宏任务，去执行下一个宏任务。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="31-检查点">3.1 检查点<a class="hash-link" href="#31-检查点" title="标题的直接链接">​</a></h4><p>在当前宏任务中的 JavaScript 快执行完成时，也就在 JavaScript 引擎准备退出全局执行上下文并清空调用栈的时候，JavaScript 引擎会检查全局执行上下文中的微任务队列，然后按照顺序执行队列中的微任务。<strong>WHATWG 把执行微任务的时间点称为检查点。</strong></p><ul><li>如果在执行微任务过程中产生了新的微任务，则添加到 <strong>当前微任务队列</strong> 的队尾；<strong>V8 引擎一直循环执行微任务队列中的任务，直到队列为空才算执行结束。</strong></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="32-举例">3.2 举例：<a class="hash-link" href="#32-举例" title="标题的直接链接">​</a></h4><p><img loading="lazy" alt="image-20220814221126049" src="/assets/images/image-20220814221126049-983a8060069dfdac8cd1ee9cdcea9fef.png" width="1142" height="466" class="img_E7b_"></p><p><img loading="lazy" alt="image-20220814221132679" src="/assets/images/image-20220814221132679-46dfa6819007525b12abdab618d150b2.png" width="1142" height="476" class="img_E7b_"></p><p>上面两个图是在执行一个 ParseHTML 的宏任务。</p><p>在执行过程中，遇到了 JavaScript 脚本，那么就暂停解析流程，进入到 JavaScript 的执行环境。</p><ol><li>在 JavaScript 执行中，分别通过 <code>Promise</code> 和 <code>removeChild</code> 创建了两个微任务；</li><li>这两个微任务按序添加到微任务列表中；</li><li>当 JavaScript 执行结束，准备退出全局执行上下文时，到了 <strong>检查点</strong>，JavaScript 引擎会检查微任务列表；</li><li>JS 引擎发现列表有微任务，，依次执行这两个微任务。</li><li>JS 引擎继续检查微任务列表，发现队列清空之后，退出全局执行上下文。</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="细节">细节：<a class="hash-link" href="#细节" title="标题的直接链接">​</a></h4><ul><li><p>微任务和宏任务是绑定的，每个宏任务在执行时，会创建自己的微任务队列。</p></li><li><p>微任务的执行时长会影响到当前宏任务的时长。</p><ul><li>比如一个宏任务在执行过程中，产生了 100 个微任务，执行每个微任务的时间是 10 毫秒，那么执行这 100 个微任务的时间就是 1000 毫秒，也可以说这 100 个微任务让宏任务的执行时间延长了 1000 毫秒。</li></ul></li><li><p>在一个宏任务中，分别创建一个用于回调的宏任务和微任务，无论什么情况下，微任务都早于宏任务执行。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-解决高优先级的任务">2 解决高优先级的任务<a class="hash-link" href="#2-解决高优先级的任务" title="标题的直接链接">​</a></h3><p>在执行宏任务的过程中，如果有高优先级的任务需要先处理，则就把这个任务添加到当前宏任务的微任务队列中，这样既不会影响到对宏人物的继续执行（<strong>效率</strong>），有保证了高优先级任务先被执行（<strong>实施性</strong>）。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="举例">举例：<a class="hash-link" href="#举例" title="标题的直接链接">​</a></h4><p>一个典型的场景是监控 DOM 节点的变化情况（节点的插入、修改、删除等动态变化），然后根据这些变化来处理相应的业务逻辑。一个通用的设计的是，利用 JavaScript 设计一套监听接口，当变化发生时，渲染引擎同步调用这些接口，这是一个典型的观察者模式。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="3-解决单个任务执行时间过长">3 解决单个任务执行时间过长<a class="hash-link" href="#3-解决单个任务执行时间过长" title="标题的直接链接">​</a></h3><p>所有的任务都是在 <strong>单线程</strong> 中执行的，所以每次只能执行一个任务，而其他任务就都处于等待状态。如果其中一个任务执行时间过久，那么下一个任务就要等待很长时间。可以参考下图：</p><p><img loading="lazy" alt="image-20220814221139524" src="/assets/images/image-20220814221139524-33142a1b52b4caeda43bced9793ee6eb.png" width="1142" height="428" class="img_E7b_"></p><p>如果在执行动画过程中，其中有个 JavaScript 任务因执行时间过久，占用了动画单帧的时间，这样会给用户制造了卡顿的感觉。针对这种情况，JavaScript 可以通过 <strong>回调</strong> 功能来规避这种问题，也就是让要执行的 JavaScript 任务滞后执行。通过回调，</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="问题3settimeout-是如何实现的">问题3：<code>setTimeOut</code> 是如何实现的？<a class="hash-link" href="#问题3settimeout-是如何实现的" title="标题的直接链接">​</a></h2><p><code>setTimeOut</code> 是一个定时器，用来指定某个函数在多少毫秒之后执行。</p><p>它会返回一个整数，表示定时器的编号，同时你还可以通过该编号来取消这个定时器。</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">showName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;MMMM&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> timerID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">showName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>我们直到，消息队列中的任务是按序执行的；而通过定时器设置的回调函数需要在指定的时间间隔后被调用，无法直接放置在消息队列中。</p><p>为了保证回调函数能在指定时间内执行，Chrome 中还有一个 <strong>延迟队列</strong>，这个队列中维护了需顺从延迟执行的任务列表，包括了定时器和 Chromium 内部一些需要延迟执行的任务。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="延迟队列">延迟队列<a class="hash-link" href="#延迟队列" title="标题的直接链接">​</a></h4><p><strong>当通过 JavaScript 创建一个定时器时，渲染进程会将该定时器的回调任务添加到延迟队列中。</strong></p><p>当通过 JavaScript 调用 <code>setTimeout</code> 设置回调函数的时候，渲染进程将会创建一个回调任务，包含了回调函数、当前发起时间、延迟执行时间。</p><p>延迟队列是一个 hashmap 结构，等到执行这个结构的时候，会计算 hashmap 中的每个任务是否到期了，到期了就去执行，直到所有到期的任务都执行结束，才会进入下一轮循环：</p><p>当主进程处理完消息队列中的一个任务（完整的宏任务）之后，就开始处理延迟队列中的任务：</p><ol><li>根据 <code>当前时间</code> ≤ <code>发起时间</code> + <code>延迟时间</code>，计算出到期的任务，</li><li>依次执行这些到期的任务，</li><li>到期任务执行完毕后，继续下一个循环，执行消息队列中下一个任务。</li></ol><p>所以，延迟队列中的到期的任务，需要等待当前执行的任务执行完毕才能被执行，并不是一旦到期就立刻被执行。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="settimeout-的注意事项">setTimeOut 的注意事项：<a class="hash-link" href="#settimeout-的注意事项" title="标题的直接链接">​</a></h4><ol><li><p>如果主线程中当前任务执行时间过久，导致定时器设置的任务被延后执行</p><ul><li>最终导致回调函数执行比设定的预期值要久。</li></ul></li><li><p>如果 <code>setTimeout</code> 存在嵌套调用，那么系统会设置最短时间间隔为 4 毫秒。</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>在 Chrome 中，定时器被嵌套调用 5 次以上，系统会判断该函数方法被阻塞了，如果定时器的调用时间间隔小于 4 毫秒，那么浏览器会将每次调用的时间间隔设置为 4 毫秒。</li></ul></li><li><p>未激活的页面，<code>setTimeout</code> 执行最小间隔是 1000 毫秒。</p><ul><li>目的是为了优化后台页面的加载损耗以及降低耗电量。</li></ul></li><li><p>延时执行时间有最大值。</p><ul><li>Chrome、Safari、Firefox 都是以 32 个 bit 来存储延时值的，<code>32bit</code> 最大只能存放的数字是 <code>2147483647</code> 毫秒，这就意味着，如果 <code>setTimeout</code> 设置的延迟值大于 <code>2147483647</code> 毫秒（大约 24.8 天）时就会溢出，那么相当于延时值被设置为 0 了，这导致定时器会被 <strong>立即执行</strong>。</li></ul></li><li><p>使用 <code>setTimeout</code> 设置的回调函数中的 <code>this</code> 不符合直觉。</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="问题4同步回调异步回调是什么意思">问题4：同步回调、异步回调是什么意思？<a class="hash-link" href="#问题4同步回调异步回调是什么意思" title="标题的直接链接">​</a></h2><p>每个任务在执行过程中都有自己的调用栈，</p><p><strong>同步回调</strong> 就是在当前主函数的上下文中执行回调函数：</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">callback</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;i am do homework&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doWork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;start do work&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;end do work&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">doWork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// start do work</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// i am do homework</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// end do work</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>异步回调</strong> 是指回调函数在主函数之外执行，一般有两种方式：</p><ul><li>第一种是把异步函数做成一个任务（宏任务），添加到消息队列的尾部；</li><li>第二种是把异步函数做成一个微任务，添加到当前任务的微任务队列中。</li></ul><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">callback</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;i am do homework&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doWork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;start do work&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//异步回调</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;end do work&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">doWork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// start do work</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// end do work</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// i am do homework</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="问题5xmlhttprequest-如何使用">问题5：<code>XMLHttpRequest</code> 如何使用？<a class="hash-link" href="#问题5xmlhttprequest-如何使用" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="什么是-xmlhttprequest-">什么是 <code>XMLHttpRequest</code> ？<a class="hash-link" href="#什么是-xmlhttprequest-" title="标题的直接链接">​</a></h3><p><code>XMLHttpRequest</code> 提供了从 Web 服务器获取数据的能力。</p><p>如果你想要更新某条数据，只需要通过 <code>XMLHttpRequest</code> 请求服务器提供的接口，就可以获取到服务器的数据，然后再操作 DOM 来更新页面内容。</p><p>整个过程只需要更新网页的一部分就可以了，而不用像之前那样还得刷新整个页面，这样既有效率又不会打扰到用户。</p><p><img loading="lazy" alt="image-20220814221157515" src="/assets/images/image-20220814221157515-8eb62a9d241a61f47266bfa4e9331551.png" width="1142" height="523" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="如何使用-xmlhttprequest-">如何使用 <code>XMLHttpRequest</code> ？<a class="hash-link" href="#如何使用-xmlhttprequest-" title="标题的直接链接">​</a></h3><p>XMLHttpRequest 工作流程图如下：</p><p><img loading="lazy" alt="image-20220814221202741" src="/assets/images/image-20220814221202741-8eb62a9d241a61f47266bfa4e9331551.png" width="1142" height="523" class="img_E7b_"></p><p>请求代码：</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetWebData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter constant" style="color:#36acaa">URL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 1:新建XMLHttpRequest请求对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> xhr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">XMLHttpRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 2:注册相关事件回调处理函数 </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">onreadystatechange</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">switch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">readyState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//请求未初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;请求未初始化&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token constant" style="color:#36acaa">OPENED</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;OPENED&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token constant" style="color:#36acaa">HEADERS_RECEIVED</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;HEADERS_RECEIVED&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token constant" style="color:#36acaa">LOADING</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;LOADING&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token constant" style="color:#36acaa">DONE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token operator" style="color:#393A34">||</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responseText</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;DONE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">ontimeout</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;ontimeout&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">onerror</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;onerror&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 3:打开请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Get&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">URL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">//创建一个Get请求,采用异步</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 4:配置参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timeout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//设置xhr请求的超时时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responseType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//设置响应返回的数据格式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setRequestHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;X_TEST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;time.geekbang&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 5:发送请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xhr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>具体流程如下：</p><p><strong>第一步：创建 XMLHttpRequest 对象 xhr。</strong></p><p><strong>第二步：为 xhr 对象注册回调函数。</strong></p><p>通过异步回调，等待网络进程获取结果后，通过调用回调函数来告诉其执行结果。</p><p><code>XMLHttpRequest</code> 的回调函数主要有下面几种：</p><ul><li><p><code>onreadystatechange</code>，用来监控后台请求过程中的状态。比如监控 HTTP 头加载完成的消息、HTTP 响应体消息、数据加载完成的消息。</p><ul><li><code>0</code>：尚未初始化 对应 <code>XMLHttpRequest.UNSENT</code> </li><li><code>1</code>：正在加载 对应 <code>XMLHttpRequest.OPENED</code> </li><li><code>2</code>：加载完毕 对应 <code>XMLHttpRequest.HEADERS_RECEIVED</code> </li><li><code>3</code>：正在处理  对应 <code>XMLHttpRequest.LOADING</code> </li><li><code>4</code>：处理完毕  对应 <code>XMLHttpRequest.DONE</code></li></ul></li><li><p><code>ontimeout</code>，用来监控超时请求，如果后台请求超时了，该函数会被调用；</p></li><li><p><code>onerror</code>，用来监控出错信息，如果后台请求出错了，该函数会被调用；</p></li></ul><p><strong>第三步：打开请求。</strong></p><p><strong>第四步：配置基础的请求信息。</strong></p><ol><li><p>要通过 <code>open</code> 接口配置基础的请求信息。</p><ul><li>包括请求的地址、请求方法（是 <code>get</code> 还是 <code>post</code>）和请求方式（同步还是异步请求）。</li></ul></li><li><p>通过 <code>xhr</code> 内部属性类配置一些其他可选的请求信息，比如：</p><ul><li><p><code>xhr.timeout = 3000</code> 来配置超时时间；</p></li><li><p><code>xhr.responseType = &quot;text&quot;</code> 配置服务器返回的格式为 <code>text</code>。</p></li><li><p><code>xhr.setRequestHeader</code> 添加自己专用的请求头属性。</p></li><li><p>下表是更多格式信息：</p><p><img loading="lazy" alt="image-20220814221213105" src="/assets/images/image-20220814221213105-4cab6b71a09291dfc660d5ec0fb7178d.png" width="1142" height="590" class="img_E7b_"></p></li></ul></li></ol><p><strong>第四步：发起请求。</strong></p><p>发起网络请求后，</p><ol><li>渲染进程会将请求发送给网络进程，网络进程负责资源的下载；</li><li>等网络进程接收到数据之后，通过 IPC 来通知渲染进程的 IO线程；</li><li>IO线程接收到消息之后，会把 <code>xhr</code> 的回调函数封装成任务，并添加到消息队列尾部；</li><li>主线程循环系统执行到该任务的时候，就会根据相关的状态来调用对应的回调函数。<ul><li>如果 <strong>网络请求出错了</strong>，就会执行 <code>xhr.onerror</code>；</li><li>如果 <strong>超时了</strong>，就会执行 <code>xhr.ontimeout</code>；</li><li>如果是 <strong>正常的数据接收</strong>，就会执行 <code>onreadystatechange</code> 来反馈相应的状态。</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="使用-xmlhttprequest-避免的问题">使用 <code>XMLHttpRequest</code> 避免的问题：<a class="hash-link" href="#使用-xmlhttprequest-避免的问题" title="标题的直接链接">​</a></h3><p><strong>1 跨域问题</strong></p><p>默认情况下，跨域请求是不被允许的：</p><p><img loading="lazy" alt="image-20210922200948700" src="/assets/images/image-20210922200948700-9e9ff1b8e44c621fc805046781d6884b.png" width="442" height="191" class="img_E7b_"></p><p><strong>2 HTTPS 混合内容</strong></p><ul><li>HTTPS 混合内容是 HTTPS 页面中包含了不符合 HTTPS 安全要求的内容，比如包含了 HTTP 资源，通过 HTTP 加载的图像、视频、样式表、脚本等，都属于混合内容。</li></ul><p><img loading="lazy" alt="image-20220814221227582" src="/assets/images/image-20220814221227582-854bdb0f1d11e9d91e7dc225e76a789b.png" width="1142" height="517" class="img_E7b_"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/java-script">JavaScript</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/frontEnd/浏览器原理/存储机制"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">2. 存储机制</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/category/other"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">other</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#问题1简述消息队列和任务循环系统" class="table-of-contents__link toc-highlight">问题1：简述：消息队列和任务循环系统</a><ul><li><a href="#事件循环机制" class="table-of-contents__link toc-highlight">事件循环机制</a></li><li><a href="#消息队列" class="table-of-contents__link toc-highlight">消息队列</a></li><li><a href="#系统调用栈" class="table-of-contents__link toc-highlight">系统调用栈</a></li></ul></li><li><a href="#问题2为什么要设计宏任务和微任务" class="table-of-contents__link toc-highlight">问题2：为什么要设计宏任务和微任务？</a><ul><li><a href="#1-什么是宏任务与微任务" class="table-of-contents__link toc-highlight">1 什么是宏任务与微任务</a></li></ul></li><li><a href="#1-宏任务" class="table-of-contents__link toc-highlight">1 宏任务</a></li><li><a href="#2-微任务" class="table-of-contents__link toc-highlight">2 微任务</a><ul><li><a href="#3-执行流程" class="table-of-contents__link toc-highlight">3 执行流程：</a><ul><li><a href="#31-检查点" class="table-of-contents__link toc-highlight">3.1 检查点</a></li><li><a href="#32-举例" class="table-of-contents__link toc-highlight">3.2 举例：</a></li><li><a href="#细节" class="table-of-contents__link toc-highlight">细节：</a></li></ul></li><li><a href="#2-解决高优先级的任务" class="table-of-contents__link toc-highlight">2 解决高优先级的任务</a><ul><li><a href="#举例" class="table-of-contents__link toc-highlight">举例：</a></li></ul></li><li><a href="#3-解决单个任务执行时间过长" class="table-of-contents__link toc-highlight">3 解决单个任务执行时间过长</a></li></ul></li><li><a href="#问题3settimeout-是如何实现的" class="table-of-contents__link toc-highlight">问题3：<code>setTimeOut</code> 是如何实现的？</a><ul><li><a href="#延迟队列" class="table-of-contents__link toc-highlight">延迟队列</a></li><li><a href="#settimeout-的注意事项" class="table-of-contents__link toc-highlight">setTimeOut 的注意事项：</a></li></ul></li><li><a href="#问题4同步回调异步回调是什么意思" class="table-of-contents__link toc-highlight">问题4：同步回调、异步回调是什么意思？</a></li><li><a href="#问题5xmlhttprequest-如何使用" class="table-of-contents__link toc-highlight">问题5：<code>XMLHttpRequest</code> 如何使用？</a><ul><li><a href="#什么是-xmlhttprequest-" class="table-of-contents__link toc-highlight">什么是 <code>XMLHttpRequest</code> ？</a></li><li><a href="#如何使用-xmlhttprequest-" class="table-of-contents__link toc-highlight">如何使用 <code>XMLHttpRequest</code> ？</a></li><li><a href="#使用-xmlhttprequest-避免的问题" class="table-of-contents__link toc-highlight">使用 <code>XMLHttpRequest</code> 避免的问题：</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">分享</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/frontEnd/JavaScript">前端</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/code/algorithm">算法笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">我的项目</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/moxyNJ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/user/2005151873514024" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a href="https://www.ninjee.co" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ninjee 的前端篮子</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p>Copyright © 2022 Ninjee Built with Docusaurus.</p><p><a href="http://beian.miit.gov.cn/">晋ICP备2021017941号-2</a></p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4270dd94.js"></script>
<script src="/assets/js/main.0ca0efc8.js"></script>
</body>
</html>