### ğŸŠ ç»„ä»¶é—´çš„é€šä¿¡æ–¹å¼ï¼ˆ8ç§ï¼‰

çˆ¶ç»„ä»¶ => å­ç»„ä»¶ï¼š

1. Props
2. Refs

å­ç»„ä»¶ => çˆ¶ç»„ä»¶ï¼š

1. Callback Function
2. Event Bubbling äº‹ä»¶å†’æ³¡

å…„å¼Ÿç»„ä»¶ä¹‹é—´ï¼š

1. Parent Componentï¼šå…±åŒç¥–å…ˆ

ä¸å¤ªç›¸å…³çš„ç»„ä»¶ä¹‹é—´ï¼š

1. Context
4. è§‚å¯Ÿè€…æ¨¡å¼ Event Bus
5. Redux ç­‰



**ï¼ˆ1ï¼‰props + Callback Function**

1. ã€çˆ¶ç»„ä»¶ã€‘ç»™ã€å­ç»„ä»¶ã€‘ä¼ é€’æ•°æ®ï¼šé€šè¿‡ `props` ä¼ é€’
2. ã€å­ç»„ä»¶ã€‘ç»™ã€çˆ¶ç»„ä»¶ã€‘ä¼ é€’æ•°æ®ï¼šé€šè¿‡ `props` ä¼ é€’ï¼Œè¦æ±‚çˆ¶å­ç»„ä»¶ç»™å­ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå­ç»„ä»¶é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠæ•°æ®ä¼ é€’ç»™çˆ¶ç»„ä»¶ã€‚
   - åœ¨å‡½æ•°ç»„ä»¶ä¸­çš„ hooksï¼ŒuseState åˆ›å»ºçš„ `setCount()` ï¼Œä¼ é€’ç»™å­ç»„ä»¶ã€‚

éœ€è¦ä½¿ç”¨ shallowEqual ä¼˜åŒ–ï¼Œé˜²æ­¢å­ç»„ä»¶é¢‘ç¹æ¸²æŸ“ï¼š

- å‡½æ•°ç»„ä»¶ï¼Œmemo åŒ…è£¹å­ç»„ä»¶ + useMemo å€¼ + useCallback å‡½æ•°ï¼›
- ç±»ç»„ä»¶ï¼ŒPureComponent ç»§æ‰¿ã€‚



**ï¼ˆ2ï¼‰Refs**

çˆ¶ç»„ä»¶é€šè¿‡ `refs` ç›´æ¥è°ƒç”¨å­ç»„ä»¶å®ä¾‹

- [useImperativeHandle](https://www.ninjee.co/docs/frontEnd/React#useimperativehandle)ï¼šç”¨äºçˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„å±æ€§/æ–¹æ³•ã€‚å­ç»„ä»¶å¯¹å¤–æš´éœ² / æä¾›éƒ¨åˆ†åŠŸèƒ½

- forwardRefï¼šç”¨äºè½¬å‘ refã€‚å‡½æ•°ç»„ä»¶ï¼ˆæœ‰ props, ref å‚æ•°ï¼‰ä¼ å…¥ forwardRefï¼Œè¿”å›ç»‘å®šå¥½ ref çš„æ–°ç»„ä»¶ã€‚

```jsx
const Father = () => {
  const sonRef = useRef();
  return (
    <div>
      <Son ref={sonRef} value="å­ç»„ä»¶å†…å®¹" />
      <button onClick={() => sonRef.current.handle1()}>ç‚¹å‡»æ‰“å° sonRef</button>
    </div>
  );
};

const Son = forwardRef((props, ref) => {
  const input = useRef();
  useImperativeHandle( ref, () => {
    return {
      handle1: foo
    };
  }, []);

  const foo = () => {
    console.log("foo function!");
    console.log(input.current.value);
  };

  return (
    <div>
      <input type="text" defaultValue={props.value} ref={input} />
    </div>
  );
});

// ç‚¹çˆ¶ç»„ä»¶çš„ button åï¼Œæ§åˆ¶æ è¾“å‡ºï¼šfoo function å­ç»„ä»¶å†…å®¹
```



**ï¼ˆ3ï¼‰Event Bubbling äº‹ä»¶å†’æ³¡**

åˆ©ç”¨åŸç”Ÿ dom å…ƒç´ çš„äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œçˆ¶ç»„ä»¶æ‹¿åˆ°å­ç»„ä»¶çš„ dom å…ƒç´ ã€‚

```js
const Father = () => {
  return (<div
      onClick={(e) => console.log(e.target.previousSibling.value) }
    >
      <Son />
    </div>);
};

const Son = () => {
  return (<div>
      <input defaultValue="è¯·è¾“å…¥å†…å®¹..." />
      <button>Click</button>
    </div>);
};

// ç‚¹å­ç»„ä»¶çš„ button åï¼Œæ§åˆ¶æ è¾“å‡ºï¼šè¯·è¾“å…¥å†…å®¹...
```



**ï¼ˆ4ï¼‰context - provider**

-   ç¼ºç‚¹1ï¼šcontext æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå½“ç»„ä»¶åºå¤§å¤æ‚çš„æ—¶å€™ï¼Œå…¨å±€å‘½åç©ºé—´ä¼šå˜å¾—ç¹æ‚ï¼Œå˜é‡çš„æ¥æºå’Œå»å‘ä¸æ¸…æ¥šã€‚
-   ç¼ºç‚¹2ï¼šå¦‚æœæ²¡æœ‰åŠæ—¶çš„åœ¨å¸è½½ç»„ä»¶æ—¶å–æ¶ˆè®¢é˜…ï¼Œcontext æ²¡æœ‰æ¸…ç©ºï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚

æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒæœºåˆ¶

1. å…ˆè®¢é˜…ï¼Œå†å‘å¸ƒï¼ˆç†è§£ï¼šæœ‰ä¸€ç§éš”ç©ºå¯¹è¯çš„æ„Ÿè§‰ï¼‰
2. é€‚ç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡
3. è¦åœ¨ç±»ç»„ä»¶çš„ `componentWillUnmount` ä¸­å–æ¶ˆè®¢é˜…

```jsx
// ã€1ã€‘åˆ›å»ºä¸€ä¸ªå…¨å±€çš„ä¸Šä¸‹æ–‡ç»„ä»¶ã€‚
const ThemeContext = React.createContext("light");

// ã€2ã€‘çˆ¶ï¼Œé€šè¿‡ ThemeContext.ProvideråŒ…è£¹å­ç»„ä»¶ï¼Œvalue ä¼ é€’å€¼ã€‚
class Father extends React.Component {
  render() {
    return (
      <ThemeContext.Provider value={{ name: "123" }}>
        <MidComponent />
      </ThemeContxt.Provider>
    );
  }
}

// ä¸­é—´ç»„ä»¶
function MidComponent() {
  return <div><ThemedButton /></div>;
}

//ã€3ã€‘å­™ï¼Œé€šè¿‡ contextType å£°æ˜è¦ä½¿ç”¨ context
class ThemedButton extends React.Component {
  static contextType = ThemeContext;
  render() {
    // 123
    return <div>{this.context.name}</div>;  
  }
}

//ã€4ã€‘å­™ï¼Œæˆ–è€…é€šè¿‡ Consumerï¼Œåœ¨ return ä¸­ç›´æ¥æ‹¿åˆ° value
class ThemedButton extends React.Component {
  render() {
    // 123
    return <ThemeContext.Consumer>{(value) => value.name}</ThemeContext.Consumer>
  }
}

//ã€5ã€‘å‡½æ•°ç»„ä»¶ç”¨ useContext æ‹¿åˆ° value
function ThemedButton() {
  const value = React.useContext(ThemeContext);
  // 123
  return <div>{value.name}</div>;
}
```

**ï¼ˆ5ï¼‰Event Bus** 

- https://juejin.cn/post/7101481154565865486
- https://segmentfault.com/a/1190000023585646
- https://codesandbox.io/s/wizardly-wave-rrmw5v?file=/src/Context.jsx

**ï¼ˆ6ï¼‰redux**

ä½¿ç”¨ redux ç®¡ç†ç»„ä»¶é—´çš„æ•°æ®ï¼Œè¾¾åˆ°å®Œå…¨å¯æ§ã€‚



# 5 æ–‡ä»¶ç»“æ„ï¼š

public ---- é™æ€èµ„æºæ–‡ä»¶å¤¹

â€‹			favicon.icon ------ ç½‘ç«™é¡µç­¾å›¾æ ‡

â€‹            index.html -------- ä¸»é¡µé¢ï¼Œé¡¹ç›®åªæœ‰ä¸€ä¸ª `.html` æ–‡ä»¶ï¼ŒSPAï¼ˆsingle page appï¼‰å•é¡µé¢åº”ç”¨ã€‚

src ---- æºç æ–‡ä»¶å¤¹

â€‹            App.js --------- App ç»„ä»¶ï¼Œé¡¹ç›®åªæœ‰ä¸€ä¸ªçˆ¶ç»„ä»¶ï¼Œæ”¾åˆ° `<div id="root"></div>` ä¸­ï¼Œå…¶ä½™è‡ªå·±æ·»åŠ çš„ç»„ä»¶ï¼Œéƒ½æ”¾åˆ° App ç»„ä»¶ä¸­ã€‚ 

â€‹            index.js ------- å…¥å£æ–‡ä»¶ï¼Œå¼•å…¥ react æ ¸å¿ƒåº“ã€react-dom æ ¸å¿ƒåº“ã€App ç»„ä»¶ç­‰å¿…è¦çš„èµ„æºã€‚

â€‹		    ...... 



### 1 å¯åŠ¨æµç¨‹

1. åœ¨ `src` ä¸‹ `index.js`:
   - å¼•å…¥ react æ ¸å¿ƒåº“ï¼›
   - å¼•å…¥ react-dom æ ¸å¿ƒåº“ï¼›
   - å¼•å…¥ index CSS æ ·å¼ï¼›
   - å¼•å…¥ App ç»„ä»¶ï¼›
   - è§¦å‘ `ReactDOM.render()` æ¸²æŸ“ App ç»„ä»¶ï¼›
     - å¼•å…¥ App ç»„ä»¶æ—¶ï¼Œå°±ä¼šæŠŠç›¸åº”çš„ CSSã€JS ä»£ç å…¨éƒ¨å¼•å…¥ã€‚

2. åœ¨ `index.js` æ–‡ä»¶æ‰§è¡Œåï¼ŒReact é€šè¿‡ webpack çš„é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ° `public` ä¸‹çš„ `index.html`ï¼š
   - ä¾æ¬¡æ‰§è¡Œ `index.html` ä¸­çš„ç¨‹åºï¼Œ
3. æœ€ç»ˆï¼Œæ¸²æŸ“å‡º `index.html` çš„é¡µé¢ã€‚



# 6 router

## 1 è·¯ç”±åŸºç¡€

SPA çš„ å®šä¹‰ï¼š

1. å•é¡µWebåº”ç”¨ï¼ˆsingle page web applicationï¼ŒSPAï¼‰ã€‚
2. æ•´ä¸ªåº”ç”¨åªæœ‰ **ä¸€ä¸ªå®Œæ•´çš„é¡µé¢**ã€‚
3. ç‚¹å‡»é¡µé¢ä¸­çš„é“¾æ¥ **ä¸ä¼šåˆ·æ–°** é¡µé¢ï¼Œåªä¼šåšé¡µé¢çš„ **å±€éƒ¨æ›´æ–°ã€‚**
4. æ•°æ®éƒ½éœ€è¦é€šè¿‡ ajax è¯·æ±‚è·å–, å¹¶åœ¨å‰ç«¯å¼‚æ­¥å±•ç°ã€‚



è·¯ç”±çš„å®šä¹‰ï¼šä¸€ä¸ªè·¯ç”±å°±æ˜¯ä¸€ä¸ªæ˜ å°„å…³ç³» (key / value)ï¼š

- key æ˜¯ä¸€ä¸ªè·¯å¾„ï¼Œå¦‚`"/serch/users"`ï¼›
- value å¯èƒ½æ˜¯ functionï¼ˆåç«¯ï¼‰ æˆ– componentï¼ˆå‰ç«¯ï¼‰ã€‚



### ğŸŠ é“¾æ¥å¦‚ä½•è·³è½¬

**é“¾æ¥çš„è·³è½¬æ˜¯ä¾é  BOM ä¸­ window.history å®ç°çš„ã€‚**

é€šè¿‡ `history.js` åº“ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹åŸºæœ¬çš„å®ç°åŸç†ï¼š

1. æå‰å‡†å¤‡å·¥ä½œï¼š`let history = History.createBrowserHistory()`ã€‚é€šè¿‡ `history.js` åº“ï¼Œåˆ›å»ºä¸€ä¸ªæ¯”ç›´æ¥è°ƒç”¨ BOM æ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Œæ¥ä¿®æ”¹ BOM ä¸­çš„ `window.history` å±æ€§ã€‚
2. å½“ç”¨æˆ·ç‚¹å‡» `a` æ ‡ç­¾ï¼Œè§¦å‘äº† `onClick` å›è°ƒå‡½æ•°ï¼š
   1. ä½¿ç”¨ `history.push()` å¾€å†å²è®°å½•ä¸­æ·»åŠ ä¸€ä¸ªåœ°å€ã€‚
   2. ä½¿ç”¨ `return false` é˜»æ­¢æµè§ˆå™¨çš„è‡ªåŠ¨è·³è½¬è¡Œä¸ºï¼›
3. åœ¨å‡½æ•° `history.listen(location = > { console.log("è¯·æ±‚è·¯ç”±è·¯å¾„å˜åŒ–äº†", location)})` çš„ç›‘å¬ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `location` å‚æ•°è·å¾—å˜åŒ–çš„è·¯å¾„ï¼Œç„¶åæ ¹æ®ä¸åŒçš„è·¯å¾„å†å±•ç¤ºä¸åŒçš„ç»„ä»¶åˆ°é¡µé¢ã€‚



**å‰ç«¯è·¯ç”±çš„è·³è½¬ï¼Œä¹Ÿæ˜¯ä¾é  BOMï¼š `window.history` çš„å±æ€§æ“ä½œæ¥å®ç°çš„ã€‚**



### BrowserHistory å’Œ HashHistory çš„åŒºåˆ«

BrowserHistory æ˜¯ H5 æ¨å‡ºçš„ `history` èº«ä¸Šçš„ APIï¼›

HashHistory æ˜¯åˆ©ç”¨ hashå€¼ï¼ˆé”šç‚¹è·³è½¬ï¼‰ï¼Œå…¼å®¹æ€§æ›´å¼ºï¼Œ `#` é”šç‚¹åçš„ä¿¡æ¯è¢«å½“åšå‰ç«¯å†…å®¹ï¼Œä¸ä¼šå›ä¼ ç»™åç«¯æœåŠ¡å™¨ã€‚

```jsx
// BrowserHistoryçš„åœ°å€:
127.0.0.1:5500/index.html/test1

// HashHistoryçš„åœ°å€ï¼Œå¤šäº†ä¸€ä¸ª'#'ï¼Œé”šç‚¹çš„æ ‡è®°
127.0.0.1:5500/index.html#/test1
```



## 2 è·¯ç”±çš„ä½¿ç”¨

#### 1 æ˜ç¡®å¥½ç•Œé¢ä¸­çš„å¯¼èˆªåŒºã€å±•ç¤ºåŒº

- å¯¼èˆªåŒºï¼Œç‚¹å‡»åä¼šå‘ç”Ÿé¡µé¢å˜åŒ–çš„é“¾æ¥ï¼›
- å±•ç¤ºåŒºï¼Œé¡µé¢å˜åŒ–çš„ä¸»ä½“ã€‚æ¯ä¸ªå±•ç¤ºåŒºï¼Œéƒ½æ˜¯ä¸€ä¸ªç»„ä»¶ã€‚



#### å¯¼èˆªåŒº+å±•ç¤ºåŒºçš„ä½¿ç”¨ï¼š

ä¼ ç»Ÿçš„ HTML ä¸­ `a` æ ‡ç­¾ï¼š

```html
<!-- ä½œä¸ºå¯¹æ¯”ï¼šåŸç”Ÿhtmlä¸­ï¼Œé <a>è·³è½¬ä¸åŒçš„é¡µé¢ -->
<a className="list-group-item" href="./about.html">About</a>
<a className="list-group-item active" href="./home.html">Home</a>
```

åœ¨ React ä¸­ï¼Œä½¿ç”¨è·¯ç”±ä¾é  **è·¯ç”±é“¾æ¥** å®ç°åˆ‡æ¢ç»„ä»¶ã€‚

é¦–å…ˆéœ€è¦åœ¨ä½¿ç”¨è·¯ç”±çš„å¤–ä¾§ï¼ŒåŒ…è£¹ä¸€ä¸ª Router ç±»çš„æ ‡ç­¾ï¼Œæœ‰ä¸¤ç§å¯é€‰æ‹©ï¼š`BrowserRoute` æˆ– `HashRoute`ã€‚

- `Router` ç»„ä»¶æœ‰ä¸¤ç§ï¼Œ`BrowserRoute` æˆ–è€… `HashRouter`ã€‚

åœ¨æ•´ä¸ªé¡¹ç›®çš„è·¯ç”±è·³è½¬ä¸­ï¼Œè¦åœ¨åŒä¸€ä¸ª `BrowserRouter`  æ ‡ç­¾çš„ç®¡ç†ä¸‹ã€‚é€šå¸¸æ˜¯æ•´ä¸ªé¡¹ç›®éƒ½æ˜¯åŒä¸€ä¸ª `BrowserRouter`  çš„ç®¡ç†ã€‚



**è·¯ç”±ç»„ä»¶çš„ props**

ä¼ é€’ props å’Œ **å¾ˆå¤šè·¯ç”±ç›¸å…³ä¿¡æ¯** ç»™è·¯ç”±ç»„ä»¶ï¼Œå­è·¯ç”±ç»„ä»¶çš„ `this.props` æœ‰ï¼š

- `history`
- `location`
- `match  `
- è¿˜æœ‰å¾ˆå¤šï¼Œä¸å¸¸ç”¨

```jsx
// this.props ä¸­çš„ä¸‰å¤§å±æ€§ï¼š
history:
    go: Æ’ go(n)
    goBack: Æ’ goBack()
    goForward: Æ’ goForward()
    push: Æ’ push(path, state)
    replace: Æ’ replace(path, state)

location:
    pathname: "/about"
    search: ""
    state: undefined

match:
	params: {}
    path: "/about"
    url: "/about"
```

history ä¸­çš„ 5 ä¸ªæ–¹æ³•ï¼Œåœ¨ 3.11 ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆªä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚

- `go(step)` ï¼šæŒ‡å®šå‚æ•°çš„æ•°å­—å‰è¿› / åé€€ã€‚å¦‚æœæ˜¯ 2ï¼Œå‰è¿› 2 æ­¥ï¼›å¦‚æœæ˜¯ -2 åé€€ï¼Œ2 æ­¥ã€‚
- `goBack()`ï¼šåé€€ 1 æ­¥ï¼›
- `goForward()`ï¼šå‰è¿› 1 æ­¥ï¼›
- `push(path, state)`ï¼šé‡‡ç”¨ push æ–¹æ³•è®°å½•å†å²ï¼Œé»˜è®¤é‡‡ç”¨ push æ–¹æ³•ã€‚
- `replace(path, state)`ï¼šé‡‡ç”¨ replace æ–¹æ³•è®°å½•å†å²ï¼Œä¼šæŠŠç‚¹å‡»åçš„ç½‘é¡µå†å²ï¼Œé¡¶æ›¿æ‰ä¸Šä¸€ä¸ªç½‘é¡µçš„å†å²



```jsx
{/*ä¸€èˆ¬ç»„ä»¶ */}
<Home name={Moxy} />

{/*è·¯ç”±ç»„ä»¶ */}
<Route path="/about" component={About} />
```

![image-20211013200143869](react%E5%A4%8D%E4%B9%A0/image-20211013200143869.png)



## 3 è·¯ç”±ç»„ä»¶

### 1 NavLink å’Œ Link ç»„ä»¶æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

Link æ›¿æ¢äº† HTML ä¸­çš„ `a` æ ‡ç­¾ï¼Œæ˜¯ Route ä¸­å®ç°è·³è½¬åŠŸèƒ½çš„å¯¼èˆªåŒºã€‚

NavLink ç»„ä»¶æ¯” Link ç»„ä»¶å¤šäº†æ·»åŠ æ ·å¼åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ç”¨æˆ·ç‚¹å‡»æŸä¸ª NavLink åï¼Œä¸ºè¿™ä¸ªæ ‡ç­¾æ·»åŠ ç±»åï¼š

```js
<NavLink activeClassName="blue" className="list-group-item" to="/about">About</Link>
<NavLink activeClassName="blue" className="list-group-item" to="/home">Home</Link>
<NavLink activeClassName="blue" className="list-group-item" to="/head">Header</Link>
<NavLink activeClassName="blue" className="list-group-item" to="/foot">Footer</Link>
```

- å½“è¯¥é“¾æ¥è¢«æ¿€æ´»æ—¶ï¼Œå°±ä¼šæŠŠ `activeClassName` çš„å±æ€§å€¼æ·»åŠ ä¸ºç±»åã€‚å¦‚æœä¸è®¾ç½® `activeClassName` å±æ€§ï¼Œå°±ä¼šé»˜è®¤æ·»åŠ ç±»å  `active` ã€‚



### 2 Switch ç»„ä»¶è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

 React-route çš„æŸ¥æ‰¾åŸåˆ™ï¼š

- ä¾æ¬¡æŠŠæ‰€æœ‰ Route éƒ½åŒ¹é…ä¸€éï¼Œå¦‚æœ path å±æ€§å€¼åŒ¹é…æˆåŠŸï¼Œå°±ä¼šå±•ç¤ºè¯¥ç»„ä»¶ï¼Œè¿™ä¼šæå¤§çš„å½±å“åŒ¹é…æ•ˆç‡ã€‚

å‡è®¾ Route éå¸¸å¤šï¼Œæ¯æ¬¡åŒ¹é…éƒ½éœ€è¦æŠŠæ‰€æœ‰ Route éƒ½éå†ä¸€éã€‚è€Œå¦‚æœæŸ¥æ‰¾çš„ `/home` æ˜¯åˆ—è¡¨çš„ç¬¬äºŒè¡Œï¼Œæˆ‘ä»¬å¸Œæœ›åªè¦åŒ¹é…æˆåŠŸï¼Œå°±ä¸å†å¾€ä¸‹æ¥ç€åŒ¹é…ï¼Œæé«˜åŒ¹é…æ•ˆç‡ï¼Œè¿™æ—¶å€™å°±ä½¿ç”¨ Switch ç»„ä»¶äº†ï¼š

```jsx
imprt Switch form 'react-router-dom'
{/* æ³¨å†Œè·¯ç”± */}
<Switch>
    <Route path="/about" component={About}/>
    <Route path="/home" component={Home}/>
    <Route path="/home" component={Test}/>
</Switch>  
```

- åªéœ€è¦æŠŠ Route åŒ…è£¹åœ¨ Switch ä¸­ä½¿ç”¨å³å¯ã€‚
- Switch æ˜¯å•ä¸€åŒ¹é…ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œå°±ä¸ä¼šå†å»æŸ¥æ‰¾å’ŒåŒ¹é…å‰©ä½™çš„ Routeã€‚



### 3  è·¯ç”±çš„æ¨¡ç³ŠåŒ¹é…ä¸ä¸¥æ ¼åŒ¹é…

#### 1 æ¨¡ç³ŠåŒ¹é…

å¦‚æœåœ°å€æ è¾“å…¥ä»¥ä¸‹ä¸¤ä¸ªé“¾æ¥ï¼š

- /about
- /home

å¦‚æœæˆ‘ä»¬å°è¯•è·³è½¬ï¼š`<Route path="/home/a/b" component={Home} />`ï¼Œæ ¹æ®æ¨¡ç³ŠåŒ¹é…åŸåˆ™ï¼Œè™½ç„¶æ²¡æœ‰ `/a/b` çš„åœ°å€ï¼Œä½†æ˜¯å…ˆåŒ¹é… `/home`ï¼Œå‘ç°ä¸€è‡´ï¼Œåˆ™åŒ¹é…æˆåŠŸï¼Œå±•ç¤º Home ç»„ä»¶ã€‚



æˆ‘ä»¬å¸Œæœ›å½“ç”¨æˆ·è¾“å…¥é»˜è®¤ç½‘å€æ—¶ï¼Œæ‰ä¼šå±•ç¤º Home ç»„ä»¶ã€‚è¿™å°±éœ€è¦å¯¹ä¸»é¡µåœ°å€ `/` è®¾ç½® exactã€‚åœ¨è®¾ç½®äº†ç²¾ç¡®åŒ¹é…åï¼Œä¹‹ååœ°å€æ è¾“å…¥å®Œå…¨ä¸€è‡´çš„ä¸»é¡µåœ°å€ï¼Œæ‰ä¼šå±•ç¤º Home ç»„ä»¶ã€‚

- å¦‚æœä¸è®¾ç½® `exact`ï¼Œåœ°å€ `/about` ä¼šé¦–å…ˆåŒ¹é…åˆ° `path="/"`ï¼Œç„¶åå±•ç¤º Homeã€‚å¦‚æœæ˜¯ç”¨ switchï¼Œå°±ä¸ä¼šå†å±•ç¤º About ç»„ä»¶äº†ã€‚`<Switch>` ä¸­åªè¦åŒ¹é…ä¸€æ¬¡æˆåŠŸï¼Œå°±ä¼šåœæ­¢åŒ¹é…ã€‚æ‰€ä»¥ä¸è®ºåœ°å€è¾“å…¥å“ªä¸€ä¸ªç½‘é¡µï¼Œéƒ½ä¼šåŒ¹é…åˆ° Home ç»„ä»¶ã€‚



#### 2 ä¸¥æ ¼åŒ¹é…

```jsx
// å¼€å¯ä¸¥æ ¼åŒ¹é…
<Route exact={true} path="/home" component={Home} />
// æˆ–
<Route exact path="/home" component={Home} />
```

å½“æˆ‘ä»¬æ³¨å†Œè·¯ç”±æ—¶ï¼Œ`exact` å±æ€§ç½®ä¸º trueï¼Œå°±ä¼šå¼€å¯ç²¾å‡†åŒ¹é…ã€‚å¿…é¡»æ‰€æœ‰åœ°å€å®Œå…¨ä¸€è‡´ï¼Œæ‰å¯ä»¥åŒ¹é…æˆåŠŸã€‚

- å¦‚æœä¸ä¸»åŠ¨è®¾ç½®å±æ€§ä¸º `true`ï¼Œåˆ™é»˜è®¤æ˜¯ `true`ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå¼€å¯ä¸¥æ ¼åŒ¹é…ã€‚ä¸¥æ ¼åŒ¹é…çš„å¼€å¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´äºŒçº§è·¯ç”±åŒ¹é…å¤±è´¥çš„é—®é¢˜ã€‚



## 4 Redirect é‡å®šå‘

```jsx
// å¼€å¤´éœ€è¦å¼•å…¥ Redirect ç»„ä»¶
import {Route, Switch, Redirect} from 'react-router-dom'

{/* æ³¨å†Œè·¯ç”± */}
<Switch>
    <Route path="/about" component={About} />
    <Route path="/home" component={Home} />
    <Redirect to="/about" />
</Switch>
```

- å¦‚æœå…¶ä»–è·¯ç”±éƒ½æ— æ³•åŒ¹é…ï¼ŒRedirect ä½œä¸º â€œå…œåº•â€ï¼Œæœ€ç»ˆä¼šå®šå‘åˆ° `/about` çš„ Route è·¯ç”±ã€‚



##  5 å‘è·¯ç”±ç»„ä»¶ä¼ é€’å‚æ•°

ä½¿ç”¨é¢‘ç‡ï¼š`params` > `search` > `state`

#### 1 match.params å‚æ•°

- çˆ¶ç»„ä»¶ï¼š
  - è·¯ç”±é“¾æ¥ (æºå¸¦å‚æ•°)ï¼š`<Link to='/demo/test/${msgObj.name}/${msgObj.age}'}>è¯¦æƒ…</Link>`
  - æ³¨å†Œè·¯ç”± (å£°æ˜æ¥æ”¶)ï¼š`<Route path="/demo/test/:name/:age" component={Test}/>`
- å­ç»„ä»¶ï¼š
  - æ¥æ”¶å‚æ•°ï¼š`this.props.match.params`



#### 2 search å‚æ•°

- çˆ¶ç»„ä»¶ï¼š
  - è·¯ç”±é“¾æ¥ (æºå¸¦å‚æ•°)ï¼š`<Link to='/demo/test?name=${msg.name}&age=${msg.age}'}>è¯¦æƒ…</Link>`
  - æ³¨å†Œè·¯ç”± (æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯)ï¼š`<Route path="/demo/test" component={Test}/>`

- å­ç»„ä»¶ï¼š
  - æ¥æ”¶å‚æ•°ï¼š`this.props.location.search`
    - ä½¿ç”¨ `querystring` æ–¹æ³•ï¼ŒåŒæ—¶æ³¨æ„åˆ é™¤é“¾æ¥åœ°å€å¼€å¤´çš„å°é—®å· `?`ã€‚

ç‰¹ç‚¹ï¼š

- è·å–åˆ°çš„ search æ˜¯ `urlencoded` ç¼–ç å­—ç¬¦ä¸²ï¼Œéœ€è¦å€ŸåŠ© `querystring` è§£æã€‚
- æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯ï¼š`"?name=Moxy&age=18"`ï¼Œå½¢å¼æ˜¯ `"key=value&key=value"` å«åš `urlencoded` ç¼–ç ã€‚



#### 3 state å‚æ•°

- çˆ¶ç»„ä»¶ï¼š
  - è·¯ç”±é“¾æ¥(æºå¸¦å‚æ•°)ï¼š`<Link to={{pathname:'/demo/test', state:{name:'tom',age:18}}}>è¯¦æƒ…</Link>`
  - æ³¨å†Œè·¯ç”±(æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯)ï¼š`<Route path="/demo/test" component={Test}/>`

- å­ç»„ä»¶ï¼š
  - æ¥æ”¶å‚æ•°ï¼š`this.props.location.state`

ç‰¹ç‚¹ï¼š

- state å‚æ•°è·¯ç”±é“¾æ¥ä¸­ï¼Œ`to` å±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²åœ°å€ï¼›

- é¡µé¢åœ°å€æ ä¸­æ²¡æœ‰å‚æ•°ï¼›

- å› ä¸º state ä¸é€šè¿‡åœ°å€æ ä¼ é€’å‚æ•°ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ç›´æ¥è¾“å…¥åœ°å€æ è®¿é—®ï¼š`localhost:3000/test/about`ï¼›è€Œä¸æ˜¯é€šè¿‡ç‚¹å‡»é“¾æ¥çš„å½¢å¼è®¿é—®è¿™ä¸ªåœ°å€ï¼Œå°±ä¼šå‘ç”Ÿæ‰¾ä¸åˆ°å‚æ•°çš„é—®é¢˜ï¼Œæ­¤æ—¶ `this.props.location.state` çš„å€¼æ˜¯ `undfined`ã€‚

  ```jsx
  // æ‰€ä»¥ï¼Œæ¥æ”¶å‚æ•°è¦ï¼š
  const {id, title} = this.props.loction.state || {}
  // å¦‚æœ state æœ‰å€¼ï¼Œå°±æ¥æ”¶å€¼ï¼›å¦‚æœæ²¡æœ‰å€¼ï¼Œå°±æ¥å—ä¸€ä¸ªç©ºå¯¹è±¡ã€‚
  ```

- å¦‚æœä¼ é€’è¿‡å‚æ•°ï¼Œå³ä½¿ç”¨æˆ·é¡µé¢åˆ·æ–°ä¹Ÿå¯ä»¥ä¿ç•™ä½å‚æ•°ã€‚

  - params å’Œ search åˆ·æ–°ä¹Ÿèƒ½ä¿ç•™ä½å‚æ•°ï¼Œå› ä¸ºä»–ä»¬çš„å‚æ•°ç›´æ¥åœ¨åœ°å€æ å°±ä½“ç°äº†



## 6 BrowserRouter ä¸ HashRouter çš„åŒºåˆ«æ€»ç»“ï¼š

1. åº•å±‚åŸç†ä¸ä¸€æ ·ï¼š
   - BrowserRouterï¼šä½¿ç”¨çš„æ˜¯ H5 çš„ history APIï¼Œåªå…¼å®¹ IE10 ä»¥ä¸Šç‰ˆæœ¬ã€‚
   - HashRouterï¼šä½¿ç”¨çš„æ˜¯ URL çš„å“ˆå¸Œå€¼ï¼Œå…¼å®¹æ€§æ›´å¥½ã€‚
2. `path` è¡¨ç°å½¢å¼ä¸ä¸€æ ·
   - BrowserRouter çš„è·¯å¾„ä¸­æ²¡æœ‰ `#`ï¼Œä¾‹å¦‚ï¼š`localhost:3000/demo/test`;
   - HashRouter çš„è·¯å¾„åŒ…å« `#`ï¼Œä¾‹å¦‚ï¼š`localhost:3000/#/demo/test`ï¼›
3. åˆ·æ–°åå¯¹è·¯ç”± `state` å‚æ•°çš„å½±å“
   - BrowserRouterï¼šæ²¡æœ‰ä»»ä½•å½±å“ï¼Œå› ä¸º `state` ä¿å­˜åœ¨ `history` å¯¹è±¡ä¸­ï¼›
   - HashRouterï¼šåˆ·æ–°åä¼šå¯¼è‡´è·¯ç”± `state` å‚æ•°çš„ä¸¢å¤±ï¼Œ
     - HashRouter æ²¡æœ‰ä½¿ç”¨ html5 ä¸­çš„ history APIï¼Œæ— æ³•ä»å†å²è®°å½•ä¸­å¾—åˆ° `key` å’Œ `state` çš„å€¼ï¼Œæ‰€ä»¥å½“åˆ·æ–°è·¯ç”±å `state` å€¼ä¼šä¸¢å¤±å¯¼è‡´é¡µé¢æ˜¾ç¤ºå¼‚å¸¸ã€‚
     - å“ˆå¸Œå†å²è®°å½•ä¸æ”¯æŒ `location.key` å’Œ `location.state`ã€‚
4. å¤‡æ³¨ï¼š
   - HashRouter å¯ä»¥ç”¨äºè§£å†³ä¸€äº›è·¯å¾„é”™è¯¯ç›¸å…³çš„é—®é¢˜ã€‚
   - ä½¿ç”¨æœ€å¤šçš„æ˜¯ BrowserRouterã€‚



## 7 react-router-config

é€šè¿‡é…ç½® config å½¢æˆè·¯ç”±æ˜ å°„å…³ç³»çš„æ•°ç»„ã€‚

-   å¯¼èˆªåŒºæ­£å¸¸ä½¿ç”¨ `NavLink`ï¼›
-   è·³è½¬åŒºè°ƒç”¨ `renderRoutes(routes)` å®ç°è·¯ç”±ï¼›

![image-20211112134804049](react%E5%A4%8D%E4%B9%A0/image-20211112134804049.png)



# 7 redux

## 7.1 åŸºç¡€

### 7.1.1 ä¸ºä»€ä¹ˆè¦ç”¨ Redux

JavaScript å¼€å‘çš„åº”ç”¨ç¨‹åºï¼Œå·²ç»å˜å¾—è¶Šæ¥è¶Šå¤æ‚äº†ï¼š

- éœ€è¦ç®¡ç†çš„çŠ¶æ€æ›´å¤æ‚ï¼›
- æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€ç¼“å­˜ä¸­è¯»å–çš„æ•°æ®ã€ç”¨æˆ·ç‚¹å‡»æŒ‰é’® / è¡¨å•æäº¤ç­‰ç”Ÿæˆçš„æ•°æ®ã€UI çŠ¶æ€çš„æ•°æ®ã€‚

æ‰€ä»¥ï¼Œç®¡ç†ä¸æ–­å˜åŒ–çš„ state æ˜¯éå¸¸å›°éš¾çš„ï¼š

- çŠ¶æ€ä¹‹é—´ç›¸äº’ä¼šå­˜åœ¨ä¾èµ–ï¼Œä¸€ä¸ªå˜åŒ–é€šå¸¸ä¼šå¼•èµ·å¦ä¸€ä¸ªå˜åŒ–ï¼›
- æˆ‘ä»¬æƒ³æ›´å¥½çš„è¿½è¸ªå’Œæ§åˆ¶ state å‘ç”Ÿçš„å˜åŒ–ï¼š
  - å‘ç”Ÿå˜åŒ–çš„æ—¶æœºã€åŸå› ã€ç»“æœã€‚

ç„¶è€Œï¼ŒReact åªæ˜¯åœ¨è§†å›¾å±‚å¸®åŠ©æˆ‘ä»¬è§£å†³äº† DOM çš„æ¸²æŸ“è¿‡ç¨‹ï¼ŒState ä¾ç„¶æ˜¯æˆ‘ä»¬è‡ªå·±æ¥ç®¡ç†ï¼š

- ç»„ä»¶è‡ªå®šä¹‰ stateã€é€šè¿‡ props åœ¨ç»„ä»¶ä¹‹é—´è¿›è¡Œé€šä¿¡ã€é€šè¿‡åœ¨çˆ¶ç»„ä»¶å­˜æ”¾æ•°æ®è¿›è¡Œå­ç»„ä»¶æ•°æ®å…±äº«ï¼›

ç»¼ä¸Šï¼ŒRedux å°±æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬é›†ä¸­ç®¡ç† state çš„å®¹å™¨ï¼š

- Redux æ˜¯ JavaScript çš„çŠ¶æ€å®¹å™¨ï¼Œæä¾›äº† **å¯é¢„æµ‹** çš„çŠ¶æ€ç®¡ç†ã€‚
  - å‘ç”Ÿå˜åŒ–çš„æ—¶æœºã€åŸå› ã€ç»“æœï¼Œéƒ½å¯ä»¥æ§åˆ¶å’Œè¿½è¸ªã€‚
- Redux ä½“ç§¯éå¸¸å°ï¼Œä¸”ä¸ä»…åœ¨ Reactï¼Œåœ¨å…¶ä»–ä¸¤ä¸ªæ¡†æ¶ä¹Ÿèƒ½ä½¿ç”¨ã€‚



## 7.1.2 åŸºæœ¬ç»“æ„ï¼š

### index.js (store)

å¯¹å¤–çš„å…¥å£ï¼Œå…± 4 è¡Œï¼šå¼•å…¥ reduxã€å¼•å…¥ reducerã€åˆ›å»º storeã€å¯¼å‡º storeã€‚

storeï¼šå­˜å‚¨æ•°æ® stateï¼Œæä¾›æ´¾å‘æ–¹æ³• dispatch



### reducer.js

æ•°æ®é›†ä¸­å¤„ç†å‡½æ•°

- çº¯å‡½æ•°ï¼Œå› ä¸º state æ˜¯åªè¯»çš„ï¼Œåªèƒ½é€šè¿‡ dispatch æ´¾å‘å»ä¿®æ”¹ã€‚
- å°† state å’Œ action ç»“åˆèµ·æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ state



### actionCreators.js (action)

å®šä¹‰æ›´æ–°æ•°æ®çš„å…·ä½“æ–¹å¼ã€‚æ˜¯å‡½æ•°çš„é›†åˆã€‚

æœ‰ä¸¤ç§ actionï¼š

- åŒæ­¥ actionï¼šè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº† actionType å’Œ valueï¼Œæä¾›é€ç»™ reducer å¯¹ state è¿›è¡Œæ“ä½œã€‚
- å¼‚æ­¥ actionï¼šè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­å¯ä»¥å¼‚æ­¥ä»ç½‘ç»œè·å–èµ„æºã€‚å½“è·å–åˆ°èµ„æºåï¼Œå†è°ƒç”¨åŒæ­¥ actionï¼Œå»æ›´æ–° stateã€‚



### constant.js

ä¿å­˜ action æ“ä½œçš„ **æ‰€æœ‰ç±»å‹å type**ï¼Œæ–¹ä¾¿æŸ¥é˜…å’Œä¿®æ”¹ã€‚



![redux-flow](react%E5%A4%8D%E4%B9%A0/b29d7032616345d0a969febfeadc67a2tplv-k3u1fbpfcp-watermark.awebp)

![image-20211015160056888](react%E5%A4%8D%E4%B9%A0/image-20211015160056888.png)



## 7.3 Redux æµç¨‹

å½“æˆ‘ä»¬è¦å¯¹æŸä¸ª Component ç»„ä»¶çš„ state è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šå‘ç”Ÿå¦‚ä¸‹æµç¨‹ï¼š

1. **Central Store**ã€‚
   - ä» Central Store å‡ºå‘ï¼Œredux ä¸­åªä¼šå®šä¹‰ä¸€ä¸ª store ç”¨æ¥å­˜å‚¨æ•´ä¸ªé¡¹ç›®ä¸­çš„æ•°æ®ã€‚

2. **Subscription**ã€‚ 
   - åœ¨è¿™ä¸ª Component çš„ `componentDidMount()` ç»„ä»¶åŠ è½½å®Œæ¯•çš„å›è°ƒä¸­ï¼Œæ·»åŠ  `store.subscribe()`  è®¢é˜…ã€‚ä¹Ÿå°±æ˜¯ä¸€æ—¦ store ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªç›‘å¬å‡½æ•°ã€‚
   
   - å½“ç”¨æˆ·å‘ç”Ÿå¯¹æ•°æ®ä¿®æ”¹çš„è¡Œä¸ºï¼ˆç‚¹å‡»æŒ‰é’®ã€è¾“å…¥è¡¨å•ç­‰ç­‰ï¼‰ï¼Œå°±ä¼šè§¦å‘ `Dispatches`ï¼ŒStore ä¸­çš„æ•°æ®å°±ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè¿›è€Œæˆ‘ä»¬è®¾å®šçš„ subscribe è®¢é˜…ç›‘å¬å°±ä¼šè¢«è§¦å‘ã€‚
   - åœ¨ Subscription ä¸­æ·»åŠ  `this.setState()` ï¼ŒæŠŠ store ä¸­å˜åŒ–çš„æ•°æ®ï¼Œæ›´æ–°åˆ°è¿™ä¸ª Component ç»„ä»¶ä¸­çš„ state ã€‚
   - æ­¤æ—¶ React ä¼šæ›´æ–°ç»„ä»¶çš„ stateï¼Œå¹¶è§¦å‘ `render()` å»é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œå‘ˆç°æ–°æ•°æ®ã€‚
   
3. **Component**ã€‚
   - é€šè¿‡åœ¨ç»„ä»¶çš„ `componentDidMount()` ä¸­è®¢é˜…  `this.setState()` ï¼Œå°±ä¼šè®©è¿™ä¸ªç»„ä»¶è‡ªèº«çš„ state éšç€ store ä¸­çš„ state å˜åŒ–è€Œä¿æŒæœ€æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œstore ä¸­ä¼šä¿å­˜å…¨éƒ¨éœ€è¦å…±äº«çš„æ•°æ®ï¼Œç»„ä»¶ä¼šé¢å¤–çš„ä¿å­˜ä¸€ä»½ store ä¸­è‡ªå·±éœ€è¦çš„æ•°æ®ã€‚

   - åŒæ—¶åœ¨ç»„ä»¶ä¸­çš„ `button` æŒ‰é’®å®šä¹‰è§¦å‘äº‹ä»¶ï¼Œä¸€æ—¦è§¦å‘ï¼Œå°±ä½¿ç”¨ Dispatches æ´¾å‘ Actionï¼Œå»æ›´æ–° store ä¸­çš„æ•°æ®ã€‚

4. **Action**ã€‚
   - Actionsï¼Œæ˜¯æå‰å®šä¹‰å¥½çš„å¤šç§å¯¹æ•°æ®çš„æ“ä½œæ–¹æ³•ã€‚
   - åœ¨è¿™é‡Œå®šä¹‰ Dispatch æ´¾å‘æ—¶ï¼Œ åŒæ—¶æŒ‡å®šè¦æ‰§è¡Œçš„ action åç§°ä»¥åŠä¼ å…¥å¯¹åº”çš„æ“ä½œå‚æ•°ã€‚

5. **Reducer**ã€‚
   - Redux é€šè¿‡ Reducer æŠŠæ•°æ®ä¿®æ”¹ã€‚ 
   - reducer æ”¶åˆ°éœ€è¦æ“ä½œçš„ state å’Œ æ“ä½œæ–¹æ³• actionï¼Œæ ¹æ® `action.type` ï¼Œå¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚æœ€åè¿”å›ä¸€ä¸ªæ–°çš„ stateã€‚
   - Redux ä¼šæŠŠè¿™ä¸ª state æ›´æ–°åˆ°è‡ªå·±çš„ store ä¸­ã€‚

6. è¿›å…¥ä¸€ä¸ªæ–°çš„å¾ªç¯ï¼Œä¸€æ—¦ store å‘ç”Ÿæ”¹å˜å°±ä¼šè¢«è®¢é˜…åˆ°ï¼Œç„¶åè°ƒç”¨ `this.setState()` åŒæ­¥æ›´æ–°ç»„ä»¶çš„ stateï¼Œæœ€å



## 7.4 react-redux

åˆ©ç”¨ react-redux å®ç°äº†å°† redux è¿›å…¥ reactã€‚

-   åœ¨ react hook ä¸­ï¼Œä½¿ç”¨ `useSelector` è·å– redux ä¸­æƒ³è¦çš„ stateï¼ŒåŒæ—¶è®¾å®šäº†ç›‘å¬ã€‚ä¸€æ—¦ state å‘ç”Ÿæ›´æ–°ï¼Œå°±ä¼šæ›´æ–°æ‰€æœ‰ä½¿ç”¨äº† `useSelector`  è·å–è¯¥å€¼çš„ç»„ä»¶ã€‚
    -   æ³¨æ„ï¼šstate åªè¦æœ‰ä¸€ä¸ªå€¼å‘ç”Ÿæ›´æ–°ï¼Œå°±ä¼šå¯¼è‡´æ‰€æœ‰ useSeleoctor æ›´æ–°ã€‚è§£å†³ï¼Œä½¿ç”¨ `shallowEqual`ã€‚



![img](react%E5%A4%8D%E4%B9%A0/95e279721bec4ec4a9f3314a470d2f9ctplv-k3u1fbpfcp-watermark.awebp)

åˆ©ç”¨ï¼šå‘å¸ƒè®¢é˜…ç»“æ„ï¼Œsubscribe å’Œ unsubscribeã€‚



## 7.5 ä¸­é—´ä»¶ â€” ç»„ä»¶ä¸­çš„å¼‚æ­¥æ“ä½œ

![img](react%E5%A4%8D%E4%B9%A0/bf8d8e9c32ff4980ac9835b91876ab75tplv-k3u1fbpfcp-watermark.awebp)

æŠŠå¯¹ç½‘ç»œè¯·æ±‚çš„å‘é€ï¼Œè·å–ç½‘ç»œèµ„æºï¼Œæ”¾åˆ° redux ä¸­ã€‚ä¹Ÿå°±æ˜¯åˆ©ç”¨ å¼‚æ­¥ action è·å–ç½‘ç»œèµ„æºã€‚

**ä½¿ç”¨ä¸­é—´ä»¶ (Middleware)**

- è¿™ä¸ª**ä¸­é—´ä»¶çš„ç›®çš„æ˜¯åœ¨`dispatch`çš„`action`å’Œæœ€ç»ˆè¾¾åˆ°çš„`reducer`ä¹‹é—´ï¼Œæ‰©å±•ä¸€äº›è‡ªå·±çš„ä»£ç **
- æ¯”å¦‚æ—¥å¿—è®°å½•ã€**å¼‚æ­¥ç½‘ç»œè¯·æ±‚**ã€æ·»åŠ ä»£ç è°ƒè¯•åŠŸèƒ½ç­‰ç­‰

![redux-middlware](react%E5%A4%8D%E4%B9%A0/78d03b01ff7c4e6281a54ea0ae0a1fa3tplv-k3u1fbpfcp-watermark.awebp)

####  `redux-thunk` æ˜¯å¦‚ä½•åšåˆ°è®©æˆ‘ä»¬å¯ä»¥å‘é€å¼‚æ­¥çš„è¯·æ±‚å‘¢ï¼Ÿ

- é»˜è®¤æƒ…å†µä¸‹çš„`dispatch(action)`ï¼Œ`action` éœ€è¦æ˜¯ä¸€ä¸ª `JavaScript` çš„å¯¹è±¡
- `redux-thunk` è®© `dispatch(action())` ä¸­çš„ `action()` åŸæœ¬æ˜¯è¿”å›ä¸€ä¸ªå€¼ï¼Œç°åœ¨å¯ä»¥ **è¿”å›ä¸€ä¸ªå‡½æ•°**
- è¯¥å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä¼š **è‡ªåŠ¨çš„** ä¼ ç»™è¿™ä¸ªå‡½æ•°ä¸¤ä¸ªå‚æ•°ï¼š`dispatch` æ–¹æ³• +  `getState` æ–¹æ³•ã€‚
  - è¿™ä½¿å¾—è¿™ä¸ªå‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨ `dispatch` æ›´æ–°æ•°æ®ã€ä½¿ç”¨ `getState` è·å–æ•°æ®
    - `dispatch` æ–¹æ³•ï¼šç”¨äºæˆ‘ä»¬ä¹‹åå†æ¬¡æ´¾å‘ `action`ï¼›
    - `getState` æ–¹æ³•ï¼šè€ƒè™‘åˆ°æˆ‘ä»¬ä¹‹åçš„ä¸€äº›æ“ä½œéœ€è¦ä¾èµ–åŸæ¥çš„çŠ¶æ€ï¼Œç”¨äºè®©æˆ‘ä»¬å¯ä»¥è·å–ä¹‹å‰çš„ä¸€äº›æ•°æ®ï¼›



## combinReducers  æ‹†åˆ† reducer

å¦‚æœé¡¹ç›®å¯¹æ•°æ®çš„æ“ä½œï¼š

1. æ¡ç›®éå¸¸å¤šï¼Œå¯èƒ½æœ‰ä¸Šåƒè¡Œï¼Œreducer éå¸¸é•¿ï¼›
2. å¯¹æ•°æ®çš„æ“ä½œæœ‰æ˜æ˜¾çš„ç±»åˆ«ï¼Œå¦‚å¼‚æ­¥ç½‘ç»œç”³è¯·æ•°æ®ã€æœ¬åœ°æ•°æ®ã€ä¸åŒçš„ç»„ä»¶æ•°æ®ç­‰ã€‚

# 8 å•å‘æ•°æ®æµ

æœ‰ä¸‰ä¸ªç†è§£ï¼š

1. React å®˜ç½‘ä¸­æœ‰æåˆ°å•å‘æ•°æ®æµï¼š
   - åªçš„å°±æ˜¯é€šè¿‡ props è¿›è¡Œæ•°æ®ä¼ é€’ã€‚ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œç»„ä»¶æ˜¯æŒ‰ä»¥æ ‘çš„ç»“æ„ç»„ç»‡èµ·æ¥çš„ã€‚ä¸Šå±‚çš„ç»„ä»¶å¯ä»¥é€šè¿‡  props å‘ä¸‹å±‚ç»„ä»¶ä¼ é€’æ•°æ®ã€‚ä¹Ÿå°±æ˜¯çˆ¶ç»„ä»¶å¯ä»¥å•å‘çš„å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ã€‚
2. Vue å’Œ React ä¸­ï¼Œæ¯ä¸ªç»„ä»¶å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªå•å‘æ•°æ®æµï¼š
   - ä¸€ä¸ªç»„ä»¶ä»åŠŸèƒ½çš„å®ç°ä¸Šçœ‹ï¼Œæœ‰ä¸‰ä¸ªæ¨¡å—ï¼š
     1. UIï¼Œç»„ä»¶æœ€ç»ˆå±•ç¤ºçš„æ•°æ®å’Œç•Œé¢ï¼›
     2. actionï¼Œå¯¹ç»„ä»¶ä¸­æ•°æ®çš„æ“ä½œæ–¹å¼ï¼Œæ¯”å¦‚å¢åˆ æ”¹ç­‰æ“ä½œï¼›
     3. Stateï¼Œç»„ä»¶æ•°æ®ä¿å­˜çš„åœ°æ–¹ï¼Œç»„ä»¶çš„çŠ¶æ€ã€‚
   - æ‰€ä»¥ï¼Œåœ¨ UIã€actionã€State ä¹‹é—´ä¹Ÿæ˜¯æŒ‰ç…§å•å‘æ•°æ®æµä¼ é€’çš„ï¼š
     - åœ¨ UI é¡µé¢ä¸­ï¼Œç”¨æˆ·é€šè¿‡äº¤è´§äº§ç”Ÿäº†å¯¹æ•°æ®çš„æ“ä½œï¼Œè§¦å‘ actionï¼›
     - React æ¥æ”¶åˆ°ç‰¹å®šçš„ action æ“ä½œï¼Œè¿›è€Œå¯¹ç»„ä»¶çš„ State è¿›è¡Œä¿®æ”¹ï¼›
     - ç»„ä»¶çš„ State ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè§¦å‘ `render()` é‡æ–°æ¸²æŸ“ UI ï¼Œé¡µé¢å‘ç”Ÿå˜åŒ–ã€‚
3. Redux ä¸­ï¼Œå¯¹æ•°æ®çš„æ“ä½œä¹Ÿæ˜¯ä¸€ä¸ªå•é¡¹æ•°æ®æµï¼š
   - ä¸€ä¸ª Store ä»å¯¹æ•°æ®çš„æ“ä½œæ¥çœ‹ï¼Œæœ‰ 3 ä¸ªæ¨¡å—ï¼š
     1. UIï¼Œç»„ä»¶æœ€ç»ˆå±•ç¤ºçš„æ•°æ®å’Œç•Œé¢ï¼›
     2. Dispatchï¼Œç»„ä»¶ä¸­å¯¹æ•°æ®çš„æ“ä½œæ–¹å¼ï¼Œæ¯”å¦‚å¢åˆ æ”¹ç­‰æ“ä½œï¼›
     3. Storeï¼Œç»„ä»¶ä¸­ä¿å­˜æ•°æ®çš„åœ°æ–¹ã€‚
        - Reducerï¼ŒStore ä¸­ä¿å­˜å¯¹æ•°æ®æ“ä½œçš„åœ°æ–¹ã€‚Dispatch è§¦å‘ Reducer ï¼Œå®Œæˆå¯¹æ•°æ®çš„æ“ä½œã€‚
        - Stateï¼ŒStore ä¸­ä¿å­˜æ•°æ®çš„åœ°æ–¹ã€‚
     4. æ‰€ä»¥ï¼Œæ•°æ®åœ¨UIã€Dispatchã€Storeï¼ˆReducerã€Stateï¼‰ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªå•é¡¹æ•°æ®æµï¼š
        - ç”¨æˆ·é€šè¿‡ UI ç•Œé¢è§¦å‘äº‹ä»¶ï¼Œå¼•å‘ Dispatch æ´¾å‘ç”³è¯·å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼›
        - Dispatch è°ƒç”¨ Store ä¸­çš„ Reducerï¼Œé€šè¿‡æºå¸¦çš„ action è¯†åˆ« Reducer ä¸­å¯¹åº”çš„æ“ä½œã€‚ç„¶åä¿®æ”¹æ•°æ®ï¼›
        - ä¿®æ”¹åçš„æ•°æ®ä¼šæ›´æ–° Store ä¸­çš„ Stateã€‚
        - æ•°æ®æ›´æ–°å®Œæ¯•åï¼Œä¼šé€šçŸ¥ React ç»„ä»¶ï¼Œæœ€ç»ˆ `render()` é‡æ–°æ¸²æŸ“ UI ç•Œé¢ã€‚



# 9 React Hooks

å¯¹å‡½æ•°å¼ç»„ä»¶æ‰©å±•äº†åŠŸèƒ½ï¼Œå¯ä»¥è®©å‡½æ•°å¼ç»„ä»¶ä¹Ÿæ‹¥æœ‰ class ç»„ä»¶çš„å„ç§æ–¹æ³•ã€‚

```jsx
const [currentPage, setCurrentPage] = useState(1);

const { topAlbums, total } = useSelector(
  (state) => ({
    topAlbums: state.getIn(["album", "topAlbums"]),
    total: state.getIn(["album", "topTotal"]),
  }),
  shallowEqual
);
const dispatch = useDispatch();

useEffect(() => {
  dispatch(getTopAlbumsAction(1));
  dispatch(changeTopAreaAction());
}, [dispatch]);
```





## 9.1 class ç»„ä»¶ç¼ºç‚¹

Class ç»„ä»¶å­˜åœ¨é—®é¢˜ï¼š

- class ä¸­æœ‰éå¸¸å¤šçš„æ¨¡å¼é—®é¢˜ï¼šthis æŒ‡å‘é—®é¢˜ï¼Œconstructor é—®é¢˜ç­‰ç­‰ã€‚
- ç»„ä»¶çš„å¤ç”¨éå¸¸éº»çƒ¦ï¼šéœ€è¦é€šè¿‡é«˜é˜¶ç»„ä»¶å»å¤ç”¨ã€‚



## 9.2 hooks

### ä¸‰ä¸ªåŸºæœ¬ hooks + å…­ä¸ªæ‰©å±• hooks

- useStateã€useEffectã€createContext

- useReducerã€useCallbackã€useMemoã€useRefã€useImperativeHandleã€useLayoutEffect

  

#### useState

åˆ›å»ºä¸€ä¸ª state ï¼Œæä¾›äº† state å€¼ countï¼Œå’Œæ›´æ–° state çš„æ–¹æ³• setCountã€‚

```js
const [count, setCount] = useState(0);
```



#### useEffect

å¦‚æœä¸æ·»åŠ æœ«å°¾çš„ä¾èµ–æ•°ç»„ï¼š

- åªè¦ç»„ä»¶è°ƒç”¨è¢«é‡æ–°æ¸²æŸ“ï¼Œå°±ä¼šè§¦å‘ `useEffect` çš„å›è°ƒå‡½æ•°ï¼ˆä¸æ‰§è¡Œ `return` å†…çš„å›è°ƒå‡½æ•°ï¼‰ï¼›

- åªè¦ç»„ä»¶è°ƒç”¨è¢«å¸è½½ï¼Œå°±ä¼šè§¦å‘ `useEffect` å›è°ƒå‡½æ•° `return` çš„å›è°ƒå‡½æ•°ã€‚

é‡æ–°æ¸²æŸ“ï¼šç›¸å½“äºï¼š`componenWillMount` + `componentWillUpdate`

å¸è½½ï¼šç›¸å½“äº `componentDidupdate`



å¦‚æœæœ«å°¾æ·»åŠ ä¸€ä¸ªç©ºç™½çš„ä¾èµ–æ•°ç»„ `[]`ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç»„ä»¶æ—¶æ‰§è¡Œå›è°ƒï¼Œå¸è½½ç»„ä»¶æ—¶æ‰§è¡Œ returnã€‚

é‡æ–°æ¸²æŸ“ï¼šç›¸å½“äºï¼š`componentDidMount`



å¦‚æœä¾èµ–ä¸­æ·»åŠ äº†å˜é‡ä¾èµ–ï¼Œåˆ™å¦‚æœå˜é‡å€¼å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šé‡æ–°å®šä¹‰ `useEffect` ä¸­çš„å›è°ƒå‡½æ•°ã€‚

```jsx
//åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ hooks
useEffect(()=>{
    console.log("è®¢é˜…ä¸€äº›äº‹ä»¶")
    console.log(â€œåªè¦ç»„ä»¶é‡æ–°æ¸²æŸ“å°±ä¼šè°ƒç”¨è¿™é‡Œï¼Œç›¸å½“äºcomponentDidMount+componentDidUpdateâ€)
    
    return ()=>{
        console.log("å–æ¶ˆè®¢é˜…äº‹ä»¶")
        console.log("åœ¨å¸è½½ç»„ä»¶å‰ï¼Œæˆ–é‡æ–°æ¸²æŸ“ç»„ä»¶å‰ï¼Œéƒ½ä¼šè°ƒç”¨è¿™é‡Œ")
    }
})

//ç»™useEffectæ·»åŠ äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸€ä¸ªç©ºæ•°ç»„
useEffect(()=>{
    console.log(â€œç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“è°ƒç”¨è¿™é‡Œï¼Œç›¸å½“äºcomponentDidMountâ€)
    
    return ()=>{
        console.log("å–æ¶ˆè®¢é˜…äº‹ä»¶")
        console.log("åœ¨å¸è½½ç»„ä»¶å‰è°ƒç”¨è¿™é‡Œ,ç›¸å½“äºcomponentWillUnmount")
    }
},[])
```



#### createContext

![image-20211022151723448](react%E5%A4%8D%E4%B9%A0/image-20211022151723448.png)

 ä½¿ç”¨ Context Hookå°±å¯ä»¥è§£å†³ä½¿ç”¨æ—¶å±‚å±‚åµŒå¥—çš„è¿™ä¸ªé—®é¢˜ï¼š



å¦‚ä½•ä½¿ç”¨context

-   é¦–å…ˆè¦å¼•å…¥ React å†…ç½®çš„ React Context API ğŸ“¦
-   ç„¶ååˆ›å»º `provider`ï¼Œæä¾›æ•°æ®çš„ç»„ä»¶é€šè¿‡ provider æŠŠæ•°æ®ä¼ è¾“å‡ºå»ã€‚
-   æœ€ååˆ›å»º  `consumer ` ï¼Œä½¿ç”¨æ•°æ®çš„ç»„ä»¶ï¼Œé€šè¿‡ `consumer` è·å¾—æ•°æ®ã€‚ä½¿ç”¨ usecontext hook å¯ä»¥ä¸ç”¨åˆ›å»º `consumer`

å½“ Provider çš„ `value` å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰æ¶ˆè´¹ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚Provider åŠå…¶å†…éƒ¨ consumer ç»„ä»¶éƒ½ä¸å—åˆ¶äº `shouldComponentUpdate` å‡½æ•°ï¼Œå› æ­¤å½“ consumer ç»„ä»¶åœ¨å…¶ç¥–å…ˆç»„ä»¶é€€å‡ºæ›´æ–°çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ›´æ–°ã€‚

é“¾æ¥ï¼šhttps://juejin.cn/post/6989054367064129573



### useReducer

1. useReducer æ˜¯ useState hooks çš„æ‰©å±•ã€‚åœ¨é€»è¾‘ç›¸å¯¹å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨ reducer çš„ switch è¿›è¡Œåˆ¤æ–­ï¼Œé€šè¿‡ dispatch è¾¾åˆ°å¯¹åŒä¸€ä¸ª state æœ‰ä¸åŒçš„æ›´æ–°æ–¹æ³•ã€‚
2. å¦‚æœå¤šä¸ªç»„ä»¶å‡æœ‰ä¸€ä¸ªç›¸åŒçš„åˆ¤æ–­æ–¹å¼ï¼ˆå¯ä»¥ç”¨åŒä¸€ä¸ª switch åˆ¤æ–­ï¼‰ï¼Œé‚£ä¹ˆå•ç‹¬å®šä¹‰ä¸€ä¸ª reducer çº¯å‡½æ•°ï¼Œç„¶åä¸åŒçš„ç»„ä»¶ import å¼•å…¥è¿™ä¸ª reducer å³å¯ã€‚

ä½¿ç”¨1ï¼šåœ¨ä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ reducerï¼š

```jsx
// 1 å¼•å…¥ useReducer
import React, { useReducer } from "react";

// 2 å®šä¹‰ reduceræ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šè¦æ“ä½œçš„æ•°æ® stateï¼Œæ“ä½œçš„æ–¹æ³•åç§° action
function reducer(state, action) {
  switch (action.type) {
    case "increment":
      return { ...state, counter: state.counter + 1 };
    case "decrement":
      return { ...state, counter: state.counter - 1 };
    default:
      return;
  }
}

export default function Home() {
  // 3 åˆ›å»ºä¸€ä¸ª Reducerï¼Œè¾“å…¥ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªreduceræ–¹æ³•ï¼Œä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œ
  // 	useReducer ä¼šè¿”å›ä¸¤ä¸ªç»“æ„ï¼š
  // 		1. å­˜æ”¾æ•°æ®çš„ state å¯¹è±¡ï¼Œä¿å­˜çš„å°±æ˜¯ {counter:0}ï¼Œ
  //		2. è§¦å‘ action çš„æ–¹æ³•ï¼Œdispatchï¼Œä½¿ç”¨ dispatch æ¥æ“ä½œ stateã€‚
  const [state, dispatch] = useReducer(reducer, { counter: 0 });

  return (
    <div>
      <h2>Homeå½“å‰è®¡æ•°ï¼š{state.counter}</h2>
      {/* 4 å¯¹stateè¿›è¡Œæ“ä½œï¼Œé€šè¿‡è°ƒç”¨ dispatch()æ–¹æ³•ï¼Œä¼ å…¥actionå¯¹è±¡ï¼Œæˆå‘˜æœ‰æ“ä½œçš„æ–¹æ³•åç§°typeã€‚*/}
      {/*  Reactä¼šæ‹¿ç€æ–¹æ³•åç§° action.typeåœ¨reducerçº¯å‡½æ•°ä¸­é‡æ‰¾å¯¹åº”çš„æ“ä½œæ–¹æ³•ï¼Œç„¶åæ›´æ–°state*/}       
      <button onClick={(e) => dispatch({ type: "increment" })}>+1</button>
      <button onClick={(e) => dispatch({ type: "decrement" })}>-1</button>
    </div>
  );
}
```



ä½¿ç”¨2ï¼šå¤šä¸ªç»„ä»¶å…±ç”¨ä¸€ä¸ª reducerï¼š

- éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ `useReducer` åªæ˜¯å¯¹ `useState` çš„ä¸€ç§ç‰¹æ®Šç”¨æ³•ã€‚ä½¿ç”¨æ–¹å¼ç±»ä¼¼äº† redux ä¸­çš„ reducerã€‚ä½†æ˜¯ `useReducer` æ˜¯æ— æ³•å…±äº« state æ•°æ®çš„ï¼Œå’Œ redux ä¹Ÿæ¯«æ— å…³ç³»ã€‚å”¯ä¸€å¯ä»¥å…±äº«çš„åªæ˜¯ `reducer` çº¯å‡½æ•°ï¼Œæ“ä½œ state çš„æ–¹æ³•ã€‚

```jsx
// reducer.js
// å¯¼å‡ºä¸€ä¸ª reducer çº¯å‡½æ•°
export default function reducer(state, action) {
    switch(action.type) {
        case "increment":
            return {...state, counter: state.counter + 1};
        case "decrement":
            return {...state, counter: state.counter - 1};
        default:
            return state;
    }
}


// home.js
// Home ç»„ä»¶ç­‰å…¶ä»–ç»„ä»¶å¯ä»¥å…±ç”¨è¿™ä¸ªæ–¹æ³•
import React, { useReducer } from "react";
// å¼•å…¥ Reducer çº¯å‡½æ•°
import reducer from './reducer'

export default function Home() {
  const [state, dispatch] = useReducer(reducer, { counter: 0 });

  return (
    <div>
      <h2>Home å½“å‰è®¡æ•°ï¼š{state.counter}</h2>
      <button onClick={(e) => dispatch({ type: "increment" })}>+1</button>
      <button onClick={(e) => dispatch({ type: "decrement" })}>-1</button>
    </div>
  );
}


// about.js
// About ç»„ä»¶ç­‰å…¶ä»–ç»„ä»¶å¯ä»¥å…±ç”¨è¿™ä¸ªæ–¹æ³•
import React, { useReducer } from "react";
// å¼•å…¥ Reducer çº¯å‡½æ•°
import reducer from './reducer'

export default function About() {
  const [state, dispatch] = useReducer(reducer, { counter: 0 });

  return (
    <div>
      <h2>About å½“å‰è®¡æ•°ï¼š{state.counter}</h2>
      <button onClick={(e) => dispatch({ type: "increment" })}>+1</button>
      <button onClick={(e) => dispatch({ type: "decrement" })}>-1</button>
    </div>
  );
}
```



###  useCallback

éœ€è¦é…åˆ `PureComponent` ä½¿ç”¨ã€‚PureComponent å®ç°äº†å¦‚æœå­ç»„ä»¶çš„ props å’Œ state æ²¡æœ‰å˜åŒ–ï¼Œå°±ä¸ä¼šéšç€çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“è€Œé‡æ–°æ¸²æŸ“ã€‚

- å®é™…ç›®çš„æ˜¯ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ã€‚ç”¨äº **å­ç»„ä»¶éœ€è¦å‘çˆ¶ç»„ä»¶ä¼ é€’ä¿¡æ¯ï¼Œæ‰€ä»¥é€šè¿‡è°ƒç”¨çˆ¶ç»„ä»¶ props ä¼ é€’çš„å›è°ƒå‡½æ•°æ¥å®ç°** æ—¶ä½¿ç”¨ã€‚
- æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç¼“å­˜äº†çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„ä¸€ä¸ªã€å›è°ƒæ–¹æ³•ã€‘ã€‚

å¦‚ä½•è¿›è¡Œä¼˜åŒ–?

1. useCallbackä¼šè¿”å›ä¸€ä¸ªå‡½æ•°çš„ memoizedï¼ˆè®°å¿†çš„ï¼‰å€¼ï¼›
2. åœ¨ä¾èµ–ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå¤šæ¬¡å®šä¹‰çš„æ—¶å€™ï¼Œè¿”å›çš„å€¼æ˜¯ç›¸åŒçš„ã€‚
   - åªæœ‰å®šä¹‰çš„ä¾èµ–å‘ç”Ÿæ”¹å˜ï¼Œè¿”å›çš„å€¼æ‰ä¼šæ”¹å˜ã€‚

![image-20211025110244222](react%E5%A4%8D%E4%B9%A0/image-20211025110244222.png)



useCallBack çš„ä½¿ç”¨ï¼Œåœ¨çˆ¶ç»„ä»¶å®šä¹‰å›è°ƒå‡½æ•°æ˜¯åŒ…è£¹ï¼š

```jsx
const increment2 = useCallback(() => {
    console.log("æ‰§è¡Œincrement2å‡½æ•°");
    setcount(count + 1);
}, [count]);
```

- åªè¦ä¾èµ– `count` å˜é‡å‘ç”Ÿå˜åŒ–ï¼ŒuseCallBack å°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å€¼ï¼ŒuseCallBack å‚æ•°ä¸­çš„å›è°ƒå‡½æ•°ä¼šè¢« **é‡æ–°å®šä¹‰**ï¼Œä¹Ÿå°±æ˜¯è¯´ increment2 ä¼šè¢«é‡æ–°å®šä¹‰ã€‚
- ä½†æ˜¯ï¼Œå¦‚æœ `count` å˜é‡æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒuseCallBack å°±ä¼šè¿”å›ä¸€ä¸ªç›¸åŒçš„å€¼ã€‚increment2 ä¸ä¼šè¢«é‡æ–°å®šä¹‰ã€‚



#### æƒ…å†µäºŒï¼šæœ‰æ•ˆä½¿ç”¨

useCallback æœ‰æ€§èƒ½ä¼˜åŒ–ï¼š

useCallback åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ

åœºæ™¯ï¼šçˆ¶ç»„ä»¶æœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼ é€’ç»™ä»–çš„å­ç»„ä»¶ã€‚å½“çˆ¶ç»„ä»¶å‘ç”Ÿæ¸²æŸ“ï¼Œå³ä½¿å­ç»„ä»¶çš„ state æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚ä½†æ˜¯ `props` ä¸­çš„ â€œè¿™ä¸ªå›è°ƒå‡½æ•°â€ å› ä¸ºçˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“è€Œè¢«é‡å®šä¹‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´é‡æ–°æ¸²æŸ“åçš„å›è°ƒå‡½æ•°è™½ç„¶å’Œä¹‹å‰çš„å›è°ƒå‡½æ•°é•¿å¾—ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯åœ°å€ä¸åŒäº†ï¼Œè¿™æ—¶å€™å­ç»„ä»¶ä¾ç„¶è¦è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚

æ‰€ä»¥ï¼šå½“çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°æ—¶ï¼Œçˆ¶ç»„ä»¶å¯ä»¥æŠŠè¿™ä¸ªå›è°ƒå‡½æ•°ç”¨ `useCallBack` åŒ…è£¹ä¸€ä¸‹ï¼Œé˜²æ­¢å­ç»„ä»¶å› ä¸ºè¿™ä¸ªå›è°ƒå‡½æ•°è€Œé¢‘ç¹æ¸²æŸ“ã€‚



**å‰ç½®çŸ¥è¯†ï¼š**

çˆ¶ç»„ä»¶æ¸²æŸ“ï¼Œå­ç»„ä»¶ä¹Ÿä¸€å®šä¼šæ¸²æŸ“ã€‚

å¦‚æœå¸Œæœ›çˆ¶ç»„ä»¶å‘ç”Ÿæ¸²æŸ“æ—¶ï¼Œå¦‚æœå­ç»„ä»¶åœ¨å…¶å†…éƒ¨æ²¡æœ‰ state å’Œ props å˜åŒ–ï¼Œå°±èŠ‚çº¦å¼€é”€ä¸å‘ç”Ÿæ¸²æŸ“ï¼Œå°±é‡‡å–ï¼š

- ç±»ç»„ä»¶ä¸­ï¼šç»„ä»¶ç»§æ‰¿ `PureComponent` ç±»ï¼Œå¿«æ·é”® `rpc`ï¼›
- å‡½æ•°ç»„ä»¶ä¸­ï¼šç»„ä»¶ç”¨ `memo()` åŒ…è£¹ã€‚



è¿›ä¸€æ­¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å­ç»„ä»¶ä¸­ï¼Œ`state` å’Œ `props` å˜åŒ–å—å½±å“çš„å›è°ƒå‡½æ•°ï¼Œéœ€è¦è¿›è¡Œé‡å®šä¹‰ã€‚è€Œä¸å—å½±å“çš„å›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸è¦é‡å®šä¹‰ï¼Œè¿™æ˜¯æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ `useCallBack`ã€‚

- å…ˆç”¨ `memo()` åŒ…è£¹è¿™ä¸ªå‡½æ•°ç»„ä»¶ï¼›
- å†ç”¨ `useCallBack` Hookã€‚



### 3.4 useMemo

![image-20211025142143471-16366968314207](reactå¤ä¹ /image-20211025142143471-16366968314207.png)

ä½¿ç”¨æ–¹å¼ï¼š

1. useMemo éœ€è¦ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼š
   1. å‚æ•°ä¸€ï¼šå›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œå›è°ƒåï¼Œå›è°ƒçš„è¿”å›å€¼ä¼šä½œä¸º `useMemo()` å‡½æ•°çš„è¿”å›å€¼ã€‚
   2. å‚æ•°äºŒï¼šä¾èµ–å€¼ï¼Œåªæœ‰ä¾èµ–å€¼å‘ç”Ÿå˜åŒ–ï¼Œæ‰ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚
2. useMemo æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼š
   - è¿”å›çš„å€¼å°±æ˜¯å›è°ƒå‡½æ•°çš„è¿”å›å€¼ã€‚

ç›¸å½“äºç»™å›è°ƒå‡½æ•°å¤–é¢åŒ…è£¹äº†ä¸€ä¸ªå£³å­ã€‚è¿™å¯¼è‡´äº†å›è°ƒå‡½æ•°ä¸ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“ç»„ä»¶çš„æ—¶å€™éƒ½è¢«æ‰§è¡Œï¼Œè€Œæ˜¯æœ‰æ¡ä»¶çš„åœ¨ count å‘ç”Ÿæ›´æ–°æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œã€‚æå‡äº†æ€§èƒ½ã€‚





#### **ä½¿ç”¨åœºæ™¯ä¸€ï¼šå¤æ‚è®¡ç®—**

**åªæœ‰å½“åˆ›å»ºè¡Œä¸ºæœ¬èº«ä¼šäº§ç”Ÿé«˜æ˜‚çš„å¼€é”€ï¼ˆæ¯”å¦‚è®¡ç®—ä¸Šåƒæ¬¡æ‰ä¼šç”Ÿæˆå˜é‡å€¼ï¼‰ï¼Œæ‰æœ‰å¿…è¦ä½¿ç”¨ `useMemo`ï¼Œå½“ç„¶è¿™ç§åœºæ™¯å°‘ä¹‹åˆå°‘ã€‚**

```jsx
import React, { useState } from "react";

export default function MemoHookDemo01() {
  const [count, setCount] = useState(10);
  const [show, setShow] = useState(true);

  function calcNumber(count) {
    console.log("æ‰§è¡Œäº†clcNumber");
    let total = 0;
    for (let i = 1; i <= count; i++) {
      total += i;
    }
    return total;
  }

  return (
    <div>
      <h2>è®¡ç®—æ•°å­—çš„å’Œï¼š{calcNumber(count)}</h2>
      <button onClick={(e) => setCount(count + 1)}> +1 </button>
      <button onClick={(e) => setShow(!show)}>showåˆ‡æ¢</button>
    </div>
  );
}
```

 ![image-20211025164829514](react%E5%A4%8D%E4%B9%A0/image-20211025164829514.png)

å½“æˆ‘ä»¬ç‚¹å‡» â€œshowåˆ‡æ¢â€ çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ° `calcNumber` ä¹Ÿé‡æ–°æ‰§è¡Œäº†ã€‚

ä½†æ˜¯ï¼Œå½“ç‚¹å‡» â€œshowåˆ‡æ¢â€ æ—¶ï¼Œåªæ”¹å˜ `state` ä¸­ `show` çš„å€¼ï¼Œè€Œæ²¡æœ‰æ”¹å˜ `count` çš„å€¼ã€‚æ‰€ä»¥åœ¨ç†æƒ³çŠ¶æ€ä¸‹ï¼Œå¦‚æœ count çš„å€¼ä¸å‘ç”Ÿæ”¹å˜ï¼Œæœ€å¥½å¯ä»¥ä¸æ‰§è¡Œ `calcNumber ` æ–¹æ³•ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®— `total` çš„å€¼ã€‚

è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ `useMemo()` æ–¹æ³•äº†ã€‚

```jsx
import React, { useMemo, useState } from "react";

// ä½¿ç”¨ useMemo è§£å†³æ€§èƒ½é—®é¢˜ã€‚
export default function MemoHookDemo012() {
  const [count, setCount] = useState(10);
  const [show, setShow] = useState(true);

  function calcNumber(count) {
    console.log("æ‰§è¡Œäº†clcNumber");
    let total = 0;
    for (let i = 1; i <= count; i++) {
      total += i;
    }
    return total;
  }

  // ä½¿ç”¨ UseMemo
  const total = useMemo(() => {
    return calcNumber(count);
  }, [count]);

  return (
    <div>
      <h2>è®¡ç®—æ•°å­—çš„å’Œï¼š{total}</h2>
      <button onClick={(e) => setCount(count + 1)}> +1 </button>
      <button onClick={(e) => setShow(!show)}>showåˆ‡æ¢</button>
    </div>
  );
}
```

è¿™æ—¶ç‚¹å‡» â€œshowåˆ‡æ¢â€ åï¼Œå°±ä¸ä¼šæ‰§è¡Œ `calcNumber` äº†ï¼Œæ§åˆ¶å°æ²¡æœ‰è¾“å‡ºã€‚



#### ä½¿ç”¨åœºæ™¯äºŒï¼šçˆ¶ç»„ä»¶ç»™å­ç»„ä»¶é€šè¿‡ props ä¼ é€’å±€éƒ¨å˜é‡

```jsx
import React, { useState, memo } from "react";

// å­
const LJInfo = memo((props) => {
  console.log("LJInfoé‡æ–°æ¸²æŸ“");
  return (
    <div>
      <h2>å§“åï¼š{props.info.name}</h2>
      <h2>å¹´é¾„ï¼š{props.info.age}</h2>
    </div>
  );
});

// çˆ¶
export default function MemoHookDemo021() {
  console.log("MemoHookDemo02æ¸²æŸ“");
  const info = { name: "Moxy", age: 18 };
  const [show, setShow] = useState(true);

  return (
    <div>
      <HYInfo info={info} />
      <button onClick={(e) => setShow(!show)}>showåˆ‡æ¢</button>
    </div>
  );
}
```

å³ä½¿å­ç»„ä»¶æœ‰ `memo()` åµŒå¥—ï¼Œå½“ç‚¹å‡» `button` åï¼Œçˆ¶ç»„ä»¶çš„ show æ›´æ–°ï¼Œå¯¼è‡´äº†çˆ¶ç»„å»ºé‡æ–°æ¸²æŸ“ï¼Œå¯¼è‡´äº† info ä¹Ÿæ›´æ–°ï¼Œå¯¼è‡´äº†å­ç»„å»ºé‡æ–°æ¸²æŸ“ã€‚

- å¯ä»¥é€šè¿‡æŠŠ `info` å±€éƒ¨å˜é‡è½¬åŒ–ä¸º useState ä¿å­˜ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚

![image-20211025171537955](react%E5%A4%8D%E4%B9%A0/image-20211025171537955.png)

çˆ¶ç»„ä»¶ `MemoHookDemo021` æœ‰ï¼š

1. å˜é‡ï¼š
   1. state ä¸­æœ‰ `show` å˜é‡
   2. æœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡ `info`ï¼Œä¿å­˜äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡æˆå‘˜æ˜¯ `name` å’Œ `age`ã€‚
2. æ“ä½œï¼š
   1. å±€éƒ¨å˜é‡ `info` é€šè¿‡ `props` ä¼ é€’ç»™å­ç»„ä»¶ã€‚
   2. ç‚¹å‡» `button` åï¼Œä¼šæ”¹å˜ show çš„å€¼ã€‚ä½†ä¸å½±å“ `info` çš„å€¼ã€‚

å­ç»„ä»¶ `HYInfo` æœ‰ï¼š

1. å­ç»„ä»¶é€šè¿‡ `memo()` åŒ…è£¹ã€‚
2. é€šè¿‡ `props` æ¥æ”¶åˆ°çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ `info` é‡Œé¢ä¿å­˜äº† `name` å’Œ `age`ï¼Œç„¶åæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚



è™½ç„¶å­ç»„ä»¶é€šè¿‡ `memo()` åŒ…è£¹ï¼Œå½“çˆ¶ç»„ä»¶ä¸­ä¼ é€’è¿‡æ¥çš„ `props` å’Œè‡ªèº« `state` ä¸å‘ç”Ÿæ”¹å˜ï¼Œçˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“å°±ä¸ä¼šå¯¼è‡´å­ç»„ä»¶ä¹Ÿè·Ÿç€é‡æ–°æ¸²æŸ“ã€‚

ä½†æ˜¯æœ¬ä¾‹ä¸­çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ `info` æ˜¯çˆ¶ç»„ä»¶çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å½“çˆ¶ç»„ä»¶ç‚¹å‡» `button` åï¼Œå‘ç”Ÿäº†çˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œç„¶åå±€éƒ¨å˜é‡ `info` å°±ä¼šè¢«é‡æ–°å®šä¹‰ã€‚æ­¤æ—¶ä¼ é€’ç»™å­ç»„ä»¶çš„ `info` å·²ç»ä¸å†æ˜¯ä¸Šä¸€æ¬¡ä¼ é€’çš„ `info` äº†ï¼Œé€šè¿‡ `memo()` çš„æµ…å¯¹æ¯”å‘ç° `props` ä¸ä¸€è‡´ï¼Œæ‰€ä»¥å­ç»„ä»¶ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚



**ä½¿ç”¨ useMemo**

```jsx
import React, { useState, memo } from "react";

const LJInfo = memo((props) => {
  console.log("LJInfoé‡æ–°æ¸²æŸ“");
  return (
    <div>
      <h2>å§“åï¼š{props.info.name}</h2>
      <h2>å¹´é¾„ï¼š{props.info.age}</h2>
    </div>
  );
});

export default function MemoHookDemo021() {
  console.log("MemoHookDemo02æ¸²æŸ“");
  const info = useMemo(()=>{ name: "Moxy", age: 18 }, []);
  const [show, setShow] = useState(true);

  return (
    <div>
      <HYInfo info={info} />
      <button onClick={(e) => setShow(!show)}>showåˆ‡æ¢</button>
    </div>
  );
}
```

 ![image-20211025173104321](react%E5%A4%8D%E4%B9%A0/image-20211025173104321.png)

åªéœ€è¦åœ¨ `info` å±€éƒ¨å˜é‡è·å–å€¼æ—¶ï¼Œå¤–å±‚å¥—ä¸€ä¸ª `useMemo()` å³å¯ã€‚å› ä¸ºè¿™é‡Œä¸éœ€è¦ä¾èµ–ä»»ä½•å€¼å˜åŒ–ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ã€‚

ä¸è®ºç‚¹å‡» â€œshowåˆ‡æ¢â€ å¤šå°‘æ¬¡ï¼Œéƒ½ä¸ä¼šå¯¼è‡´å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“äº†ã€‚



### useRef

ä½¿ç”¨ ref çš„å¦ä¸€ç§æ–¹æ³•ã€‚



1. ä¸ºä»€ä¹ˆä¸èƒ½å¼•ç”¨å‡½æ•°å¼ç»„ä»¶ï¼Ÿ

- ç­”ï¼šå› ä¸ºåªæœ‰ classç»„ä»¶ æ‰æœ‰å®ä¾‹ï¼Œå‡½æ•°ç»„ä»¶æ²¡æœ‰å®ä¾‹ï¼Œæ— æ³•è·å–ã€‚



2. **useRef ä¿å­˜çš„å€¼ / å…ƒç´ ä¸€ç›´ä¸å˜ï¼Œä¸è®ºç»„ä»¶å¦‚ä½•æ¸²æŸ“å˜åŒ–ï¼Œåªè¦æ˜¯åœ¨åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå°±ä¿æŒä¸å˜ ã€‚** 
   - é™¤éæ˜¯è‡ªå·±å¯¹å€¼é‡æ–°å®šä¹‰ï¼š



### useImperativeHandle

#### å›é¡¾ forwardRef çš„ç”¨æ³•

åœ¨çˆ¶ç»„ä»¶ï¼Œæƒ³é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ‹¿åˆ°å­ç»„ä»¶ä¸­çš„å…ƒç´ ã€‚

```jsx
import React, { useRef, forwardRef } from "react";

const HYInput = forwardRef((props, ref) => {
  return <input ref={ref} type="text" />;
});

export default function ForwardRefDemo() {
  const inputRef = useRef();
  return (
    <div>
      <HYInput ref={inputRef} />
      <button onClick={(e) => inputRef.current.focus()}>èšç„¦</button>
    </div>
  );
}
```

 ![image-20211025210250569](react%E5%A4%8D%E4%B9%A0/image-20211025210250569.png)

çˆ¶ç»„ä»¶çš„ `inputRef` ä¿å­˜äº†å­ç»„ä»¶ä¸­ `input` å…ƒç´ ã€‚ç„¶åç‚¹å‡»çˆ¶ç»„ä»¶çš„èšç„¦ `button` åï¼Œå­ç»„ä»¶çš„è¾“å…¥æ¡†è¢«èšç„¦ã€‚

1. çˆ¶ç»„ä»¶æ˜¯ä½¿ç”¨ `useRef()` åˆ›å»ºä¸€ä¸ª `ref` å˜é‡ã€‚ç„¶åé€šè¿‡ `props` ä¼ é€’ç»™å­ç»„ä»¶ `ref={inputRef}`ï¼›
2. å­ç»„ä»¶ `HYInput` é€šè¿‡ä¸€ä¸ª`forwardRef` åŒ…è£¹ã€‚å°±å¯ä»¥æŠŠçˆ¶ç»„ä»¶çš„ `ref` å˜é‡ä¼ é€’è¿‡æ¥èµ‹å€¼å…ƒç´ ã€‚
3. `forwardRef` æ‹¥æœ‰ä¸¤ä¸ªå‚æ•° `(props, ref)`ï¼Œç„¶åç›´æ¥æŠŠ ref æ·»åŠ åˆ°å…ƒç´ çš„æ ‡ç­¾åå³å¯ã€‚



#### useImperativeHandle çš„ç”¨æ³•

![image-20211025215739530](react%E5%A4%8D%E4%B9%A0/image-20211025215739530.png)

forwardRef è™½ç„¶å¯ä»¥å®ç°çˆ¶ç»„ä»¶æŠ“å–å­ç»„ä»¶çš„å…ƒç´ ã€‚ 

æœ‰ç¼ºç‚¹ï¼šå­ç»„ä»¶æŠŠè‡ªå·±çš„å…ƒç´ æš´éœ²å¤ªå¤šäº†ï¼Œçˆ¶ç»„ä»¶è·å–åˆ°å­ç»„ä»¶æŸä¸ªå…ƒç´ çš„ ref åï¼Œå¯ä»¥å¯¹å­ç»„ä»¶çš„è¿™ä¸ª DOM å…ƒç´ ä»»æ„ä¿®æ”¹ã€‚

useImperativeHandle å¯ä»¥é™åˆ¶è¿™ä¸ªå…ƒç´ æš´éœ²å“ªäº›è¦ç´ ï¼Œç¦æ­¢æš´éœ²å“ªäº›è¦ç´ 



### 3.7 useLayoutEffect

![image-20211025215905883](react%E5%A4%8D%E4%B9%A0/image-20211025215905883.png)

![image-20211025220008168](react%E5%A4%8D%E4%B9%A0/image-20211025220008168.png)

useEffect çš„æ‰§è¡Œæµç¨‹ï¼š

1. Component çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œç»„ä»¶é‡æ–° renderedã€‚
2. é‡æ–°è°ƒç”¨ç»„ä»¶ä»£ç ï¼Œç„¶åè·å–åˆ° return çš„ jsx ç»“æ„ã€‚
3. é€šè¿‡ diff ç®—æ³•ï¼Œç”Ÿæˆè™šæ‹Ÿ DOMã€‚
4. ç„¶åæŠŠ  è™šæ‹Ÿ DOM åŒæ­¥åˆ° çœŸå® DOM ä¸Šã€‚ï¼ˆé¡µé¢å˜åŒ–ï¼‰
5. æœ€åæ‰§è¡Œ useEfffectã€‚



useLayoutEffect çš„æ‰§è¡Œæµç¨‹ï¼š

1. Component çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œç»„ä»¶é‡æ–° renderedã€‚
2. é‡æ–°è°ƒç”¨ç»„ä»¶ä»£ç ï¼Œç„¶åè·å–åˆ° return çš„ jsx ç»“æ„ã€‚
3. é€šè¿‡ diff ç®—æ³•ï¼Œç”Ÿæˆè™šæ‹Ÿ DOMã€‚
4. æ‰§è¡Œ useLayoutEffectï¼Œæ­¤æ—¶ä¼š **é˜»å¡ DOM**ã€‚
   - **æœ‰å¯èƒ½é‡æ–°æ¸²æŸ“**ï¼šè¿™é‡Œå¯ä»¥ DOM è¿›è¡Œæ”¹åŠ¨ï¼Œå¦‚æœè¿›è¡Œäº†æ”¹åŠ¨ï¼Œä¼šå†æ‰§è¡Œä¸€é Component ä¸­çš„ renderï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Jsxï¼Œç„¶å diff ç®—æ³• ç”Ÿæˆè™šæ‹Ÿ DOMã€‚
5. æœ€åæ”¹åŠ¨çš„è™šæ‹Ÿ DOM åŒæ­¥åˆ° çœŸå® DOM ä¸Šã€‚ï¼ˆé¡µé¢å˜åŒ–ï¼‰



### 3.8 å¯¹æ¯”ï¼šmemoã€useCallback å’Œ useMemo

é¦–å…ˆï¼Œmemo å’Œ useCallback ã€useMemo æ˜¯ä¸åŒçš„ã€‚

- useCallback ã€useMemo æ˜¯ Hookï¼Œåœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨ï¼Œä»¥æå‡åŠ è½½æ€§èƒ½ã€‚
- è€Œ memo åœ¨ç»„ä»¶çš„å¤–éƒ¨ä½¿ç”¨ï¼Œé€šå¸¸æŠŠä¸€ä¸ªå‡½æ•°å­ç»„ä»¶åŒ…è£¹åœ¨ `memo()` ä¸­ã€‚
  - memo ä»…ç”¨åœ¨å‡½æ•°å­ç»„ä»¶ï¼Œè€Œå¯¹è±¡å­ç»„ä»¶æ˜¯ç”¨ PureComponentï¼Œæ•ˆæœç›¸åŒã€‚
  - memo çš„ä½œç”¨åŸç†æ˜¯ï¼Œå½“çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“åï¼Œmemo ä¼šæµ…å¯¹æ¯”çˆ¶ç»„ä»¶æ¸²æŸ“å‰åï¼Œå­ç»„ä»¶çš„ state å’Œ props æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ˆå¯¹è±¡å°±æ˜¯å¯¹æ¯”åœ°å€å€¼æ˜¯å¦ç›¸åŒï¼Œæ•°å€¼å°±ä»…å¯¹æ¯”æ•°å€¼ï¼‰ã€‚



å…¶æ¬¡ï¼Œå¯¹æ¯” useCallback å’Œ useMemoï¼š

ä¸åŒçš„æ˜¯ï¼š

- useCallback ç¼“å­˜äº†çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„ä¸€ä¸ªã€**å›è°ƒæ–¹æ³•**ã€‘ã€‚ç¼“å­˜çš„æ˜¯ä¸€ä¸ª **å‡½æ•°**ã€‚

- useMemo ç¼“å­˜äº†ä¸€ä¸ªã€å±€éƒ¨å˜é‡ã€‘ï¼Œç¼“å­˜çš„æ˜¯ä¸€ä¸ª **å€¼**ã€‚å¯ä»¥ç”¨äºç»„ä»¶å†…éƒ¨ç¼“å­˜å€¼ï¼Œä¹Ÿå¯ä»¥ç”¨äºçˆ¶ç»„ä»¶ç¼“å­˜ä¼ é€’ç»™å­ç»„ä»¶çš„å€¼ã€‚

- æ¢å¥è¯è¯´ï¼ŒuseCallback çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒuseMemo è¿”å›çš„æ˜¯ä»»æ„å€¼ï¼ˆæ•°å­—ã€å¯¹è±¡ã€å‡½æ•°ï¼‰ã€‚useMemo å¯ä»¥å®ç°ä¸€ä¸ª useCallbackã€‚

  ```jsx
  // ä¸‹é¢ä¸¤è€…çš„æ•ˆæœæ˜¯ç›¸åŒçš„
  const increment1 = useCallback(() => {
      console.log("æ‰§è¡Œincrememt1å‡½æ•°")
      setCount(count + 1)
  }, [count])
  
  const increment2 = useMemo(() =>{
      return () => {
          console.log("æ‰§è¡Œincrement2å‡½æ•°")
          setCount(count + 1)
      }
  },[count])
  ```

ç›¸åŒçš„æ˜¯ï¼š

-  `useCallback` å’Œ `useMemo` çš„è§¦å‘æ—¶æœºç›¸åŒï¼Œå¦‚æœä¼ é€’çš„ç¬¬äºŒä¸ªæ•°ç»„å‚æ•°ä¸­ï¼Œæœ‰ä¾èµ–çš„å˜é‡å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚



### 3.9 å¯¹æ¯”ï¼šComponent å’Œ PureComponent 

çˆ¶ç»„ä»¶æ¸²æŸ“ï¼Œå­ç»„ä»¶ä¹Ÿä¸€å®šä¼šæ¸²æŸ“ã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›å­ç»„ä»¶çš„ state å’Œ porps æ²¡æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œä¸è¦éšç€çˆ¶ç»„ä»¶å»æ¸²æŸ“ï¼Œå°±å¯ä»¥ä½¿ç”¨ PureComponentã€‚



â—ï¸â—ï¸**`PureComponent` ç»„ä»¶åˆ›å»ºäº†é»˜è®¤çš„ `shouldComponentUpdate` è¡Œä¸ºã€‚**

è¿™ä¸ªé»˜è®¤çš„ `shouldComponentUpdate` è¡Œä¸ºä¼šä¸€ä¸€æ¯”è¾ƒ `props` å’Œ `state` ä¸­æ‰€æœ‰çš„å±æ€§ï¼Œåªæœ‰å½“å…¶ä¸­ä»»æ„ä¸€é¡¹å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰ä¼šè¿›è¡Œé‡ç»˜ã€‚

- `PureComponent` ä½¿ç”¨æµ…æ¯”è¾ƒåˆ¤æ–­ç»„ä»¶æ˜¯å¦éœ€è¦é‡ç»˜ã€‚



## 4.4 è‡ªå®šä¹‰ Hook

![image-20211025224130856](react%E5%A4%8D%E4%B9%A0/image-20211025224130856.png)

ä½¿ç”¨ useEffect å°±å¯ä»¥å®ç°ï¼š

```jsx
useEffect(() => {
    console.log("CustomHookLifeDemo01ç»„ä»¶è¢«åˆ›å»ºäº†");
    return () => {
        console.log("CustomHookLifeDemo01ç»„ä»¶è¢«é”€æ¯äº†");
    };
}, []);
```

å¦‚æœæƒ³åœ¨ä¸€ä¸ªæ™®é€šå‡½æ•°ä¸­ä½¿ç”¨ hookï¼Œè¦ä½¿ç”¨è‡ªå®šä¹‰ hookï¼š

- åœ¨å‡½æ•°åç§°å‰æ·»åŠ  `use` å³å¯ã€‚

```jsx
// åœ¨æ™®é€šå‡½æ•°ä¸­ä½¿ç”¨ï¼Œæ˜¯ä¸å…è®¸çš„
function LoggingLife(name) {
    useEffect(() => {
        console.log("CustomHookLifeDemo01ç»„ä»¶è¢«åˆ›å»ºäº†");
        return () => {
            console.log("CustomHookLifeDemo01ç»„ä»¶è¢«é”€æ¯äº†");
        };
    }, []);
}

// åœ¨è‡ªå®šä¹‰Hookä¸­ä½¿ç”¨ï¼Œå¯ä»¥ï¼š
function useLoggingLife(name) {
    useEffect(() => {
        console.log("CustomHookLifeDemo01ç»„ä»¶è¢«åˆ›å»ºäº†");
        return () => {
            console.log("CustomHookLifeDemo01ç»„ä»¶è¢«é”€æ¯äº†");
        };
    }, []);
}
```



# 10 é¡¹ç›®è¡¥å……çŸ¥è¯†ç‚¹

### axios å°è£…

### AntDesign



### redux-immutable æ€§èƒ½ä¼˜åŒ–

#### é—®é¢˜ï¼š

æ•°æ®åº”å½“å…·æœ‰ä¸å¯å˜æ€§ï¼Œreducer åº”å½“æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚

recommend ç»„ä»¶ä¸­ï¼Œæœ‰éå¸¸å¤šçš„æ•°æ®ï¼š

æ’è¡Œæ¦œã€æ­Œæ‰‹åˆ—è¡¨ã€æ­Œæ›²åˆ—è¡¨ã€æ­Œå•åˆ—è¡¨ç­‰ç­‰

ç°åœ¨çš„ä»£ç ä¸­ï¼Œä¸€æ—¦å‘ç”Ÿæ•°æ®æ›´æ–°ï¼Œrecommend ä¸­æ‰€æœ‰çš„ state æ•°æ®éƒ½è¦æµ…æ‹·è´ä¸€ä»½ï¼Œç„¶ååˆ›å»ºå¥½ä¸€ä¸ªæ–°çš„ stateï¼Œè¿™æ ·éå¸¸å½±å“æ€§èƒ½ã€‚

- reducer æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼š

  ```jsx
  function reducer(state = defaultState, action) {
    switch (action.type) {
      case actionTypes.CHANGE_TOP_BANNERS:
        return { ...state, topBanners: action.topBanners };
      default:
        return state;
    }
  }
  ```

#### è§£å†³ï¼š

æ—¢èƒ½ **ä¿æŒæ•°æ®ä¸å¯å˜æ€§**ï¼Œåˆèƒ½ **èŠ‚çœå†…å­˜ï¼Œä¸è¦æ•´ä¸ªæ‹·è´** ã€‚

å¼•å…¥ä¸€ä¸ªæ–°çš„åº“è§£å†³ â€”â€” **ImmutableJS**

- ImmutableJS å¯¹è±¡çš„ç‰¹ç‚¹æ˜¯ï¼Œåªè¦ä¿®æ”¹äº†å¯¹è±¡ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ—§çš„å¯¹è±¡ä¸ä¼šæ”¹å˜ã€‚
- ImmutableJS  ä½¿ç”¨äº† Persistent Data Structureï¼ˆæŒä¹…åŒ–æ•°æ®ç»“æ„ï¼Œæˆ–ä¸€è‡´æ€§æ•°æ®ç»“æ„ï¼‰
  - è¿™æ˜¯ä¸€ç§ä¿å­˜æ•°æ®çš„æ•°æ®ç»“æ„
  - å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯è¿”å›çš„è¿™ä¸ªæ–°å¯¹è±¡ä¼š **å°½å¯èƒ½** åˆ©ç”¨ä¹‹å‰çš„æ•°æ®ç»“æ„ï¼Œå°½å¯èƒ½çš„èŠ‚çœå†…å­˜ã€‚

ä¸€å¼ å›¾æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼š

<img src="react%E5%A4%8D%E4%B9%A0/cb76e970eab64972905250166406af8etplv-k3u1fbpfcp-watermark.awebp" alt="immutableä¿®æ”¹èŠ‚ç‚¹æ›´æ–°å¼•ç”¨è¿‡ç¨‹" style="zoom:67%;" />

- `const im = Immutable`ï¼šåˆ›å»º Immutable 
- `Map()`ã€`List()`ï¼šåˆ›å»ºæ˜ å°„ã€åˆ›å»ºåˆ—è¡¨ã€‚
  - `Map()` åªæ˜¯æµ…å±‚è½¬åŒ–ï¼Œå¦‚æœæˆå‘˜ä»ç„¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæˆå‘˜æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ã€‚
- `im.fromJS(obj)`ï¼šæ·±å±‚è½¬åŒ–ã€‚å¦‚æœæœ‰å¤šå±‚åµŒå¥—çš„å¯¹è±¡ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥æŠŠå†…éƒ¨åµŒå¥—çš„å¯¹è±¡éƒ½è½¬åŒ–ä¸ºä¸€ä¸ª immutable å¯¹è±¡ã€‚
- `get()` ï¼šè·å–æ•°æ®
- `set()` ï¼šä¿®æ”¹æ•°æ®
- `state.getIn(["recommend", "topBanners"])` ï¼šå‘å†…å±‚è·å–æ•°æ®ï¼Œä¼ å…¥çš„æ˜¯å¯è¿­ä»£çš„å¯¹è±¡ã€‚
  - è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼š`state` æ˜¯ä¸€ä¸ª `immutable` å¯¹è±¡ï¼Œè·å–å®ƒæˆå‘˜ `recommend` çš„æ•°æ®ï¼›ç„¶åè¿™ä¸ª `recommend` ä¹Ÿæ˜¯ä¸€ä¸ª `immutable` å¯¹è±¡ï¼Œç»§ç»­è·å–å®ƒçš„æˆå‘˜ `topBanners` çš„æ•°æ®ã€‚
  - ç›¸å½“äºï¼š`state.get("recommend").("topBanners")`

- `redux-immutable` ä¸­çš„ `combineReducers` å¯ä»¥å®ç° `immutable` å’Œ `redux` çš„ `combineReducers` èåˆã€‚



-   `useSelector`ï¼šè·å– state ä¸­è¯¥ç»„ä»¶éœ€è¦çš„å€¼ã€‚ä¸€æ—¦ redux ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè°ƒç”¨ useSelector å¯¼è‡´æ‰€æœ‰ç»„ä»¶å…¨éƒ¨é‡æ–°æ¸²æŸ“ã€‚
-   `shallowEqual`ï¼šä¼šå¯¹æ¯”æ›´æ–°åçš„ state ä¸­ï¼Œå½“å‰ç»„ä»¶ä½¿ç”¨çš„å€¼ï¼Œæ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœæ–°çš„ state ä¸­ï¼Œä½¿ç”¨çš„å€¼å’ŒåŸæœ‰ state ä¸­çš„å€¼ç›¸åŒï¼Œå°±ä¸ä¼šå¼•èµ·è¯¥ç»„ä»¶çš„é‡æ–° renderã€‚è¿™ä¸ªæ¯”è¾ƒæ˜¯æµ…å¯¹æ¯”ã€‚

```js
// ---- æ€§èƒ½ä¼˜åŒ–
// ---- connectçš„mapStateToPropsä¼šæŠŠstateå’Œç»„ä»¶å½¢æˆä¾èµ–ï¼Œè¿›è€Œå¦‚æœä¾èµ–çš„æ•°æ®æ²¡æœ‰æ”¹å˜ï¼Œè¿™ä¸ªç»„ä»¶ä¹Ÿä¸ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼ŒèŠ‚çº¦å¼€é”€
// ---- ä½†æ˜¯ä½¿ç”¨useSelectorå¦‚æœåªä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±ä¸ä¼šæœ‰è¿™ç§æµ…å¯¹æ¯”ï¼Œåªè¦æœ‰stateå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚
// ---- useSelectorä½¿ç”¨çš„æ˜¯â€œ===â€æ¥æ¯”è¾ƒï¼Œä½†æ˜¯æ¯æ¬¡è¿”å›çš„æœ‰stateçš„å¯¹è±¡ï¼Œéƒ½æ˜¯æ–°åˆ›å»ºçš„ï¼Œæ‰€ä»¥ä¸€å®šä¸ç›¸ç­‰ï¼Œä¸€å®šä¼šé‡æ–°æ¸²æŸ“ã€‚
// ---- è§£å†³æ–¹æ¡ˆï¼šshallowEqualçš„å¼•å…¥
// ---- ç›´æ¥ä¼ å…¥ shallowEqual ä¸ºç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚
// ---- ç†è®ºä¸Šï¼Œåªè¦ä½¿ç”¨ useSelectorï¼Œå°±éœ€è¦ä¼ å…¥ shallowEqualï¼Œé™¤éå¸Œæœ›ä¸€æ—¦stateå˜åŒ–ï¼Œç»„ä»¶è¦é‡æ–°æ¸²æŸ“çš„æ—¶å€™ä¸ä¼ å…¥ã€‚
```



### å®ç°æ°´å¹³å±…ä¸­ï¼š

![image-20211029144024466](react%E5%A4%8D%E4%B9%A0/image-20211029144024466.png)

```css
left: 50%; 
transform: translateX(-50%);
```

åŸç†ï¼š

- `left: 50%; `ï¼šå…ƒç´ çš„å°ºå¯¸å¿½ç•¥ï¼Œç§»åŠ¨è·ç¦»æ˜¯ **åŒ…å«å—å®½åº¦** çš„ä¸€åŠã€‚æ˜¯ä»¥åŒ…å«å—çš„å·¦è¾¹ç•Œä¸ºåŸç‚¹ï¼Œè®©å…ƒç´ çš„å·¦è¾¹ç©ºå‡ºåŒ…å«å—å®½åº¦çš„ä¸€åŠã€‚
- `transform: translateX(-50%);`ï¼šç§»åŠ¨è·ç¦»æ˜¯ **å…ƒç´ å®½åº¦** çš„ä¸€åŠã€‚æ˜¯ä»¥åŒ…å«å—çš„å·¦è¾¹ç•Œä¸ºåŸç‚¹ï¼Œè®©å…ƒç´ å‘å·¦ç§»åŠ¨å…ƒç´ å®½åº¦çš„ä¸€åŠã€‚



é»˜è®¤ï¼Œä¸­é—´çš„æ’­æ”¾æ¡åœ¨æœ€å·¦ç«¯

![image-20211029144006260](react%E5%A4%8D%E4%B9%A0/image-20211029144006260.png)

æ·»åŠ  `left: 50%; ` åï¼Œæ’­æ”¾æ¡å³ç§»äº† åŠä¸ªç½‘é¡µå®½åº¦ï¼Œ

![image-20211029144126247](react%E5%A4%8D%E4%B9%A0/image-20211029144126247.png)

æ·»åŠ  `transform: translateX(-50%);` åï¼Œæ’­æ”¾æ¡å·¦ç§»äº† åŠä¸ªæ’­æ”¾æ¡çš„å®½åº¦ã€‚

![image-20211029144201213](react%E5%A4%8D%E4%B9%A0/image-20211029144201213.png)

æ€»ç»“ï¼š

- `left` çš„ç§»åŠ¨è·ç¦»æ˜¯å‚è€ƒåŒ…å«å—å°ºå¯¸çš„ï¼›

- `transform` çš„ç§»åŠ¨è·ç¦»æ˜¯å‚è€ƒå…ƒç´ è‡ªèº«çš„ã€‚



# 10 é¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¤§é—®é¢˜

å› ä¸ºç»éªŒçš„ä¸è¶³ï¼Œå‰æœŸå‡ºç°æµç¨‹åŒ–çš„ä¸ä¸¥è°¨æ€§ç¼ºå¤±ã€‚å°±ä¼šå¯¼è‡´åæœŸåœ¨è¡¥æ•‘æ—¶ï¼Œä»£ç å‡ºç°ä¸è§„èŒƒçš„å†—ä½™ã€å†…å­˜æ³„æ¼ç­‰é—®é¢˜ï¼›



æ­Œè¯çš„è§£æï¼Œä»¥åŠæ­Œè¯çš„æ˜¾ç¤ºã€‚

-   é‡åˆ°æœªçŸ¥çŸ¥è¯†ï¼Œå¦‚ä½•å­¦ä¹ ï¼Ÿ
-   å¦‚ä½•æŠŠåˆ«äººçš„çŸ¥è¯†ï¼Œèå…¥åˆ°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Ÿ
-   è®°å½•ï¼Œå¹¶æå‡ºä»Šåå¯ä¼˜åŒ–çš„éƒ¨åˆ†ã€‚



























