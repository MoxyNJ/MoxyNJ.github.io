---
notetitle: 1. React笔记
sidebar_position: 1
date: 2022-08-05
tags: [React]
---

React 架构体系三大模块

- 调度
- 协调
- 渲染



## React 设计理念

### 设计理念

浏览器的性能瓶颈在 CPU 和 IO。

（1）React 解决 CPU / IO 的瓶颈：**异步可中断的更新**。

浏览器的刷新率通常为 60Hz/s，也就是 16.6ms 刷新一次页面。

- 16.6ms 中，浏览器需要完成：JS脚本执行、样式布局、样式绘制。

当渲染的处理时间超过 16.6ms，页面就会卡顿。通常使用节流（间隔触发）、防抖（最后一个触发），都是通过限制更新频率来提升性能。

React 把同步更新，变为异步可中断进行更新。React 通过 fiber 把渲染任务切分为多个小段，每个小段执行完毕后会把主动权交还浏览器，浏览器则可根据当前任务的优先级，把剩余时间分配给更重要的任务，以确保尽可能的响应及时。

- 16.6ms 中，当浏览器执行完重要任务后，会把剩余时间交给 React 取执行尚未处理完的任务，如果剩余时间不够，就会把剩余任务在下一个 16.6ms 周期中执行。

这样，浏览器就有充足的时间进行样式布局和页面绘制，而 React 也可以在分配给自己的时间内执行完任务。

（2）React 解决 IO 的瓶颈：

### 架构

React 15+ 实现了异步可中断的架构

Scheduler 调度器：调度更新.

Reconcoler 协调器：决定需要更新什么组件.

Renderer 渲染器：将组件更新到视图中.



（1）当 React 需要更新时，更新任务首先被 Scheduler 调度器 处理：

- Scheduler 会把任务按照优先级排序，让更高优的任务首先进入 Reconciler 协调器进行下一步处理。

（2）Scheduler 调度器会通过 diff 算法，处理传入的更新任务。diff 完毕后，会把处理好的视图交给 Renderer 渲染器进一步处理。

- 而在 Reconciler 在进行 diff 算法时，如果调度器传来一个更高优的任务，那么当前处理的更新任务会被暂停，让调度器放入任务队列中，优先处理传入的更高优任务。
- 由于调度器和协调器是在内存中工作，即使 diff 中断，用户也无法感知到页面渲染被中断 / 卡顿。
- diff 算法会构建一颗虚拟 dom 树，视图上真实存在的节点，都有一个对应的节点在虚拟 dom 上。需要更新的节点会被打上标记 Update。被打了标记的虚拟 dom 会交给渲染器。

（3）本次更新由哪些组件需要更新视图，会让渲染器来分别执行这些视图更新操作。

- 视图更新操作：对 DOM 节点的增、删、查、改。
- 渲染器把被打了标记的虚拟 dom 对应的真实 dom 节点执行更新 dom 的操作。

（4）当高优先级任务完成渲染器渲染，又会开启新一轮的调度，进入循环。







> 来源：
>
> React课程：https://ke.segmentfault.com/course/1650000023864436/section/1500000023864578